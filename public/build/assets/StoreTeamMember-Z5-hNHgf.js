import{c as b,i as B}from"./cloneDeep-BSUglKOW.js";import{A}from"./Alert-DoRT84Ne.js";import{F as E}from"./FormMixin-BJ8PeuZD.js";import{U as D}from"./UtilsMixin-CBwmyCNB.js";import{a as V,c as n,b as t,d as m,w as l,F as g,e as h,f as p,t as c,k as H,h as u,r as a,o as r}from"./app-CEjZQ6df.js";import{u as O}from"./store-store-M1WmsIoF.js";import{T as j}from"./TextInput-CK3kfyTM.js";import{I as R}from"./InputTags-D5ILNwN8.js";import{T as U}from"./TextHeader-Jo_fT9rL.js";import{C as W}from"./Checkbox-aADm5806.js";import{B as Z}from"./BackButton-DSiMgTvj.js";import{N as q}from"./NumberInput-FyHYtonN.js";import{S as G}from"./SelectInput-CAesltQW.js";import{C as Y}from"./ConfirmModal-qRPWBp9y.js";import{S as z}from"./ShineEffect-C96Jtt2K.js";import{P as J}from"./PrimaryButton-3P5o1uMS.js";import{L as K}from"./LineSkeleton-qpUbsI0L.js";import{S as Q}from"./SpinningLoader-huGTtUOZ.js";import{S as X}from"./SelectInputTags-SK1O3OTr.js";import{M as $}from"./MoreInfoPopover-CEXwrCbN.js";import{B as ee}from"./BackdropLoader-BW3yXSd8.js";import{M as se}from"./MobileNumberInput-DkTyQMnS.js";import{B as te}from"./BadgeIndicator-B-Xd2hrd.js";import{F as ie}from"./FormErrorMessages-D8f9O8m6.js";import{g as T,p as re,a as oe,d as me}from"./api-repository-__UpBA-l.js";import{_ as ae}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./form-store-CUa2LMmB.js";import"./InputErrorMessage-BxLOsLu7.js";import"./vue3-tags-input.esm-C5qE2vM-.js";const ne={mixins:[D,E],components:{Alert:A,TextInput:j,TextHeader:U,Checkbox:W,InputTags:R,BackButton:Z,NumberInput:q,SelectInput:G,ConfirmModal:Y,ShineEffect:z,PrimaryButton:J,LineSkeleton:K,SpinningLoader:Q,SelectInputTags:X,MoreInfoPopover:$,BackdropLoader:ee,MobileNumberInput:se,BadgeIndicator:te,FormErrorMessages:ie},data(){return{form:{hasFullPermissions:!1,mobileNumbers:["+26772000001"],permissions:[]},teamMember:null,isDeleting:!1,originalForm:null,isSubmitting:!1,authState:V(),isLoadingTeamMember:!1,storeState:O(),selectedAllPermissions:!1,teamMemberPermissionOptions:[],isLoadingTeamMemberPermissions:!1,isLoadingAvailableTeamMemberPermissions:!1}},watch:{"$route.params.team_member_href"(s,e){window.scrollTo(0,0),this.getTeamMember()}},computed:{store(){return this.storeState.store},isInviting(){return this.$route.name==="invite-store-team-member"},isEditting(){return this.$route.name==="show-store-team-member"},teamMemberRole(){return this.teamMember==null?null:this.teamMember._attributes.userStoreAssociation.teamMemberRole},teamMemberStatus(){return this.teamMember==null?null:this.teamMember._attributes.userStoreAssociation.teamMemberStatus},hasPermissions(){return this.totalPermissions>0},totalPermissions(){return this.form.permissions.length},isMe(){return(this.teamMember||{}).id==this.authState.user.id},isCreator(){return this.teamMemberRole.toLowerCase()=="creator"},isInvited(){return this.teamMemberStatus.toLowerCase()=="invited"},hasFullPermissions(){return this.form.hasFullPermissions},hasProvidedMobileNumber(){return this.form.mobileNumbers.length>0&&this.form.mobileNumbers.some(s=>s.trim()!=="")},formHasChanged(){var s=b(this.form),e=b(this.originalForm);return!B(s,e)},mustSaveChanges(){return this.isEditting&&this.formHasChanged&&this.hasProvidedMobileNumber&&(this.hasFullPermissions||this.hasPermissions)&&!this.isLoadingTeamMemberPermissions&&!this.isLoadingAvailableTeamMemberPermissions&&!this.isSubmitting},mustInvite(){return this.isInviting&&this.formHasChanged&&this.hasProvidedMobileNumber&&(this.hasFullPermissions||this.hasPermissions)&&!this.isLoadingTeamMemberPermissions&&!this.isLoadingAvailableTeamMemberPermissions&&!this.isSubmitting}},methods:{goBack(){this.$router.replace({name:"show-store-team-members",params:{store_href:this.store._links.showStore}})},setTeamMemberFields(){this.form.mobileNumbers[0]=(this.teamMember.mobileNumber||{}).international||this.teamMember._relationships.userStoreAssociation.mobileNumber.international,this.originalForm=b(this.form)},getTeamMember(){this.isLoadingTeamMember=!0,T(this.$route.params.team_member_href).then(s=>{s.status==200&&(this.teamMember=s.data.user,this.setTeamMemberFields(),this.showStoreTeamMemberPermissions()),this.isLoadingTeamMember=!1}).catch(s=>{this.isLoadingTeamMember=!1,this.setServerFormErrors(s)})},showStoreTeamMemberPermissions(){this.isLoadingTeamMemberPermissions=!0,T(this.teamMember._links.showStoreTeamMemberPermissions).then(s=>{s.status==200&&(this.form.hasFullPermissions=s.data.hasFullPermissions,this.form.permissions=s.data.permissions.map(e=>({text:e.name,grant:e.grant})),this.originalForm=b(this.form)),this.isLoadingTeamMemberPermissions=!1}).catch(s=>{this.isLoadingTeamMemberPermissions=!1,this.setServerFormErrors(s)})},showTeamMemberPermissionOptions(){this.isLoadingAvailableTeamMemberPermissions=!0,T(this.store._links.showTeamMemberPermissionOptions).then(s=>{s.status==200&&(this.teamMemberPermissionOptions=s.data.map(e=>({text:e.name,grant:e.grant}))),this.isLoadingAvailableTeamMemberPermissions=!1}).catch(s=>{this.isLoadingAvailableTeamMemberPermissions=!1,this.setServerFormErrors(s)})},inviteTeamMember(){this.isSubmitting=!0;var s=b(this.form);this.form.hasFullPermissions?s.permissions=["*"]:s.permissions=s.permissions.map(e=>e.grant),re(this.store._links.inviteStoreTeamMembers,s).then(e=>{e.status==200&&(this.showSuccessfulNotification(e.data.message),this.$router.push({name:"show-store-team-members",params:{store_href:this.store._links.showStore}}),window.scrollTo(0,0)),this.isSubmitting=!1}).catch(e=>{this.isSubmitting=!1,this.setServerFormErrors(e)})},updateTeamMember(){if(!this.isMe){this.isSubmitting=!0;var s=b(this.form);this.form.hasFullPermissions?s.permissions=["*"]:s.permissions=s.permissions.map(e=>e.grant),oe(this.teamMember._links.updateStoreTeamMemberPermissions,s).then(e=>{e.status==200&&(e.data.updated?(this.originalForm=b(this.form),this.showSuccessfulNotification("Team member updated"),this.form.hasFullPermissions&&this.showStoreTeamMemberPermissions()):(this.form=b(this.originalForm),this.setFormError("general",e.data.message),this.showUnsuccessfulNotification(e.data.message))),this.isSubmitting=!1}).catch(e=>{this.isSubmitting=!1,this.setServerFormErrors(e)})}},deleteTeamMember(){this.isDeleting=!0;var s={mobileNumbers:this.form.mobileNumbers};me(this.store._links.removeStoreTeamMembers,s).then(e=>{e.status==200&&(e.data.deleted?(this.showSuccessfulNotification(e.data.message),this.$router.push({name:"show-store-team-members",params:{store_href:this.store._links.showStore}}),window.scrollTo(0,0)):(this.setFormError("general",e.data.message),this.showUnsuccessfulNotification(e.data.message))),this.isDeleting=!1}).catch(e=>{this.isDeleting=!1,this.setServerFormErrors(e)})}},created(){this.originalForm=b(this.form),this.isEditting&&this.getTeamMember(),this.showTeamMemberPermissionOptions()}},le={class:"flex justify-start items-center border-dashed py-6"},he={key:0,class:"flex items-center space-x-2"},ue={class:"flex items-center space-x-2"},de={class:"relative",action:"#",method:"POST"},be={class:"flex items-center space-x-2"},fe={class:"grid grid-cols-12 gap-4 mb-8"},pe={class:"col-span-8 relative"},ce={class:"space-y-4 bg-white shadow-lg rounded-lg border p-4 mb-4"},ge={key:2},ve={class:"flex items-center space-x-2"},Me={key:1,class:"font-bold"},we={class:"bg-white shadow-lg rounded-lg border p-4"},Te={key:1,class:"space-y-2"},_e={class:"col-span-4"},Pe={class:"flex flex-col justify-between bg-white shadow-lg rounded-lg border p-4 relative"},Se={class:"flex items-center space-x-4 mb-2"},xe={key:2,class:"space-y-2"},ke={class:"text-xs"},ye={key:1,class:"space-y-4 shadow-lg rounded-lg border border-red-300 bg-red-50 p-4"},Fe={class:"font-bold text-black"},Le={class:"flex justify-end"},Ie={class:"mb-8"},Ne={class:"font-bold text-black"};function Ce(s,e,Be,Ae,i,o){const S=a("BackButton"),f=a("LineSkeleton"),v=a("ShineEffect"),x=a("TextHeader"),w=a("BadgeIndicator"),k=a("MoreInfoPopover"),_=a("PrimaryButton"),M=a("Alert"),y=a("FormErrorMessages"),P=a("BackdropLoader"),F=a("MobileNumberInput"),L=a("Checkbox"),I=a("SelectInputTags"),N=a("ConfirmModal");return r(),n("div",null,[t("div",le,[m(S,{class:"w-16 mr-4",action:o.goBack},null,8,["action"]),i.isLoadingTeamMember?(r(),n("div",he,[m(v,{class:"flex space-x-2"},{default:l(()=>[m(f,{width:"w-20 mt-2"}),m(f,{width:"w-16 mt-2"}),m(f,{width:"w-4 mt-2"})]),_:1})])):(r(),n(g,{key:1},[t("div",ue,[m(x,null,{default:l(()=>[u(c(o.isInviting?"Add Team Member":i.teamMember._attributes.name),1)]),_:1}),o.isEditting?(r(),h(w,{key:0,type:o.isCreator?"success":"info",text:o.teamMemberRole,showDot:o.isCreator},null,8,["type","text","showDot"])):p("",!0),o.isEditting?(r(),h(w,{key:1,type:o.isInvited?"warning":"info",text:o.teamMemberStatus,showDot:o.isCreator},null,8,["type","text","showDot"])):p("",!0)]),m(k,{class:"ml-2",title:"What Is This?",description:"Team members are people who help you manage your store and grow your business",placement:"top"})],64))]),t("form",de,[o.mustInvite||o.mustSaveChanges?(r(),h(M,{key:0,type:"warning",class:"flex justify-between items-center mb-2"},{default:l(()=>[t("div",be,[e[3]||(e[3]=t("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-6 h-6"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 9v3.75m9-.75a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 3.75h.008v.008H12v-.008Z"})],-1)),t("span",null,c(o.isInviting?"Invite your team member":"Please save your changes"),1)]),m(_,{action:o.isInviting?o.inviteTeamMember:o.updateTeamMember,loading:i.isSubmitting,class:"w-40"},{default:l(()=>[u(c(o.isInviting?"Invite":"Save Changes"),1)]),_:1},8,["action","loading"])]),_:1})):p("",!0),m(y),t("div",fe,[t("div",pe,[i.isLoadingTeamMember||i.isSubmitting?(r(),h(P,{key:0,class:"rounded-lg"})):p("",!0),t("div",ce,[o.isInviting?(r(),n(g,{key:0},[e[4]||(e[4]=t("p",{class:"font-bold text-sm"},"Invitation",-1)),e[5]||(e[5]=t("p",{class:"text-sm text-gray-400"},"Enter the mobile number of the person you want to invite e.g +26772000001",-1))],64)):p("",!0),o.isInviting?(r(),h(F,{key:1,modelValue:i.form.mobileNumbers[0],"onUpdate:modelValue":e[0]||(e[0]=d=>i.form.mobileNumbers[0]=d),labelPopoverTitle:"What Is This?",errorText:s.getFormError("mobileNumbers0"),labelPopoverDescription:"The mobile number that will be used by customers as the primary contact number of your store"},null,8,["modelValue","errorText"])):(r(),n("div",ge,[t("div",ve,[e[6]||(e[6]=t("span",null,"Mobile Number: ",-1)),i.isLoadingTeamMember?(r(),h(v,{key:0},{default:l(()=>[m(f,{width:"w-24"})]),_:1})):(r(),n("span",Me,c((i.teamMember.mobileNumber||{}).national||i.teamMember._relationships.userStoreAssociation.mobileNumber.national),1))])]))]),t("div",we,[i.isLoadingTeamMember||i.isLoadingTeamMemberPermissions||i.isLoadingAvailableTeamMemberPermissions?(r(),h(v,{key:0,class:"space-y-4"},{default:l(()=>[m(f,{width:"w-24"}),m(f,{width:"w-60"})]),_:1})):(r(),n("div",Te,[o.isMe?(r(),n(g,{key:0},[i.form.hasFullPermissions?(r(),h(M,{key:0,class:"flex items-center space-x-2"},{default:l(()=>e[7]||(e[7]=[t("svg",{class:"w-4 h-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M16.5 10.5V6.75a4.5 4.5 0 1 0-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 0 0 2.25-2.25v-6.75a2.25 2.25 0 0 0-2.25-2.25H6.75a2.25 2.25 0 0 0-2.25 2.25v6.75a2.25 2.25 0 0 0 2.25 2.25Z"})],-1),t("span",null,"You cannot change your own permissions",-1)])),_:1})):p("",!0)],64)):(r(),n(g,{key:1},[m(L,{label:"Grant Full Permissions",modelValue:i.form.hasFullPermissions,"onUpdate:modelValue":e[1]||(e[1]=d=>i.form.hasFullPermissions=d),labelPopoverTitle:"What Is This?",labelPopoverDescription:"The team member will be granted all available permissions when this is checked"},null,8,["modelValue"]),i.form.hasFullPermissions?(r(),h(M,{key:0},{default:l(()=>e[8]||(e[8]=[u(" This team member has been granted "),t("span",{class:"font-bold"},"Full Permissions",-1),u(" to manage this store ")])),_:1})):(r(),h(I,{key:1,class:"w-full",label:"Permissions",tags:i.form.permissions,labelPopoverTitle:"What Is This?",errorText:s.getFormError("permissions"),selectableTags:i.teamMemberPermissionOptions,onOnTagsChanged:e[2]||(e[2]=d=>i.form.permissions=d),labelPopoverDescription:"Set the permissions for your team member"},null,8,["tags","errorText","selectableTags"]))],64))]))])]),t("div",_e,[t("div",Pe,[i.isLoadingTeamMember||i.isSubmitting?(r(),h(P,{key:0,showSpinningLoader:!1,class:"rounded-lg"})):p("",!0),t("div",Se,[e[9]||(e[9]=t("div",{class:"flex items-center space-x-2"},[t("svg",{class:"w-4 h-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M13.5 10.5V6.75a4.5 4.5 0 1 1 9 0v3.75M3.75 21.75h10.5a2.25 2.25 0 0 0 2.25-2.25v-6.75a2.25 2.25 0 0 0-2.25-2.25H3.75a2.25 2.25 0 0 0-2.25 2.25v6.75a2.25 2.25 0 0 0 2.25 2.25Z"})]),t("p",{class:"font-bold text-lg"},"Permissions")],-1)),m(w,{type:"primary",text:i.form.hasFullPermissions?"All":o.totalPermissions,showDot:!1},null,8,["text"])]),e[11]||(e[11]=t("p",{class:"text-sm text-gray-400 border-b border-dashed pb-2 mb-4"},"See permissions granted",-1)),i.isLoadingTeamMember||i.isLoadingTeamMemberPermissions?(r(),h(v,{key:1,class:"space-y-4"},{default:l(()=>[m(f,{width:"w-32"}),m(f,{width:"w-60"})]),_:1})):o.hasPermissions?(r(),n("div",xe,[(r(!0),n(g,null,H(i.form.permissions,(d,C)=>(r(),n("div",{key:C,class:"flex space-x-2 px-2 border-l-4 border-green-300"},[t("p",ke,c(d.text),1)]))),128))])):(r(),h(M,{key:3},{default:l(()=>e[10]||(e[10]=[u(" No permissions granted ")])),_:1}))])])]),i.teamMember&&!o.isCreator?(r(),n("div",ye,[t("p",null,[e[12]||(e[12]=u("Do you want to remove ")),t("span",Fe,c(i.teamMember._attributes.name),1),e[13]||(e[13]=u("?"))]),t("div",Le,[m(N,{approveText:"Remove Team Member",approveAction:o.deleteTeamMember,isLoading:i.isDeleting},{content:l(()=>[e[16]||(e[16]=t("p",{class:"text-lg font-bold border-b border-dashed pb-4 mb-4"},"Confirm Delete",-1)),t("p",Ie,[e[14]||(e[14]=u("Are you sure you want to remove ")),t("span",Ne,c(i.teamMember._attributes.name),1),e[15]||(e[15]=u("?"))])]),trigger:l(d=>[m(_,{action:d.showModal,loading:i.isDeleting,class:"w-60",type:"danger"},{default:l(()=>e[17]||(e[17]=[u(" Remove Team Member ")])),_:2},1032,["action","loading"])]),_:1},8,["approveAction","isLoading"])])])):p("",!0)])])}const hs=ae(ne,[["render",Ce]]);export{hs as default};
