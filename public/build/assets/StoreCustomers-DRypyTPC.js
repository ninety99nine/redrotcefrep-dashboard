import{P as M}from"./Pill-CNWbwQ3o.js";import{F as A}from"./FormMixin-6JkaGLLr.js";import{B as N}from"./Button-BeSnAT_x.js";import{U as B}from"./form-store-C265_0LO.js";import{u as E}from"./store-store-DI9g0YE3.js";import{C as V}from"./Checkbox-CA6moHBM.js";import{B as P}from"./BasicTable-BENOl8OQ.js";import{C as R}from"./ConfirmModal-l78eHkJU.js";import{S as F}from"./SpinningLoader-BdvFuScB.js";import{M as O}from"./MoreInfoPopover-DuLCv7tU.js";import{g as U,d as z}from"./api-repository--xE_j9dL.js";import{T as H}from"./ToogleSwitch-D6TVHn6r.js";import{N as j}from"./NoDataPlaceholder-BIIoZLQj.js";import{c as a,b as e,e as f,B as W,w as d,d as m,r as p,o as i,h as b,F as x,k as v,t as l,m as y,n as Y,f as h}from"./app-jXH5QC3l.js";import{_ as q}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ShineEffect-DfG5M4Ts.js";import"./cloneDeep-B1YGuKb7.js";import"./InputErrorMessage-CbGsL3fL.js";import"./SearchInput-BxlZh9-p.js";import"./index-CHIj4cOM.js";import"./TextInput-CYg7QVrw.js";import"./SelectInput-D7XUHB9M.js";import"./Drawer-CCLxMHft.js";import"./MoneyInput-CQeRzHMh.js";import"./Datepicker-B1KIg2S4.js";import"./vue-draggable-next.esm-bundler-DxBVIkpx.js";const G={mixins:[A,B],components:{Pill:M,Button:N,BasicTable:P,Checkbox:V,ConfirmModal:R,SpinningLoader:F,MoreInfoPopover:O,ToogleSwitch:H,NoDataPlaceholder:j},data(){return{customers:[],pagination:null,searchTerm:null,checkedRowIds:[],showEverything:!1,deletableCustomer:null,isDeletingCustomerIds:[],isLoadingCustomers:!1,storeState:E()}},watch:{isLoadingStore(s){s||this.getCustomers()}},computed:{store(){return this.storeState.store},isLoadingStore(){return this.storeState.isLoadingStore},tableHeaders(){return this.showEverything?["","Name","Mobile Number","Email","Birthday","Total Orders","Total Average Spend","Total Spend","Last Order Date","Created Date",""]:["","Name","Mobile Number","Email","Total Orders","Total Spend",""]},hasSearchTerm(){return this.searchTerm!=null&&this.searchTerm.trim()!=""}},methods:{onView(s){this.isDeletingCustomerIds.length||this.$router.push({name:"show-store-customer",params:{store_href:this.store._links.showStore,customer_href:s._links.showCustomer}})},onAddCustomer(){this.isDeletingCustomerIds.length||this.$router.push({name:"create-store-customer",params:{store_href:this.store._links.showStore}})},showDeleteConfirmationModal(s){this.deletableCustomer=s,this.deleteCustomerModal.showModal()},isDeleting(s){return this.isDeletingCustomerIds.findIndex(t=>t==s.id)!=-1},paginate(s){this.getCustomers(s)},search(s){this.searchTerm=s,this.getCustomers()},getCustomers(s=null){this.isLoadingCustomers=!0;const t={};this.hasSearchTerm&&(t.search=this.searchTerm),s=s??this.store._links.showStoreCustomers,U(s,t).then(u=>{u.status==200&&(this.pagination=u.data,this.customers=this.pagination.data,this.checkedRowIds=this.customers.map(k=>!1)),this.isLoadingCustomers=!1}).catch(u=>{this.isLoadingCustomers=!1,this.setServerFormErrors(u)})},deleteCustomer(){this.isDeletingCustomerIds.push(this.deletableCustomer.id),z(this.deletableCustomer._links.deleteCustomer).then(s=>{this.isDeletingCustomerIds.splice(this.isDeletingCustomerIds.findIndex(t=>t==this.deletableCustomer.id,1)),s.status==200&&(s.data.deleted?(this.showSuccessfulNotification("Customer deleted"),this.isDeletingCustomerIds.length==0&&this.getCustomers()):(this.setFormError("general",s.data.message),this.showUnsuccessfulNotification(s.data.message)))}).catch(s=>{this.isDeletingCustomerIds.splice(this.isDeletingCustomerIds.findIndex(t=>t==this.deletableCustomer.id,1)),this.setServerFormErrors(s)})}},mounted(){this.deleteCustomerModal=this.$refs.deleteCustomerModal},created(){this.isLoadingCustomers=!0}},J={class:"pt-24 pb-80 px-8 relative"},K={class:"relative"},Q={class:"flex justify-center my-4"},X=["onClick"],Z={class:"whitespace-nowrap px-4 py-4"},$={class:"flex space-x-1 items-center w-40"},ee={class:"px-4 py-4"},te={class:"flex space-x-1 items-center"},se={key:1},oe={class:"px-4 py-4"},ie={class:"flex space-x-1 items-center"},re={key:1},ae={key:0,class:"px-4 py-4"},ne={class:"flex space-x-1 items-center w-24"},le={key:1},de={class:"text-center px-4 py-4"},me={class:"whitespace-nowrap px-4 py-4"},pe={key:1,class:"whitespace-nowrap px-4 py-4"},he={key:2,class:"whitespace-nowrap px-4 py-4"},ue={class:"flex space-x-1 items-center"},ce={key:3,class:"whitespace-nowrap px-4 py-4"},fe={class:"flex space-x-1 items-center"},ge={class:"px-4 py-4 flex items-center space-x-4"},ye=["onClick"],Ce=["onClick"],_e={key:1,class:"flex justify-center"},be={class:"animated-border-blue w-96 bg-white py-4 px-4 shadow-sm space-y-4 rounded-xl"},we={class:"flex justify-end"},xe={key:0,class:"mb-8"},ve={class:"font-bold text-black"};function ke(s,t,u,k,r,n){const S=p("ToogleSwitch"),w=p("Button"),D=p("Checkbox"),C=p("MoreInfoPopover"),_=p("NoDataPlaceholder"),T=p("SpinningLoader"),I=p("BasicTable"),L=p("ConfirmModal");return i(),a("div",J,[t[12]||(t[12]=e("img",{src:"/images/clouds.png",class:"absolute top-0"},null,-1)),e("div",K,[t[8]||(t[8]=e("div",{class:"flex flex-col items-center mb-8"},[e("h1",{class:"space-x-2 text-xl text-gray-700 font-semibold bg-white rounded-full py-2 px-8 mb-4"},[e("span",null,"ðŸ˜Š"),e("span",null,"Customers")]),e("img",{src:"/images/store-rooftop.png",class:"w-96"})],-1)),r.isLoadingCustomers||(r.pagination??{}).total>0||n.hasSearchTerm?(i(),f(I,{key:0,pagination:r.pagination,isLoading:r.isLoadingCustomers,onPaginate:n.paginate,onSearch:n.search,onRefresh:n.getCustomers,totalHeaders:n.tableHeaders.length},W({afterRefreshButton:d(()=>[m(w,{action:n.onAddCustomer,type:"primary",size:"sm",icon:"add"},{default:d(()=>t[3]||(t[3]=[e("span",null,"Add Customer",-1)])),_:1},8,["action"])]),head:d(()=>[e("tr",null,[(i(!0),a(x,null,v(n.tableHeaders,(o,c)=>(i(),a("th",{key:c,scope:"col",class:"whitespace-nowrap px-4 py-3"},l(o),1))),128))])]),body:d(()=>[(i(!0),a(x,null,v(r.customers,(o,c)=>(i(),a("tr",{onClick:y(g=>n.onView(o),["stop"]),key:o.id,class:Y(["group cursor-pointer border-b",r.checkedRowIds[c]?"bg-blue-100":"bg-white hover:bg-gray-50"])},[e("td",{onClick:t[1]||(t[1]=y(()=>{},["stop"])),class:"whitespace-nowrap pl-4"},[m(D,{size:"xs",modelValue:r.checkedRowIds[c],"onUpdate:modelValue":g=>r.checkedRowIds[c]=g},null,8,["modelValue","onUpdate:modelValue"])]),e("td",Z,[e("div",$,[e("span",null,l(o._attributes.name),1),m(C,{class:"opacity-0 group-hover:opacity-100",title:o._attributes.name,description:o.notes,placement:"top"},null,8,["title","description"])])]),e("td",ee,[e("div",te,[o.mobileNumber==null?(i(),f(_,{key:0})):(i(),a("span",se,l(o.mobileNumber.national),1))])]),e("td",oe,[e("div",ie,[o.email==null?(i(),f(_,{key:0})):(i(),a("span",re,l(o.email),1))])]),r.showEverything?(i(),a("td",ae,[e("div",ne,[o.birthday==null?(i(),f(_,{key:0})):(i(),a("span",le,l(s.formattedDate(o.birthday)),1))])])):h("",!0),e("td",de,[e("span",null,l(o.totalOrders),1)]),e("td",me,[e("span",null,l(o.totalSpend.amountWithCurrency),1)]),r.showEverything?(i(),a("td",pe,[e("span",null,l(o.totalAverageSpend.amountWithCurrency),1)])):h("",!0),r.showEverything?(i(),a("td",he,[e("div",ue,[e("span",null,l(s.formattedDatetime(o.lastOrderAt)),1),m(C,{class:"opacity-0 group-hover:opacity-100",title:s.formattedRelativeDate(o.lastOrderAt),placement:"top"},null,8,["title"])])])):h("",!0),r.showEverything?(i(),a("td",ce,[e("div",fe,[e("span",null,l(s.formattedDatetime(o.createdAt)),1),m(C,{class:"opacity-0 group-hover:opacity-100",title:s.formattedRelativeDate(o.createdAt),placement:"top"},null,8,["title"])])])):h("",!0),e("td",ge,[n.isDeleting(o)?h("",!0):(i(),a("a",{key:0,href:"#",onClick:y(g=>n.onView(o),["stop","prevent"]),class:"font-medium text-blue-600 dark:text-blue-500 hover:underline"},"View",8,ye)),n.isDeleting(o)?(i(),f(T,{key:1,type:"danger"},{default:d(()=>t[4]||(t[4]=[e("span",{class:"text-xs ml-2"},"Deleting...",-1)])),_:1})):(i(),a("a",{key:2,href:"#",onClick:y(g=>n.showDeleteConfirmationModal(o),["stop","prevent"]),class:"font-medium text-red-600 dark:text-red-500 hover:underline"},"Delete",8,Ce))])],10,X))),128))]),_:2},[(r.pagination??{}).total>0?{name:"header",fn:d(()=>[e("div",Q,[m(S,{modelValue:r.showEverything,"onUpdate:modelValue":t[0]||(t[0]=o=>r.showEverything=o),size:"md",labelPopoverTitle:"What Is This?",labelPopoverDescription:"Turn on if you want to show more information about your products"},{default:d(()=>t[2]||(t[2]=[b(" Show Everything ")])),_:1},8,["modelValue"])])]),key:"0"}:void 0]),1032,["pagination","isLoading","onPaginate","onSearch","onRefresh","totalHeaders"])):(i(),a("div",_e,[e("div",be,[t[6]||(t[6]=e("h1",{class:"text-xl font-bold"}," Add Your First Customer ",-1)),t[7]||(t[7]=e("p",{class:"text-sm text-gray-500"}," Start building your customer base! You can add customers directly or let them find you by marketing your store. ",-1)),e("div",we,[m(w,{action:n.onAddCustomer,type:"primary",size:"sm",icon:"add"},{default:d(()=>t[5]||(t[5]=[e("span",null,"Add Customer",-1)])),_:1},8,["action"])])])]))]),m(L,{ref:"deleteCustomerModal",approveText:"Delete Customer",approveAction:n.deleteCustomer,isLoading:n.isDeleting(r.deletableCustomer)},{content:d(()=>[t[11]||(t[11]=e("p",{class:"text-lg font-bold border-b border-dashed pb-4 mb-4"},"Confirm Delete",-1)),r.deletableCustomer?(i(),a("p",xe,[t[9]||(t[9]=b("Are you sure you want to permanently delete ")),e("span",ve,l(r.deletableCustomer._attributes.name),1),t[10]||(t[10]=b("?"))])):h("",!0)]),_:1},8,["approveAction","isLoading"])])}const Xe=q(G,[["render",ke]]);export{Xe as default};
