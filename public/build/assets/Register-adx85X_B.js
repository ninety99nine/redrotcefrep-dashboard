import{R as U,u as I,s as P,j as B,c as l,b as n,d as r,w as f,e as w,f as p,F as u,g as c,r as s,o as a,h as d,t as N}from"./app-BJ2494tY.js";import{L as K}from"./Logo-Bq6XcX-U.js";import{A as L}from"./Alert-B-RVH4op.js";import{F as A}from"./FormMixin-C-SEfk4N.js";import{U as M}from"./UtilsMixin-CBwmyCNB.js";import{T as H}from"./TextInput-CUcJCGoF.js";import{T as O}from"./TextHeader-CaZ3OhJR.js";import{B as G}from"./BackButton-DD0clg4W.js";import{P as q}from"./PasswordInput-HFFDHWXJ.js";import{O as j}from"./OtpInput-DRY3jaMW.js";import{P as D}from"./PrimaryButton-CWR1r8_v.js";import{S as W}from"./SocialLinks-_sYZyj4p.js";import{u as z}from"./form-store-DeefSRkV.js";import{M as J}from"./MobileNumberInput-DF6Eft9S.js";import{F as Q}from"./FormErrorMessages-iqnzjn8q.js";import{C as X}from"./ConfirmPasswordInput-D07PtLTy.js";import{v as Y,r as Z}from"./auth-repository-DRF0R1zW.js";import{_ as $}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./InputErrorMessage-BCt8DcLy.js";import"./MoreInfoPopover-BzoCFpGT.js";import"./SpinningLoader-B-mpwgLP.js";import"./api-repository-C7PBUzrq.js";const ee={mixins:[A,M],components:{Logo:K,Alert:L,RouterLink:U,TextInput:H,TextHeader:O,BackButton:G,PasswordInput:q,OtpInput:j,PrimaryButton:D,SocialLinks:W,MobileNumberInput:J,FormErrorMessages:Q,ConfirmPasswordInput:X},data(){return{registerUrl:null,isSubmitting:!1,accountExistsUrl:null,apiState:I(),validateRegisterUrl:null,appName:P.appName,mobileVerificationShortcode:null,notificationState:z(),accountExists:null,showVerificationCode:!1,lastName:"",password:"",firstName:"",mobileNumber:"",verificationCode:"",passwordConfirmation:""}},beforeRouteEnter(o,e,b){b(h=>{o.query.hasOwnProperty("mobileNumber")&&(h.mobileNumber=o.query.mobileNumber,h.handleRegistration())})},methods:{handleRegistration(){this.hideFormErrors(),this.showVerificationCode?this.attemptRegistration():this.accountExists==null?this.checkIfAccountExists():this.validateRegistration()},checkIfAccountExists(){this.mobileNumber.trim()==""?this.setFormError("mobileNumber","Enter your mobile number"):this.accountExistsUrl!=null?(this.isSubmitting=!0,B.post(this.accountExistsUrl,{mobileNumber:this.mobileNumber}).then(o=>{this.isSubmitting=!1,this.accountExists=o.data.exists,this.accountExists&&this.$router.push({name:"login",query:{mobileNumber:this.mobileNumber}})}).catch(o=>{this.isSubmitting=!1,this.setServerFormErrors(o)})):this.setGeneralFormError("The accountExistsUrl does not exist")},validateRegistration(){if(this.firstName.trim()=="")this.setFormError("firstName","Enter your first name");else if(this.lastName.trim()=="")this.setFormError("lastName","Enter your last name");else if(this.mobileNumber.trim()=="")this.setFormError("mobileNumber","Enter your mobile number");else if(this.password.trim()=="")this.setFormError("password","Enter your password");else if(this.passwordConfirmation.trim()=="")this.setFormError("passwordConfirmation","Enter your password confirmation");else if(this.password!=this.passwordConfirmation)this.setFormError("password","Password does not match confirmation");else if(this.validateRegisterUrl!=null){this.isSubmitting=!0;let o={lastName:this.lastName,password:this.password,firstName:this.firstName,mobileNumber:this.mobileNumber,passwordConfirmation:this.passwordConfirmation};Y(o).then(e=>{e.status==200&&(this.isSubmitting=!1,this.showVerificationCode=!0)}).catch(e=>{this.isSubmitting=!1,this.setServerFormErrors(e)})}else this.setGeneralFormError("The validateRegisterUrl does not exist")},attemptRegistration(){if(this.verificationCode.trim()=="")this.setFormError("verificationCode","Enter your verification code");else if(this.registerUrl!=null){this.isSubmitting=!0;let o={lastName:this.lastName,password:this.password,firstName:this.firstName,mobileNumber:this.mobileNumber,verificationCode:this.verificationCode,passwordConfirmation:this.passwordConfirmation};Z(o).then(e=>{e.status==200&&(this.isSubmitting=!1,this.$router.replace({name:"show-stores"}),this.showSuccessfulNotification("Welcome to "+this.appName))}).catch(e=>{this.isSubmitting=!1,this.setServerFormErrors(e)})}else this.setGeneralFormError("The registerUrl does not exist")},backToRegistrationForm(){this.showVerificationCode=!1}},created(){this.registerUrl=this.apiState.apiHome._links.register,this.accountExistsUrl=this.apiState.apiHome._links.accountExists,this.validateRegisterUrl=this.apiState.apiHome._links.validateRegister,this.mobileVerificationShortcode=this.apiState.apiHome.mobileVerificationShortcode}},te={class:"flex min-h-screen flex-col justify-center px-6 py-12 lg:px-8 bg-gray-100"},oe={class:"sm:mx-auto sm:w-full sm:max-w-sm"},se={class:"mt-10 sm:mx-auto sm:w-full sm:max-w-sm"},re={class:"space-y-6",action:"#",method:"POST"},ie={class:"font-bold"},ne={class:"font-bold"},ae={class:"grid grid-cols-2 gap-4"},me={class:"md:col-span-1 col-span-2"},le={class:"md:col-span-1 col-span-2"},ue={class:"flex"},de={class:"text-sm text-center mt-8"};function ce(o,e,b,h,t,m){const x=s("Logo"),E=s("TextHeader"),y=s("FormErrorMessages"),C=s("Alert"),_=s("OtpInput"),F=s("MobileNumberInput"),g=s("TextInput"),S=s("PasswordInput"),V=s("ConfirmPasswordInput"),v=s("BackButton"),k=s("PrimaryButton"),T=s("SocialLinks"),R=s("router-link");return a(),l("div",te,[n("div",oe,[r(x,{class:"mx-auto"}),r(E,{class:"mt-10 text-center"},{default:f(()=>e[6]||(e[6]=[d("Create your account")])),_:1})]),n("div",se,[n("form",re,[o.hasGeneralError?(a(),w(y,{key:0})):p("",!0),t.showVerificationCode?(a(),l(u,{key:1},[r(C,null,{default:f(()=>[e[7]||(e[7]=d(" Dial ")),n("span",ie,N(t.mobileVerificationShortcode),1),e[8]||(e[8]=d(" and enter the verification code below to confirm ownership of the mobile number ")),n("span",ne,N(t.mobileNumber),1)]),_:1}),r(_,{modelValue:t.verificationCode,"onUpdate:modelValue":e[0]||(e[0]=i=>t.verificationCode=i),errorText:o.getFormError("verificationCode")},null,8,["modelValue","errorText"])],64)):(a(),l(u,{key:2},[r(F,{modelValue:t.mobileNumber,"onUpdate:modelValue":e[1]||(e[1]=i=>t.mobileNumber=i),errorText:o.getFormError("mobileNumber"),onKeydown:c(m.handleRegistration,["enter"])},null,8,["modelValue","errorText","onKeydown"]),t.accountExists==!1?(a(),l(u,{key:0},[n("div",ae,[n("div",me,[r(g,{modelValue:t.firstName,"onUpdate:modelValue":e[2]||(e[2]=i=>t.firstName=i),label:"First Name",autocomplete:"given-name",errorText:o.getFormError("firstName"),onKeydown:c(m.handleRegistration,["enter"])},null,8,["modelValue","errorText","onKeydown"])]),n("div",le,[r(g,{modelValue:t.lastName,"onUpdate:modelValue":e[3]||(e[3]=i=>t.lastName=i),label:"Last Name",autocomplete:"family-name",errorText:o.getFormError("lastName"),onKeydown:c(m.handleRegistration,["enter"])},null,8,["modelValue","errorText","onKeydown"])])]),t.firstName&&t.lastName?(a(),l(u,{key:0},[r(S,{modelValue:t.password,"onUpdate:modelValue":e[4]||(e[4]=i=>t.password=i),showForgotPassword:!1,errorText:o.getFormError("password"),onKeydown:c(m.handleRegistration,["enter"])},null,8,["modelValue","errorText","onKeydown"]),r(V,{modelValue:t.passwordConfirmation,"onUpdate:modelValue":e[5]||(e[5]=i=>t.passwordConfirmation=i),errorText:o.getFormError("passwordConfirmation"),onKeydown:c(m.handleRegistration,["enter"])},null,8,["modelValue","errorText","onKeydown"])],64)):p("",!0)],64)):p("",!0)],64)),n("div",ue,[t.showVerificationCode?(a(),w(v,{key:0,action:m.backToRegistrationForm,class:"w-16 mr-2"},null,8,["action"])):p("",!0),r(k,{action:m.handleRegistration,loading:t.isSubmitting,class:"w-full"},{default:f(()=>[t.showVerificationCode?(a(),l(u,{key:0},[d("Create Account")],64)):(a(),l(u,{key:1},[d("Continue")],64))]),_:1},8,["action","loading"])])]),r(T,{message:"Or sign up with"}),n("p",de,[e[10]||(e[10]=n("span",{class:"text-gray-500 mr-1"},"Already have an account?",-1)),r(R,{to:{name:"login"}},{default:f(()=>e[9]||(e[9]=[d("Login")])),_:1})])])])}const Be=$(ee,[["render",ce]]);export{Be as default};
