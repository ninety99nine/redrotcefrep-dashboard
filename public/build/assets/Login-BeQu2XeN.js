import{R as L,u as q,a as v,c as l,b as m,d as t,w as d,e as g,f as c,g as w,F as p,r as s,o as i,h as n,t as x}from"./app-B1nu_-kd.js";import{L as T}from"./Logo-2n9v9FX-.js";import{A as I}from"./Alert-BiijLY_g.js";import{F as U}from"./FormMixin-B0NRY9XB.js";import{U as A}from"./UtilsMixin-CBwmyCNB.js";import{T as M}from"./TextHeader-CmEhNOJT.js";import{l as B}from"./auth-repository-Cahrj844.js";import{p as K}from"./api-repository-J81KPJTo.js";import{P as H}from"./PasswordInput-C3MIYVge.js";import{O}from"./OtpInput-D_AJ0B5f.js";import{P as R}from"./PrimaryButton-DdcCdnT3.js";import{S as D}from"./SocialLinks--7yweF0G.js";import{S as G}from"./SpinningLoader-Cp2Qn_k1.js";import{u as j}from"./form-store-DRTOtX6N.js";import{M as W}from"./MobileNumberInput-DuLADOlO.js";import{F as z}from"./FormErrorMessages-BQ2AYVpX.js";import{C as J}from"./ConfirmPasswordInput-BbNdIDU5.js";import{_ as Q}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./InputErrorMessage-C8OnCEjr.js";import"./MoreInfoPopover-Bbe5_BeM.js";const X={mixins:[U,A],components:{Logo:T,Alert:I,RouterLink:L,TextHeader:M,PasswordInput:H,OtpInput:O,PrimaryButton:R,SocialLinks:D,SpinningLoader:G,MobileNumberInput:W,FormErrorMessages:z,ConfirmPasswordInput:J},data(){return{loginUrl:null,isSubmitting:!1,accountExistsUrl:null,apiState:q(),authState:v(),showPasswordConfirmation:!1,mobileVerificationShortcode:null,notificationState:j(),accountExists:!1,requiresPassword:!1,password:"",mobileNumber:"",verificationCode:"",passwordConfirmation:""}},beforeRouteEnter(r,o,u){u(h=>{r.query.hasOwnProperty("mobileNumber")&&(h.mobileNumber=r.query.mobileNumber,h.handleLogin())})},methods:{handleLogin(){this.hideFormErrors(),this.accountExists?this.attemptLogin():this.checkIfAccountExists()},checkIfAccountExists(){if(this.mobileNumber.trim()=="")this.setFormError("mobileNumber","Enter your mobile number");else if(this.accountExistsUrl!=null){this.isSubmitting=!0;const r={mobileNumber:this.mobileNumber};K(this.accountExistsUrl,r).then(o=>{this.isSubmitting=!1,this.accountExists=o.data.exists,this.accountExists?this.requiresPassword=o.data.accountSummary.requiresPassword:this.$router.push({name:"register",query:{mobileNumber:this.mobileNumber}})}).catch(o=>{this.isSubmitting=!1,this.setServerFormErrors(o)})}else this.setGeneralFormError("The accountExistsUrl does not exist")},attemptLogin(){if(this.mobileNumber.trim()=="")this.setFormError("mobileNumber","Enter your mobile number");else if(this.password.trim()=="")this.setFormError("password","Enter your password");else if(this.requiresPassword&&this.passwordConfirmation.trim()=="")this.setFormError("passwordConfirmation","Enter your password confirmation");else if(this.requiresPassword&&this.password!=this.passwordConfirmation)this.setFormError("password","Password does not match confirmation");else if(this.requiresPassword&&this.verificationCode.trim()=="")this.setFormError("verificationCode","Enter your verification code");else if(this.loginUrl!=null){this.isSubmitting=!0;let r={password:this.password,mobileNumber:this.mobileNumber};this.requiresPassword&&(r.verificationCode=this.verificationCode,r.passwordConfirmation=this.passwordConfirmation),B(r).then(o=>{if(o.status==200){this.isSubmitting=!1;const u=this.$route.query.redirect;u?this.$router.replace(u):(this.$router.replace({name:"show-stores"}),this.showSuccessfulNotification("Welcome back "+this.authState.user.firstName))}}).catch(o=>{this.isSubmitting=!1,this.setServerFormErrors(o)})}else this.setGeneralFormError("The loginUrl does not exist")}},created(){this.loginUrl=this.apiState.apiHome._links.login,this.accountExistsUrl=this.apiState.apiHome._links.accountExists,this.mobileVerificationShortcode=this.apiState.apiHome.mobileVerificationShortcode}},Y={class:"flex min-h-screen flex-col justify-center px-6 py-12 lg:px-8 bg-gray-100"},Z={class:"sm:mx-auto sm:w-full sm:max-w-sm"},$={class:"mt-10 sm:mx-auto sm:w-full sm:max-w-sm"},oo={class:"space-y-6",action:"#",method:"POST"},eo={class:"font-bold"},ro={class:"font-bold"},so={class:"text-sm text-center mt-8"};function to(r,o,u,h,e,f){const E=s("Logo"),S=s("TextHeader"),y=s("FormErrorMessages"),P=s("MobileNumberInput"),b=s("Alert"),N=s("PasswordInput"),_=s("ConfirmPasswordInput"),C=s("OtpInput"),F=s("PrimaryButton"),k=s("SocialLinks"),V=s("router-link");return i(),l("div",Y,[m("div",Z,[t(E,{class:"mx-auto"}),t(S,{class:"mt-10 text-center"},{default:d(()=>o[4]||(o[4]=[n("Sign in to your account")])),_:1})]),m("div",$,[m("form",oo,[r.hasGeneralError?(i(),g(y,{key:0})):c("",!0),t(P,{modelValue:e.mobileNumber,"onUpdate:modelValue":o[0]||(o[0]=a=>e.mobileNumber=a),errorText:r.getFormError("mobileNumber"),onKeydown:w(f.handleLogin,["enter"])},null,8,["modelValue","errorText","onKeydown"]),e.accountExists?(i(),l(p,{key:1},[e.requiresPassword?(i(),g(b,{key:0},{default:d(()=>o[5]||(o[5]=[n(" Please set a new password for your account. ")])),_:1})):c("",!0),t(N,{modelValue:e.password,"onUpdate:modelValue":o[1]||(o[1]=a=>e.password=a),showForgotPassword:!e.requiresPassword,errorText:r.getFormError("password"),onKeydown:w(f.handleLogin,["enter"])},null,8,["modelValue","showForgotPassword","errorText","onKeydown"]),e.requiresPassword?(i(),l(p,{key:1},[t(_,{modelValue:e.passwordConfirmation,"onUpdate:modelValue":o[2]||(o[2]=a=>e.passwordConfirmation=a),errorText:r.getFormError("passwordConfirmation"),onKeydown:w(f.handleLogin,["enter"])},null,8,["modelValue","errorText","onKeydown"]),t(b,null,{default:d(()=>[o[6]||(o[6]=n(" Dial ")),m("span",eo,x(e.mobileVerificationShortcode),1),o[7]||(o[7]=n(" and enter the verification code below to confirm ownership of the mobile number ")),m("span",ro,x(e.mobileNumber),1)]),_:1}),t(C,{modelValue:e.verificationCode,"onUpdate:modelValue":o[3]||(o[3]=a=>e.verificationCode=a),errorText:r.getFormError("verificationCode")},null,8,["modelValue","errorText"])],64)):c("",!0)],64)):c("",!0),t(F,{action:f.handleLogin,loading:e.isSubmitting,class:"w-full"},{default:d(()=>[e.accountExists&&e.requiresPassword?(i(),l(p,{key:0},[n("Set Password")],64)):e.accountExists&&!e.requiresPassword?(i(),l(p,{key:1},[n("Sign In")],64)):!e.accountExists&&!e.requiresPassword?(i(),l(p,{key:2},[n("Continue")],64)):c("",!0)]),_:1},8,["action","loading"])]),t(k),m("p",so,[o[9]||(o[9]=m("span",{class:"text-gray-500 mr-1"},"Don't have an account?",-1)),t(V,{to:{name:"register"}},{default:d(()=>o[8]||(o[8]=[n("Register")])),_:1})])])])}const Co=Q(X,[["render",to]]);export{Co as default};
