import{R as U,u as I,s as P,j as B,c as l,b as a,d as s,w as p,e as w,f,F as u,g as d,r,o as n,h as c,t as N}from"./app-D0qimAzV.js";import{L as K}from"./Logo-DyY95mu6.js";import{A as L}from"./Alert-CDhotiL-.js";import{F as A}from"./FormMixin-C63lX0CN.js";import{U as M}from"./UtilsMixin-CbFS-0FV.js";import{T as H}from"./TextInput-B1SJVYX2.js";import{T as O}from"./TextHeader-BfSiTDm9.js";import{B as G}from"./BackButton-Yep2Hd1P.js";import{P as q}from"./PasswordInput-BA4XLAhv.js";import{O as j}from"./OtpInput-DubhvfOg.js";import{P as D}from"./PrimaryButton-DE5VW1bd.js";import{S as W}from"./SocialLinks-CLxHQNdI.js";import{u as z}from"./form-store-Bfvic_NI.js";import{M as J}from"./MobileNumberInput-B9uBO3bG.js";import{F as Q}from"./FormErrorMessages-BONizjl2.js";import{C as X}from"./ConfirmPasswordInput-CMUeTXKp.js";import{v as Y,r as Z}from"./auth-repository-BDGi380O.js";import{_ as $}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./InputLabel-UAYg7twD.js";import"./MoreInfoPopover-CoNeH2Aq.js";import"./InputErrorMessage-DyTqa7UM.js";import"./SpinningLoader-bIOLFk1n.js";import"./api-repository-9G2HFkus.js";const ee={mixins:[A,M],components:{Logo:K,Alert:L,RouterLink:U,TextInput:H,TextHeader:O,BackButton:G,PasswordInput:q,OtpInput:j,PrimaryButton:D,SocialLinks:W,MobileNumberInput:J,FormErrorMessages:Q,ConfirmPasswordInput:X},data(){return{registerUrl:null,isSubmitting:!1,accountExistsUrl:null,apiState:I(),validateRegisterUrl:null,appName:P.appName,mobileVerificationShortcode:null,notificationState:z(),accountExists:null,showVerificationCode:!1,lastName:"",password:"",firstName:"",mobileNumber:"",verificationCode:"",passwordConfirmation:""}},beforeRouteEnter(o,e,b){b(h=>{o.query.hasOwnProperty("mobileNumber")&&(h.mobileNumber=o.query.mobileNumber,h.handleRegistration())})},methods:{handleRegistration(){this.hideFormErrors(),this.showVerificationCode?this.attemptRegistration():this.accountExists==null?this.checkIfAccountExists():this.validateRegistration()},checkIfAccountExists(){this.mobileNumber.trim()==""?this.setFormError("mobileNumber","Enter your mobile number"):this.accountExistsUrl!=null?(this.isSubmitting=!0,B.post(this.accountExistsUrl,{mobileNumber:this.mobileNumber}).then(o=>{this.isSubmitting=!1,this.accountExists=o.data.exists,this.accountExists&&this.$router.push({name:"login",query:{mobileNumber:this.mobileNumber}})}).catch(o=>{this.isSubmitting=!1,this.setServerFormErrors(o)})):this.setGeneralFormError("The accountExistsUrl does not exist")},validateRegistration(){if(this.firstName.trim()=="")this.setFormError("firstName","Enter your first name");else if(this.lastName.trim()=="")this.setFormError("lastName","Enter your last name");else if(this.mobileNumber.trim()=="")this.setFormError("mobileNumber","Enter your mobile number");else if(this.password.trim()=="")this.setFormError("password","Enter your password");else if(this.passwordConfirmation.trim()=="")this.setFormError("passwordConfirmation","Enter your password confirmation");else if(this.password!=this.passwordConfirmation)this.setFormError("password","Password does not match confirmation");else if(this.validateRegisterUrl!=null){this.isSubmitting=!0;let o={lastName:this.lastName,password:this.password,firstName:this.firstName,mobileNumber:this.mobileNumber,passwordConfirmation:this.passwordConfirmation};Y(o).then(e=>{e.status==200&&(this.isSubmitting=!1,this.showVerificationCode=!0)}).catch(e=>{this.isSubmitting=!1,this.setServerFormErrors(e)})}else this.setGeneralFormError("The validateRegisterUrl does not exist")},attemptRegistration(){if(this.verificationCode.trim()=="")this.setFormError("verificationCode","Enter your verification code");else if(this.registerUrl!=null){this.isSubmitting=!0;let o={lastName:this.lastName,password:this.password,firstName:this.firstName,mobileNumber:this.mobileNumber,verificationCode:this.verificationCode,passwordConfirmation:this.passwordConfirmation};Z(o).then(e=>{e.status==200&&(this.isSubmitting=!1,this.$router.replace({name:"dashboard"}),this.showSuccessfulNotification("Welcome to "+this.appName))}).catch(e=>{this.isSubmitting=!1,this.setServerFormErrors(e)})}else this.setGeneralFormError("The registerUrl does not exist")},backToRegistrationForm(){this.showVerificationCode=!1}},created(){this.registerUrl=this.apiState.apiHome._links.register,this.accountExistsUrl=this.apiState.apiHome._links.accountExists,this.validateRegisterUrl=this.apiState.apiHome._links.validateRegister,this.mobileVerificationShortcode=this.apiState.apiHome.mobileVerificationShortcode}},te={class:"flex min-h-screen flex-col justify-center px-6 py-12 lg:px-8 bg-gray-100"},oe={class:"sm:mx-auto sm:w-full sm:max-w-sm"},re={class:"mt-10 sm:mx-auto sm:w-full sm:max-w-sm"},se={class:"space-y-6",action:"#",method:"POST"},ie={class:"font-bold"},ae={class:"font-bold"},ne={class:"grid grid-cols-2 gap-4"},me={class:"md:col-span-1 col-span-2"},le={class:"md:col-span-1 col-span-2"},ue={class:"flex"},ce={class:"text-sm text-center mt-8"},de=a("span",{class:"text-gray-500 mr-1"},"Already have an account?",-1);function pe(o,e,b,h,t,m){const x=r("Logo"),_=r("TextHeader"),E=r("FormErrorMessages"),y=r("Alert"),C=r("OtpInput"),F=r("MobileNumberInput"),g=r("TextInput"),S=r("PasswordInput"),V=r("ConfirmPasswordInput"),v=r("BackButton"),k=r("PrimaryButton"),T=r("SocialLinks"),R=r("router-link");return n(),l("div",te,[a("div",oe,[s(x,{class:"mx-auto"}),s(_,{class:"mt-10 text-center"},{default:p(()=>[c("Create your account")]),_:1})]),a("div",re,[a("form",se,[o.hasGeneralError?(n(),w(E,{key:0})):f("",!0),t.showVerificationCode?(n(),l(u,{key:1},[s(y,null,{default:p(()=>[c(" Dial "),a("span",ie,N(t.mobileVerificationShortcode),1),c(" and enter the verification code below to confirm ownership of the mobile number "),a("span",ae,N(t.mobileNumber),1)]),_:1}),s(C,{modelValue:t.verificationCode,"onUpdate:modelValue":e[0]||(e[0]=i=>t.verificationCode=i),errorText:o.getFormError("verificationCode")},null,8,["modelValue","errorText"])],64)):(n(),l(u,{key:2},[s(F,{modelValue:t.mobileNumber,"onUpdate:modelValue":e[1]||(e[1]=i=>t.mobileNumber=i),errorText:o.getFormError("mobileNumber"),onKeydown:d(m.handleRegistration,["enter"])},null,8,["modelValue","errorText","onKeydown"]),t.accountExists==!1?(n(),l(u,{key:0},[a("div",ne,[a("div",me,[s(g,{modelValue:t.firstName,"onUpdate:modelValue":e[2]||(e[2]=i=>t.firstName=i),label:"First Name",autocomplete:"given-name",errorText:o.getFormError("firstName"),onKeydown:d(m.handleRegistration,["enter"])},null,8,["modelValue","errorText","onKeydown"])]),a("div",le,[s(g,{modelValue:t.lastName,"onUpdate:modelValue":e[3]||(e[3]=i=>t.lastName=i),label:"Last Name",autocomplete:"family-name",errorText:o.getFormError("lastName"),onKeydown:d(m.handleRegistration,["enter"])},null,8,["modelValue","errorText","onKeydown"])])]),t.firstName&&t.lastName?(n(),l(u,{key:0},[s(S,{modelValue:t.password,"onUpdate:modelValue":e[4]||(e[4]=i=>t.password=i),showForgotPassword:!1,errorText:o.getFormError("password"),onKeydown:d(m.handleRegistration,["enter"])},null,8,["modelValue","errorText","onKeydown"]),s(V,{modelValue:t.passwordConfirmation,"onUpdate:modelValue":e[5]||(e[5]=i=>t.passwordConfirmation=i),errorText:o.getFormError("passwordConfirmation"),onKeydown:d(m.handleRegistration,["enter"])},null,8,["modelValue","errorText","onKeydown"])],64)):f("",!0)],64)):f("",!0)],64)),a("div",ue,[t.showVerificationCode?(n(),w(v,{key:0,action:m.backToRegistrationForm,class:"w-16 mr-2"},null,8,["action"])):f("",!0),s(k,{action:m.handleRegistration,loading:t.isSubmitting,class:"w-full"},{default:p(()=>[t.showVerificationCode?(n(),l(u,{key:0},[c("Create Account")],64)):(n(),l(u,{key:1},[c("Continue")],64))]),_:1},8,["action","loading"])])]),s(T,{message:"Or sign up with"}),a("p",ce,[de,s(R,{to:{name:"login"}},{default:p(()=>[c("Login")]),_:1})])])])}const Le=$(ee,[["render",pe]]);export{Le as default};
