import{R as V,u as k,e as q,f as U,c as l,a as m,b as r,w as u,g as b,F as d,h as x,i as f,r as s,o as n,d as i,t as g}from"./app-DgwDG0oL.js";import{L as v}from"./Logo-1z0bYkRh.js";import{A as T}from"./Alert-DeOdG3YV.js";import{F as I,u as L}from"./FormMixin-Bl09yP4i.js";import{U as A}from"./SpiningLoader-CtP8XMxq.js";import{T as B}from"./TextHeader-Cv0Yig1G.js";import{l as K}from"./auth-repository-CxMWyXAE.js";import{P as H,C as M}from"./ConfirmPasswordInput-B10PR3av.js";import{O}from"./OtpInput-B5YmCNin.js";import{P as R}from"./PrimaryButton-BwxTXQIn.js";import{M as D}from"./MobileNumberInput-Dy4e2HdE.js";import{_ as G}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./InputLabel-h7tVZV7a.js";import"./MoreInfoPopover-CikMcfV_.js";import"./InputErrorMessage-MOiSGfLL.js";const j={mixins:[I,A],components:{Logo:v,Alert:T,RouterLink:V,TextHeader:B,PasswordInput:H,OtpInput:O,PrimaryButton:R,MobileNumberInput:D,ConfirmPasswordInput:M},data(){return{loginUrl:null,isSubmitting:!1,accountExistsUrl:null,apiState:k(),authState:q(),showPasswordConfirmation:!1,mobileVerificationShortcode:null,notificationState:L(),accountExists:!1,requiresPassword:!1,password:"",mobileNumber:"",verificationCode:"",passwordConfirmation:""}},beforeRouteEnter(o,t,c){c(p=>{o.query.hasOwnProperty("mobileNumber")&&(p.mobileNumber=o.query.mobileNumber,p.handleLogin())})},methods:{setUrls(){this.loginUrl=this.apiState.apiHome._links.login,this.accountExistsUrl=this.apiState.apiHome._links.accountExists,this.mobileVerificationShortcode=this.apiState.apiHome.mobileVerificationShortcode},handleLogin(){this.hideFormErrors(),this.accountExists?this.attemptLogin():this.checkIfAccountExists()},checkIfAccountExists(){this.mobileNumber.trim()==""?this.setFormError("mobileNumber","Enter your mobile number"):this.accountExistsUrl!=null?(this.isSubmitting=!0,U.post(this.accountExistsUrl,{mobileNumber:this.mobileNumber}).then(o=>{this.isSubmitting=!1,this.accountExists=o.data.exists,this.accountExists?this.requiresPassword=o.data.accountSummary.requiresPassword:this.$router.push({name:"register",query:{mobileNumber:this.mobileNumber}})}).catch(o=>{this.isSubmitting=!1,this.setServerFormErrors(o)})):this.setGeneralFormError("The accountExistsUrl does not exist")},attemptLogin(){if(this.mobileNumber.trim()=="")this.setFormError("mobileNumber","Enter your mobile number");else if(this.password.trim()=="")this.setFormError("password","Enter your password");else if(this.requiresPassword&&this.passwordConfirmation.trim()=="")this.setFormError("passwordConfirmation","Enter your password confirmation");else if(this.requiresPassword&&this.password!=this.passwordConfirmation)this.setFormError("password","Password does not match confirmation");else if(this.requiresPassword&&this.verificationCode.trim()=="")this.setFormError("verificationCode","Enter your verification code");else if(this.loginUrl!=null){this.isSubmitting=!0;let o={password:this.password,mobileNumber:this.mobileNumber};this.requiresPassword&&(o.verificationCode=this.verificationCode,o.passwordConfirmation=this.passwordConfirmation),K(o).then(t=>{if(t.status==200){this.isSubmitting=!1;const c=this.$route.query.redirect;c?this.$router.replace(c):(this.$router.replace({name:"dashboard"}),this.showSuccessfulNotification("Welcome back "+this.authState.user.firstName))}}).catch(t=>{this.isSubmitting=!1,this.setServerFormErrors(t)})}else this.setGeneralFormError("The loginUrl does not exist")}},created(){this.setUrls()}},W={class:"flex min-h-full flex-col justify-center px-6 py-12 lg:px-8"},z={class:"sm:mx-auto sm:w-full sm:max-w-sm"},J={class:"mt-10 sm:mx-auto sm:w-full sm:max-w-sm"},Q={class:"space-y-6",action:"#",method:"POST"},X={class:"font-bold"},Y={class:"font-bold"},Z={class:"text-sm text-center mt-8"},$=m("span",{class:"text-gray-500 mr-1"},"Don't have an account?",-1);function ee(o,t,c,p,e,h){const E=s("Logo"),_=s("TextHeader"),y=s("MobileNumberInput"),w=s("Alert"),P=s("PasswordInput"),S=s("ConfirmPasswordInput"),N=s("OtpInput"),C=s("PrimaryButton"),F=s("router-link");return n(),l("div",W,[m("div",z,[r(E,{class:"mx-auto"}),r(_,{class:"mt-10 text-center"},{default:u(()=>[i("Sign in to your account")]),_:1})]),m("div",J,[m("form",Q,[r(y,{modelValue:e.mobileNumber,"onUpdate:modelValue":t[0]||(t[0]=a=>e.mobileNumber=a),errorText:o.getFormError("mobileNumber"),onKeydown:b(h.handleLogin,["enter"])},null,8,["modelValue","errorText","onKeydown"]),e.accountExists?(n(),l(d,{key:0},[e.requiresPassword?(n(),x(w,{key:0},{default:u(()=>[i(" Please set a new password for your account. ")]),_:1})):f("",!0),r(P,{modelValue:e.password,"onUpdate:modelValue":t[1]||(t[1]=a=>e.password=a),showForgotPassword:!e.requiresPassword,errorText:o.getFormError("password"),onKeydown:b(h.handleLogin,["enter"])},null,8,["modelValue","showForgotPassword","errorText","onKeydown"]),e.requiresPassword?(n(),l(d,{key:1},[r(S,{modelValue:e.passwordConfirmation,"onUpdate:modelValue":t[2]||(t[2]=a=>e.passwordConfirmation=a),errorText:o.getFormError("passwordConfirmation"),onKeydown:b(h.handleLogin,["enter"])},null,8,["modelValue","errorText","onKeydown"]),r(w,null,{default:u(()=>[i(" Dial "),m("span",X,g(e.mobileVerificationShortcode),1),i(" and enter the verification code below to confirm ownership of the mobile number "),m("span",Y,g(e.mobileNumber),1)]),_:1}),r(N,{modelValue:e.verificationCode,"onUpdate:modelValue":t[3]||(t[3]=a=>e.verificationCode=a),errorText:o.getFormError("verificationCode")},null,8,["modelValue","errorText"])],64)):f("",!0)],64)):f("",!0),o.getFormError("general")?(n(),x(w,{key:1,class:"mt-4 mb-0 mx-auto max-w-96",type:"warning"},{default:u(()=>[i(g(o.getFormError("general")),1)]),_:1})):f("",!0),r(C,{action:h.handleLogin,loading:e.isSubmitting,class:"w-full"},{default:u(()=>[e.accountExists&&e.requiresPassword?(n(),l(d,{key:0},[i("Set Password")],64)):e.accountExists&&!e.requiresPassword?(n(),l(d,{key:1},[i("Sign In")],64)):!e.accountExists&&!e.requiresPassword?(n(),l(d,{key:2},[i("Continue")],64)):f("",!0)]),_:1},8,["action","loading"])]),m("p",Z,[$,r(F,{to:{name:"register"}},{default:u(()=>[i("Register")]),_:1})])])])}const we=G(j,[["render",ee]]);export{we as default};
