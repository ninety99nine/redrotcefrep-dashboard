import{o as l,c as u,b as i,w as m,d as a,a as s,p as I,v as E,n as _,r as n,u as F,e as k,q as U,F as w,i as c,h as D,t as g}from"./app-vGTXn0df.js";import{A as B}from"./Alert-CABMwZBp.js";import{F as q,u as A}from"./FormMixin-De7YsbPB.js";import{T as j}from"./TextInput-ComNA6kP.js";import{P as z,u as L}from"./ProfilePhoto-CRTSgxSG.js";import{T as O}from"./TextareaInput-ClN36YC5.js";import{P as H,C as G}from"./ConfirmPasswordInput-Jj5MRWnx.js";import{O as J}from"./OtpInput-CTfjuvjq.js";import{P as K}from"./PrimaryButton-fdKtSp2v.js";import{M as Q}from"./MoreInfoPopover-7d45rrBN.js";import{T as R}from"./ToogleSwitch-Bkh6AokP.js";import{M as W}from"./MobileNumberInput-DHngtn-p.js";import{U as X}from"./SpiningLoader-BKOTtNJv.js";import{I as Y}from"./InputLabel-DMWhAcOL.js";import{I as Z}from"./InputErrorMessage-C8nReIq1.js";import{_ as V}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./api-repository-DOiLuzo7.js";const $={props:{modelValue:{type:String},labelPopoverTitle:{type:String},labelPopoverDescription:{type:String},errorText:{type:String}},mixins:[X],components:{InputLabel:Y,InputErrorMessage:Z},data(){return{showPassword:!1,localModelValue:this.modelValue,uniqueId:this.generateUniqueId("current_password")}},watch:{modelValue(r,o){this.updateValue(r)},localModelValue(r,o){this.$emit("update:modelValue",r)}},methods:{updateValue(r){this.localModelValue=r}}},ee={class:"mt-2 relative"},oe=["id","name","type"],re={class:"absolute inset-y-0 right-0 flex items-center pr-3"},te=["xmlns"],se=s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 12a2 2 0 100-4 2 2 0 000 4z"},null,-1),ie=s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M18 10a8.001 8.001 0 11-16 0 8.001 8.001 0 0116 0z"},null,-1),ne=[se,ie],ae=["xmlns"],le=s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"},null,-1),ue=s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 12a7.5 7.5 0 1114.999-1.5L19.5 12H5z"},null,-1),me=[le,ue];function de(r,o,d,M,e,b){const f=n("InputLabel"),h=n("InputErrorMessage");return l(),u("div",null,[i(f,{_for:e.uniqueId,labelPopoverTitle:d.labelPopoverTitle,labelPopoverDescription:d.labelPopoverDescription},{default:m(()=>[a(" Current Password ")]),_:1},8,["_for","labelPopoverTitle","labelPopoverDescription"]),s("div",ee,[I(s("input",{"onUpdate:modelValue":o[0]||(o[0]=p=>e.localModelValue=p),id:e.uniqueId,name:e.uniqueId,type:e.showPassword?"text":"password",autocomplete:"current-password",required:"",class:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-blue-700 sm:text-sm sm:leading-6 px-3"},null,8,oe),[[E,e.localModelValue]]),s("div",re,[s("button",{onClick:o[1]||(o[1]=p=>e.showPassword=!e.showPassword),type:"button",class:"text-gray-400 hover:text-gray-700 focus:outline-none focus:text-gray-700"},[(l(),u("svg",{class:_(["h-5 w-5",{hidden:!e.showPassword,block:e.showPassword}]),fill:"none",xmlns:e.showPassword?"http://www.w3.org/2000/svg":"",viewBox:"0 0 20 20",stroke:"currentColor"},ne,10,te)),(l(),u("svg",{class:_(["h-5 w-5",{block:!e.showPassword,hidden:e.showPassword}]),fill:"none",xmlns:e.showPassword?"":"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",stroke:"currentColor"},me,10,ae))])])]),i(h,{errorText:d.errorText},null,8,["errorText"])])}const he=V($,[["render",de]]),pe={mixins:[q],components:{Alert:B,TextInput:j,TextareaInput:O,PasswordInput:H,OtpInput:J,PrimaryButton:K,MoreInfoPopover:Q,ProfilePhoto:z,ToogleSwitch:R,MobileNumberInput:W,ConfirmPasswordInput:G,CurrentPasswordInput:he},data(){return{isSubmitting:!1,changePassword:!1,apiState:F(),authState:k(),changeMobileNumber:!1,notificationState:A(),aboutMe:"",lastName:"",firstName:"",password:"",mobileNumber:"",currentPassword:"",verificationCode:"",originalMobileNumber:"",passwordConfirmation:"",mobileVerificationShortcode:null}},computed:{hasChangedMobileNumber(){return this.originalMobileNumber.length==8&&this.originalMobileNumber!=this.mobileNumber}},methods:{setUserDetails(){this.aboutMe=this.authState.user.aboutMe,this.lastName=this.authState.user.lastName,this.firstName=this.authState.user.firstName,this.mobileNumber=this.authState.user.mobileNumber.national,this.originalMobileNumber=this.authState.user.mobileNumber.national,this.mobileVerificationShortcode=this.apiState.apiHome.mobileVerificationShortcode},updateUser(){if(this.hideFormErrors(),this.firstName.trim()=="")this.setFormError("firstName","Enter your first name");else if(this.lastName.trim()=="")this.setFormError("lastName","Enter your last name");else if(this.changePassword&&this.currentPassword.trim()=="")this.setFormError("currentPassword","Enter your current password");else if(this.changePassword&&this.password.trim()=="")this.setFormError("password","Enter your password");else if(this.changePassword&&this.passwordConfirmation.trim()=="")this.setFormError("passwordConfirmation","Enter your password confirmation");else if(this.changePassword&&this.password!=this.passwordConfirmation)this.setFormError("password","Password does not match confirmation");else if(this.changeMobileNumber&&this.mobileNumber.trim()=="")this.setFormError("mobileNumber","Enter your mobile number");else if(this.changeMobileNumber&&this.hasChangedMobileNumber&&this.verificationCode.trim()=="")this.setFormError("verificationCode","Enter your verification code");else{let r={lastName:this.lastName,firstName:this.firstName};this.aboutMe!=null&&this.aboutMe.length&&(r.aboutMe=this.aboutMe),this.changePassword&&(r.password=this.password,r.currentPassword=this.currentPassword,r.passwordConfirmation=this.passwordConfirmation),this.changeMobileNumber&&this.hasChangedMobileNumber&&(r.mobileNumber=this.mobileNumber,r.verificationCode=this.verificationCode),this.isSubmitting=!0,L(this.authState.user,r).then(o=>{o.status==200&&(this.isSubmitting=!1,this.password="",this.currentPassword="",this.changePassword=!1,this.passwordConfirmation="",this.changeMobileNumber=!1,this.originalMobileNumber=this.mobileNumber,this.authState.user=o.data,this.showSuccessfulNotification("Profile updated"))}).catch(o=>{this.isSubmitting=!1,this.setServerFormErrors(o)})}}},mounted(){U()},created(){this.setUserDetails()}},ce={class:"px-16 pt-8"},be={class:"flex min-h-full flex-col justify-center"},fe={class:"sm:mx-auto sm:w-full sm:max-w-md p-4 bg-white border border-gray-200 rounded-lg shadow sm:p-6"},we={class:"mt-10 space-y-6",action:"#",method:"POST"},ge={class:"grid grid-cols-2 gap-4"},Pe={class:"md:col-span-1 col-span-2"},Ne={class:"md:col-span-1 col-span-2"},_e={class:"md:col-span-2"},Ve={class:"font-bold"},Me={class:"font-bold"};function xe(r,o,d,M,e,b){const f=n("ProfilePhoto"),h=n("TextInput"),p=n("TextareaInput"),P=n("ToogleSwitch"),x=n("CurrentPasswordInput"),v=n("PasswordInput"),C=n("ConfirmPasswordInput"),y=n("MobileNumberInput"),N=n("Alert"),T=n("OtpInput"),S=n("PrimaryButton");return l(),u("div",ce,[s("div",be,[s("div",fe,[i(f,{user:e.authState.user,class:"mx-auto",width:"w-40",height:"h-40"},null,8,["user"]),s("form",we,[s("div",ge,[s("div",Pe,[i(h,{modelValue:e.firstName,"onUpdate:modelValue":o[0]||(o[0]=t=>e.firstName=t),label:"First Name",autocomplete:"given-name",errorText:r.getFormError("firstName")},null,8,["modelValue","errorText"])]),s("div",Ne,[i(h,{label:"Last Name",modelValue:e.lastName,"onUpdate:modelValue":o[1]||(o[1]=t=>e.lastName=t),autocomplete:"family-name",errorText:r.getFormError("lastName")},null,8,["modelValue","errorText"])]),s("div",_e,[i(p,{rows:2,label:"About Me",modelValue:e.aboutMe,"onUpdate:modelValue":o[2]||(o[2]=t=>e.aboutMe=t),errorText:r.getFormError("aboutMe"),placeholder:"Say something about yourself"},null,8,["modelValue","errorText"])])]),i(P,{modelValue:e.changePassword,"onUpdate:modelValue":o[3]||(o[3]=t=>e.changePassword=t)},{default:m(()=>[a("Change Password")]),_:1},8,["modelValue"]),e.changePassword?(l(),u(w,{key:0},[i(x,{modelValue:e.currentPassword,"onUpdate:modelValue":o[4]||(o[4]=t=>e.currentPassword=t),showForgotPassword:!1,errorText:r.getFormError("currentPassword")},null,8,["modelValue","errorText"]),i(v,{modelValue:e.password,"onUpdate:modelValue":o[5]||(o[5]=t=>e.password=t),showForgotPassword:!1,errorText:r.getFormError("password")},null,8,["modelValue","errorText"]),i(C,{modelValue:e.passwordConfirmation,"onUpdate:modelValue":o[6]||(o[6]=t=>e.passwordConfirmation=t),errorText:r.getFormError("passwordConfirmation")},null,8,["modelValue","errorText"])],64)):c("",!0),i(P,{modelValue:e.changeMobileNumber,"onUpdate:modelValue":o[7]||(o[7]=t=>e.changeMobileNumber=t)},{default:m(()=>[a("Change Mobile Number")]),_:1},8,["modelValue"]),e.changeMobileNumber?(l(),u(w,{key:1},[i(y,{modelValue:e.mobileNumber,"onUpdate:modelValue":o[8]||(o[8]=t=>e.mobileNumber=t),errorText:r.getFormError("mobileNumber")},null,8,["modelValue","errorText"]),b.hasChangedMobileNumber?(l(),u(w,{key:0},[i(N,null,{default:m(()=>[a(" Dial "),s("span",Ve,g(e.mobileVerificationShortcode),1),a(" on "),s("span",Me,g(e.mobileNumber),1),a(" to confirm ownership of this mobile number. ")]),_:1}),i(T,{modelValue:e.verificationCode,"onUpdate:modelValue":o[9]||(o[9]=t=>e.verificationCode=t),errorText:r.getFormError("verificationCode")},null,8,["modelValue","errorText"])],64)):c("",!0)],64)):c("",!0),r.getFormError("general")?(l(),D(N,{key:2,class:"mt-4 mb-0 mx-auto max-w-96",type:"warning"},{default:m(()=>[a(g(r.getFormError("general")),1)]),_:1})):c("",!0),i(S,{action:b.updateUser,loading:e.isSubmitting,class:"w-full"},{default:m(()=>[a(" Save Changes ")]),_:1},8,["action","loading"])])])])])}const Oe=V(pe,[["render",xe]]);export{Oe as default};
