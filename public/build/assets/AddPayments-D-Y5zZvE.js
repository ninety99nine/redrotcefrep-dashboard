import{S as B}from"./StoreLogo-ziCqDjEi.js";import{P as W}from"./PrimaryButton-CdUsybiR.js";import{z as q,u as Q,r as v,o as d,e as b,A as z,w as E,b as r,t as S,_ as N,c as m,d as L,h as R,m as Z,f as _,F as C,k as O,n as j,i as Y,p as G,T as K}from"./app-Clb7lIWV.js";import{c as U,i as $}from"./cloneDeep-BSUglKOW.js";import{a as X,u as J}from"./form-store-Dk2TW4Pk.js";import{u as ee}from"./store-store-DPJy4MMa.js";import{g as A,p as H,a as te,d as ae}from"./api-repository-DcNefVxR.js";import{T as oe}from"./ToogleSwitch-D0cJjzlr.js";import{T}from"./TextInput-DiBRzgNx.js";import{_ as P}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{E as ie}from"./EmailInput-CR8x6Umz.js";import{I as se}from"./InputErrorMessage-DSzrxfHf.js";import{S as ne}from"./SelectInput-BV1Lk05R.js";import{M as le}from"./MobileNumberInput-BOopRg24.js";import"./FormMixin-Cs0nwSp2.js";import"./SpinningLoader-D5lul-fU.js";import"./UtilsMixin-CBwmyCNB.js";import"./MoreInfoPopover-DKoXncPa.js";const D=q("onboarding",{state:()=>({pagination:null,uploadMessage:"",paymentMethods:[],isUploading:!1,totalCompletedSteps:0,apiState:Q(),totalCompletedUploads:0,formState:X(),originalPaymentMethods:[],storeState:ee(),associatedPaymentMethods:[],unassociatedPaymentMethods:[],isCreatingPaymentMethod:!1,isSubmittingPaymentMethods:!1,notificationState:J(),isLoadingUnassociatedPaymentMethods:!1}),actions:{reset(){this.pagination=null,this.uploadMessage="",this.paymentMethods=[],this.isUploading=!1,this.totalCompletedSteps=0,this.totalCompletedUploads=0,this.originalPaymentMethods=[],this.associatedPaymentMethods=[],this.unassociatedPaymentMethods=[],this.isCreatingPaymentMethod=!1,this.isSubmittingPaymentMethods=!1,this.isLoadingUnassociatedPaymentMethods=!1},getPaymentMethodValidationErrors(a,e){var i,s;let t=[];if(!a.hasOwnProperty("validationRules"))return t;const o=e[a.attribute];if(a.validationRules.hasOwnProperty("required")){const[n,l]=a.validationRules.required;n&&(o==null||typeof o=="string"&&o.trim()===""||typeof o=="object"&&Object.keys(o).length===0||Array.isArray(o)&&o.length===0)&&t.push(l)}if(a.validationRules.hasOwnProperty("regexPattern")){const[n,l]=a.validationRules.regexPattern;if(typeof o=="string")try{new RegExp(n).test(o.trim())||t.push(l)}catch{console.error("Invalid regex pattern:",n)}}if((i=a.validationRules)!=null&&i.qrCode){const[n]=a.validationRules.qrCode;(!o||!o.validQR)&&t.push(n)}if((s=a.validationRules)!=null&&s.mimeTypes){const[n,l]=a.validationRules.mimeTypes;if(o&&o.fileRef){const u=o.fileRef.type;n.includes(u)||t.push(l)}}if(a.validationRules.hasOwnProperty("maxSize")){const[n,l]=a.validationRules.maxSize;o!=null&&o.fileRef&&o.fileRef.size>n&&t.push(l)}return t},getPaymentMethodFirstValidationError(a,e){const t=this.getPaymentMethodValidationErrors(a,e);return t.length?t[0]:null},checkIfPaymentMethodConfigSchemaEntityPassesCondition(a,e){return a.hasOwnProperty("condition")?a.condition.every(t=>{const o=t.match(/^([^!=]+)(!=|=)(.+)$/);if(!o)return console.warn(`Invalid condition format: ${t}`),!1;const[,i,s,n]=o.map(l=>l.trim());return e.hasOwnProperty(i)?s==="="?e[i]===n:s==="!="?e[i]!==n:!1:!1}):!0},setPaymentMethods(){this.paymentMethods=U([...this.associatedPaymentMethods,...this.unassociatedPaymentMethods]),this.setOriginalPaymentMethods()},setOriginalPaymentMethods(){this.originalPaymentMethods=U(this.paymentMethods)},showAssociatedPaymentMethods(){this.isLoadingAssociatedPaymentMethods=!0;const a={storeId:this.store.id,_relationships:"paymentMethod,photo,logo"};A(this.apiState.apiHome._links.showStorePaymentMethods,a).then(e=>{e.status==200&&(this.pagination=e.data,this.associatedPaymentMethods=this.pagination.data.map(t=>{const o=t._relationships.logo,i=t._relationships.photo,s=t._relationships.paymentMethod;let n=Object.fromEntries(s.configSchema.filter(u=>!["content"].includes(u.type)).map(u=>[u.attribute,u.default??null]));n={...n,...t.configs??{}};let l={configs:n,id:s.id,name:s.name,type:s.type,active:t.active,logo:s._attributes.imageUrl,configSchema:s.configSchema,customName:t.customName,_links:t._links};return s.configSchema.forEach(u=>{u.type==="image"&&u.attribute=="logo"?l.configs[u.attribute]={filePath:o?o.filePath:null,deleting:!1}:u.type==="image"&&u.attribute=="photo"&&(l.configs[u.attribute]={filePath:i?i.filePath:null,deleting:!1})}),l}),this.setPaymentMethods()),this.isLoadingAssociatedPaymentMethods=!1}).catch(e=>{this.isLoadingAssociatedPaymentMethods=!1,this.formState.setServerFormErrors(e)})},showUnassociatedPaymentMethods(){this.isLoadingUnassociatedPaymentMethods=!0;const a={storeId:this.store.id,association:"unassociated"};A(this.apiState.apiHome._links.showPaymentMethods,a).then(e=>{e.status==200&&(this.pagination=e.data,this.unassociatedPaymentMethods=this.pagination.data.map(t=>{let o={active:!1,id:t.id,name:t.name,type:t.type,customName:t.name,logo:t._attributes.imageUrl,configSchema:t.configSchema,configs:Object.fromEntries(t.configSchema.filter(i=>!["content"].includes(i.type)).map(i=>[i.attribute,i.default??null]))};return t.configSchema.forEach(i=>{i.type==="image"&&(o.configs[i.attribute]={filePath:null})}),o}),this.setPaymentMethods()),this.isLoadingUnassociatedPaymentMethods=!1}).catch(e=>{this.isLoadingUnassociatedPaymentMethods=!1,this.formState.setServerFormErrors(e)})},async submitPaymentMethods(){this.isSubmittingPaymentMethods=!0;let a=this.changedPaymentMethods.map(e=>{if(e._links)return this.updatePaymentMethod(e);if(e.active)return this.addPaymentMethod(e)});await Promise.allSettled(a).then(e=>{let t=0,o=[];e.forEach((i,s)=>{var n;i.status==="fulfilled"?t++:(o.push(`Payment method ${s+1}: ${((n=i.reason)==null?void 0:n.message)||"An error occurred"}`),this.formErrorMessagesIndex=s,this.formState.setServerFormErrors(i.reason,s))}),t&&(this.hasAssociatedPaymentMethods?this.notificationState.addSuccessNotification("Payment methods updated!"):this.notificationState.addSuccessNotification("Payment methods added!")),o.length>0&&this.notificationState.addWarningNotification(o.join(`
`))}).catch(e=>{this.notificationState.addWarningNotification("An unexpected error occurred while submitting payment methods."),console.error(e)}).finally(()=>{this.isSubmittingPaymentMethods=!1})},async addPaymentMethod(a){if(a._links)return;let e={return:"1",storeId:this.store.id,active:a.active,configs:a.configs,paymentMethodId:a.id,customName:a.customName};this.uploadMessage=`Creating ${a.name}`;try{const t=this.apiState.apiHome._links.createStorePaymentMethod,o=await H(t,e);if(o.status===200&&o.data.created==!0){this.totalCompletedSteps<this.totalCompletionSteps&&this.totalCompletedSteps++;let i=o.data.storePaymentMethod;a._links=i._links,await this.uploadStorePaymentMethodImages(a)}}catch(t){console.error("❌ Failed to add payment method:",t)}},async updatePaymentMethod(a){if(!a._links)return;let e={active:a.active,configs:a.configs,customName:a.customName};try{const t=await te(a._links.updateStorePaymentMethod,e);t.status===200&&t.data.updated==!0&&this.totalCompletedSteps<this.totalCompletionSteps&&this.totalCompletedSteps++}catch(t){console.error("❌ Failed to update payment method:",t)}},async uploadStorePaymentMethodImages(a){if(!a._links)return;let e=a.configSchema.filter(i=>i.type==="image").map(i=>{const s=a.configs[i.attribute];return s!=null&&s.fileRef?this.uploadSinglePaymentMethodImage(a,i.attribute):null}).filter(Boolean);if(e.length===0)return;this.isUploading=!0,this.uploadMessage="Uploading images...";let o=(await Promise.allSettled(e)).filter(i=>i.status==="rejected").length;o>0&&this.notificationState.addWarningNotification(`⚠️ ${o} image(s) failed to upload. You can retry manually.`),this.isUploading=!1},async uploadSinglePaymentMethodImage(a,e,t=0){if(!a._links)return;if(t>2)return console.warn(`❌ Image upload for '${a.name}' failed after 3 attempts.`),a.configs[e].uploaded=!1,Promise.reject("Failed after 3 attempts");let o=null,i=new FormData;if(i.append("return","1"),e==="logo")o=a._links.uploadStorePaymentMethodLogo,i.append("store_payment_method_logo",a.configs.logo.fileRef);else if(e==="photo")o=a._links.uploadStorePaymentMethodPhoto,i.append("store_payment_method_photo",a.configs.photo.fileRef);else{console.warn(`❌ The ${e} upload URL has not been provided for '${a.name}'`);return}a.configs[e].uploading=!0;try{const s=await H(o,i,{headers:{"Content-Type":"multipart/form-data"}});if(s.status===200&&s.data.uploaded==!0)return this.totalCompletedSteps<this.totalCompletionSteps&&this.totalCompletedSteps++,this.totalCompletedUploads++,a.configs[e]={uploaded:!0,deleting:!1,filePath:s.data.mediaFile.filePath},console.log(`✅ Image for '${a.name}' uploaded successfully.`),this.uploadMessage=`Uploaded ${this.totalCompletedUploads}/${this.totalUploads} images`,s;throw new Error("Upload failed")}catch{console.error(`⚠️ Image upload for '${a.name}' attempt ${t+1} failed.`),await new Promise(n=>setTimeout(n,2e3)),await this.uploadSinglePaymentMethodImage(a,e,t+1)}finally{a.configs[e].uploading=!1}},async deletePaymentMethodImage(a,e){let t=null;if(e==="logo"&&a._links)t=a._links.deleteStorePaymentMethodLogo;else if(e==="photo"&&a._links)t=a._links.deleteStorePaymentMethodPhoto;else{console.warn(`❌ No delete URL provided for '${e}' on '${a.name}'`);return}try{if(a.configs[e].deleting=!0,(await ae(t)).status==200)a.configs[e]={filePath:null,uploaded:!1};else throw new Error(`Failed to delete ${e}.`);console.log(`✅ Successfully deleted ${e} for '${a.name}'`)}catch(o){console.error(`❌ Error deleting ${e} for '${a.name}':`,o)}finally{a.configs[e].deleting=!1}}},getters:{logo(){return this.store?this.store._relationships.logo:null},store(){return this.storeState.store},totalSelectedPaymentMethods(){return this.paymentMethods.filter(a=>a.active).length},hasSelectedPaymentMethods(){return this.totalSelectedPaymentMethods>0},hasAssociatedPaymentMethods(){return this.associatedPaymentMethods.length>0},hasChangedPaymentMethods(){return this.changedPaymentMethods.length>0},changedPaymentMethods(){return this.paymentMethods.filter((a,e)=>!$(a,this.originalPaymentMethods[e]))},hasPaymentMethodValidationErrors(){return this.paymentMethodValidationErrors.length>0},paymentMethodValidationErrors(){return this.paymentMethods.filter(a=>a.active).flatMap(a=>a.configSchema.filter(e=>this.checkIfPaymentMethodConfigSchemaEntityPassesCondition(e,a.configs)).map(e=>this.getPaymentMethodFirstValidationError(e,a.configs)).filter(e=>e!==null))},totalSelectedPaymentMethods(){return this.paymentMethods.filter(a=>a.active).length},hasSelectedPaymentMethods(){return this.totalSelectedPaymentMethods>0},progressPercentage(){return this.totalCompletionSteps===0?0:Math.round(this.totalCompletedSteps/this.totalCompletionSteps*100)},totalUploads(){return this.changedPaymentMethods.reduce((a,e)=>a+e.configSchema.filter(t=>e.configs[t.attribute]&&e.configs[t.attribute].filePath&&e.configs[t.attribute].hasOwnProperty("uploaded")).length,0)},totalFailedUploads(){return this.changedPaymentMethods.reduce((a,e)=>a+e.configSchema.filter(t=>{var i;const o=e.configs[t.attribute];return((i=o==null?void 0:o.filePath)==null?void 0:i.startsWith("blob:"))&&o.uploaded===!1}).length,0)},totalCompletionSteps(){return this.changedPaymentMethods.filter(a=>a._links?!0:!!a.active).length+this.totalUploads},hasCompletedSteps(){return this.totalCompletedSteps>0},hasFailedUploads(){return this.totalFailedUploads>0}}}),re={components:{TextInput:T},props:{modelValue:{type:String},configSchemaEntity:{type:Object}},data(){return{localModelValue:this.modelValue}},watch:{modelValue(a){this.localModelValue=a},localModelValue(a,e){this.$emit("update:modelValue",a)}}},de={class:"flex items-center space-x-1 py-1.5 pl-2 pr-4 rounded-l-md bg-gray-50 text-gray-500 border-r whitespace-nowrap"};function ce(a,e,t,o,i,s){const n=v("TextInput");return d(),b(n,{modelValue:i.localModelValue,"onUpdate:modelValue":e[0]||(e[0]=l=>i.localModelValue=l),label:t.configSchemaEntity.label,description:t.configSchemaEntity.description,placeholder:t.configSchemaEntity.placeholder,secondaryLabel:t.configSchemaEntity.optional?"(optional)":null,learnMoreLink:t.configSchemaEntity.learnMore?t.configSchemaEntity.learnMore.href:null,learnMoreLabel:t.configSchemaEntity.learnMore?t.configSchemaEntity.learnMore.label:null},z({_:2},[t.configSchemaEntity.prefix?{name:"prepend",fn:E(()=>[r("div",de,[r("span",null,S(t.configSchemaEntity.prefix),1)])]),key:"0"}:void 0]),1032,["modelValue","label","description","placeholder","secondaryLabel","learnMoreLink","learnMoreLabel"])}const he=P(re,[["render",ce]]),ue={components:{EmailInput:ie},props:{modelValue:{type:String},configSchemaEntity:{type:Object}},data(){return{localModelValue:this.modelValue}},watch:{modelValue(a){this.localModelValue=a},localModelValue(a,e){this.$emit("update:modelValue",a)}}};function me(a,e,t,o,i,s){const n=v("EmailInput");return d(),b(n,{modelValue:i.localModelValue,"onUpdate:modelValue":e[0]||(e[0]=l=>i.localModelValue=l),label:t.configSchemaEntity.label,description:t.configSchemaEntity.description,secondaryLabel:t.configSchemaEntity.optional?"(optional)":null,learnMoreLink:t.configSchemaEntity.learnMore?t.configSchemaEntity.learnMore.href:null,learnMoreLabel:t.configSchemaEntity.learnMore?t.configSchemaEntity.learnMore.label:null},null,8,["modelValue","label","description","secondaryLabel","learnMoreLink","learnMoreLabel"])}const ge=P(ue,[["render",me]]);class c{constructor(e,t,o,i,s){this._legacyCanvasSize=c.DEFAULT_CANVAS_SIZE,this._preferredCamera="environment",this._maxScansPerSecond=25,this._lastScanTimestamp=-1,this._destroyed=this._flashOn=this._paused=this._active=!1,this.$video=e,this.$canvas=document.createElement("canvas"),o&&typeof o=="object"?this._onDecode=t:(console.warn(o||i||s?"You're using a deprecated version of the QrScanner constructor which will be removed in the future":"Note that the type of the scan result passed to onDecode will change in the future. To already switch to the new api today, you can pass returnDetailedScanResult: true."),this._legacyOnDecode=t),t=typeof o=="object"?o:{},this._onDecodeError=t.onDecodeError||(typeof o=="function"?o:this._onDecodeError),this._calculateScanRegion=t.calculateScanRegion||(typeof i=="function"?i:this._calculateScanRegion),this._preferredCamera=t.preferredCamera||s||this._preferredCamera,this._legacyCanvasSize=typeof o=="number"?o:typeof i=="number"?i:this._legacyCanvasSize,this._maxScansPerSecond=t.maxScansPerSecond||this._maxScansPerSecond,this._onPlay=this._onPlay.bind(this),this._onLoadedMetaData=this._onLoadedMetaData.bind(this),this._onVisibilityChange=this._onVisibilityChange.bind(this),this._updateOverlay=this._updateOverlay.bind(this),e.disablePictureInPicture=!0,e.playsInline=!0,e.muted=!0;let n=!1;if(e.hidden&&(e.hidden=!1,n=!0),document.body.contains(e)||(document.body.appendChild(e),n=!0),o=e.parentElement,t.highlightScanRegion||t.highlightCodeOutline){if(i=!!t.overlay,this.$overlay=t.overlay||document.createElement("div"),s=this.$overlay.style,s.position="absolute",s.display="none",s.pointerEvents="none",this.$overlay.classList.add("scan-region-highlight"),!i&&t.highlightScanRegion){this.$overlay.innerHTML='<svg class="scan-region-highlight-svg" viewBox="0 0 238 238" preserveAspectRatio="none" style="position:absolute;width:100%;height:100%;left:0;top:0;fill:none;stroke:#e9b213;stroke-width:4;stroke-linecap:round;stroke-linejoin:round"><path d="M31 2H10a8 8 0 0 0-8 8v21M207 2h21a8 8 0 0 1 8 8v21m0 176v21a8 8 0 0 1-8 8h-21m-176 0H10a8 8 0 0 1-8-8v-21"/></svg>';try{this.$overlay.firstElementChild.animate({transform:["scale(.98)","scale(1.01)"]},{duration:400,iterations:1/0,direction:"alternate",easing:"ease-in-out"})}catch{}o.insertBefore(this.$overlay,this.$video.nextSibling)}t.highlightCodeOutline&&(this.$overlay.insertAdjacentHTML("beforeend",'<svg class="code-outline-highlight" preserveAspectRatio="none" style="display:none;width:100%;height:100%;fill:none;stroke:#e9b213;stroke-width:5;stroke-dasharray:25;stroke-linecap:round;stroke-linejoin:round"><polygon/></svg>'),this.$codeOutlineHighlight=this.$overlay.lastElementChild)}this._scanRegion=this._calculateScanRegion(e),requestAnimationFrame(()=>{let l=window.getComputedStyle(e);l.display==="none"&&(e.style.setProperty("display","block","important"),n=!0),l.visibility!=="visible"&&(e.style.setProperty("visibility","visible","important"),n=!0),n&&(console.warn("QrScanner has overwritten the video hiding style to avoid Safari stopping the playback."),e.style.opacity="0",e.style.width="0",e.style.height="0",this.$overlay&&this.$overlay.parentElement&&this.$overlay.parentElement.removeChild(this.$overlay),delete this.$overlay,delete this.$codeOutlineHighlight),this.$overlay&&this._updateOverlay()}),e.addEventListener("play",this._onPlay),e.addEventListener("loadedmetadata",this._onLoadedMetaData),document.addEventListener("visibilitychange",this._onVisibilityChange),window.addEventListener("resize",this._updateOverlay),this._qrEnginePromise=c.createQrEngine()}static set WORKER_PATH(e){console.warn("Setting QrScanner.WORKER_PATH is not required and not supported anymore. Have a look at the README for new setup instructions.")}static async hasCamera(){try{return!!(await c.listCameras(!1)).length}catch{return!1}}static async listCameras(e=!1){if(!navigator.mediaDevices)return[];let t=async()=>(await navigator.mediaDevices.enumerateDevices()).filter(i=>i.kind==="videoinput"),o;try{e&&(await t()).every(i=>!i.label)&&(o=await navigator.mediaDevices.getUserMedia({audio:!1,video:!0}))}catch{}try{return(await t()).map((i,s)=>({id:i.deviceId,label:i.label||(s===0?"Default Camera":`Camera ${s+1}`)}))}finally{o&&(console.warn("Call listCameras after successfully starting a QR scanner to avoid creating a temporary video stream"),c._stopVideoStream(o))}}async hasFlash(){let e;try{if(this.$video.srcObject){if(!(this.$video.srcObject instanceof MediaStream))return!1;e=this.$video.srcObject}else e=(await this._getCameraStream()).stream;return"torch"in e.getVideoTracks()[0].getSettings()}catch{return!1}finally{e&&e!==this.$video.srcObject&&(console.warn("Call hasFlash after successfully starting the scanner to avoid creating a temporary video stream"),c._stopVideoStream(e))}}isFlashOn(){return this._flashOn}async toggleFlash(){this._flashOn?await this.turnFlashOff():await this.turnFlashOn()}async turnFlashOn(){if(!this._flashOn&&!this._destroyed&&(this._flashOn=!0,this._active&&!this._paused))try{if(!await this.hasFlash())throw"No flash available";await this.$video.srcObject.getVideoTracks()[0].applyConstraints({advanced:[{torch:!0}]})}catch(e){throw this._flashOn=!1,e}}async turnFlashOff(){this._flashOn&&(this._flashOn=!1,await this._restartVideoStream())}destroy(){this.$video.removeEventListener("loadedmetadata",this._onLoadedMetaData),this.$video.removeEventListener("play",this._onPlay),document.removeEventListener("visibilitychange",this._onVisibilityChange),window.removeEventListener("resize",this._updateOverlay),this._destroyed=!0,this._flashOn=!1,this.stop(),c._postWorkerMessage(this._qrEnginePromise,"close")}async start(){if(this._destroyed)throw Error("The QR scanner can not be started as it had been destroyed.");if((!this._active||this._paused)&&(window.location.protocol!=="https:"&&console.warn("The camera stream is only accessible if the page is transferred via https."),this._active=!0,!document.hidden))if(this._paused=!1,this.$video.srcObject)await this.$video.play();else try{let{stream:e,facingMode:t}=await this._getCameraStream();!this._active||this._paused?c._stopVideoStream(e):(this._setVideoMirror(t),this.$video.srcObject=e,await this.$video.play(),this._flashOn&&(this._flashOn=!1,this.turnFlashOn().catch(()=>{})))}catch(e){if(!this._paused)throw this._active=!1,e}}stop(){this.pause(),this._active=!1}async pause(e=!1){if(this._paused=!0,!this._active)return!0;this.$video.pause(),this.$overlay&&(this.$overlay.style.display="none");let t=()=>{this.$video.srcObject instanceof MediaStream&&(c._stopVideoStream(this.$video.srcObject),this.$video.srcObject=null)};return e?(t(),!0):(await new Promise(o=>setTimeout(o,300)),this._paused?(t(),!0):!1)}async setCamera(e){e!==this._preferredCamera&&(this._preferredCamera=e,await this._restartVideoStream())}static async scanImage(e,t,o,i,s=!1,n=!1){let l,u=!1;t&&("scanRegion"in t||"qrEngine"in t||"canvas"in t||"disallowCanvasResizing"in t||"alsoTryWithoutScanRegion"in t||"returnDetailedScanResult"in t)?(l=t.scanRegion,o=t.qrEngine,i=t.canvas,s=t.disallowCanvasResizing||!1,n=t.alsoTryWithoutScanRegion||!1,u=!0):console.warn(t||o||i||s||n?"You're using a deprecated api for scanImage which will be removed in the future.":"Note that the return type of scanImage will change in the future. To already switch to the new api today, you can pass returnDetailedScanResult: true."),t=!!o;try{let w,g;[o,w]=await Promise.all([o||c.createQrEngine(),c._loadImage(e)]),[i,g]=c._drawToCanvas(w,l,i,s);let M;if(o instanceof Worker){let f=o;t||c._postWorkerMessageSync(f,"inversionMode","both"),M=await new Promise((p,h)=>{let k,y,V,F=-1;y=x=>{x.data.id===F&&(f.removeEventListener("message",y),f.removeEventListener("error",V),clearTimeout(k),x.data.data!==null?p({data:x.data.data,cornerPoints:c._convertPoints(x.data.cornerPoints,l)}):h(c.NO_QR_CODE_FOUND))},V=x=>{f.removeEventListener("message",y),f.removeEventListener("error",V),clearTimeout(k),h("Scanner error: "+(x?x.message||x:"Unknown Error"))},f.addEventListener("message",y),f.addEventListener("error",V),k=setTimeout(()=>V("timeout"),1e4);let I=g.getImageData(0,0,i.width,i.height);F=c._postWorkerMessageSync(f,"decode",I,[I.data.buffer])})}else M=await Promise.race([new Promise((f,p)=>window.setTimeout(()=>p("Scanner error: timeout"),1e4)),(async()=>{try{var[f]=await o.detect(i);if(!f)throw c.NO_QR_CODE_FOUND;return{data:f.rawValue,cornerPoints:c._convertPoints(f.cornerPoints,l)}}catch(p){if(f=p.message||p,/not implemented|service unavailable/.test(f))return c._disableBarcodeDetector=!0,c.scanImage(e,{scanRegion:l,canvas:i,disallowCanvasResizing:s,alsoTryWithoutScanRegion:n});throw`Scanner error: ${f}`}})()]);return u?M:M.data}catch(w){if(!l||!n)throw w;let g=await c.scanImage(e,{qrEngine:o,canvas:i,disallowCanvasResizing:s});return u?g:g.data}finally{t||c._postWorkerMessage(o,"close")}}setGrayscaleWeights(e,t,o,i=!0){c._postWorkerMessage(this._qrEnginePromise,"grayscaleWeights",{red:e,green:t,blue:o,useIntegerApproximation:i})}setInversionMode(e){c._postWorkerMessage(this._qrEnginePromise,"inversionMode",e)}static async createQrEngine(e){if(e&&console.warn("Specifying a worker path is not required and not supported anymore."),e=()=>N(()=>import("./qr-scanner-worker.min-D85Z9gVD.js"),[]).then(o=>o.createWorker()),!(!c._disableBarcodeDetector&&"BarcodeDetector"in window&&BarcodeDetector.getSupportedFormats&&(await BarcodeDetector.getSupportedFormats()).includes("qr_code")))return e();let t=navigator.userAgentData;return t&&t.brands.some(({brand:o})=>/Chromium/i.test(o))&&/mac ?OS/i.test(t.platform)&&await t.getHighEntropyValues(["architecture","platformVersion"]).then(({architecture:o,platformVersion:i})=>/arm/i.test(o||"arm")&&13<=parseInt(i||"13")).catch(()=>!0)?e():new BarcodeDetector({formats:["qr_code"]})}_onPlay(){this._scanRegion=this._calculateScanRegion(this.$video),this._updateOverlay(),this.$overlay&&(this.$overlay.style.display=""),this._scanFrame()}_onLoadedMetaData(){this._scanRegion=this._calculateScanRegion(this.$video),this._updateOverlay()}_onVisibilityChange(){document.hidden?this.pause():this._active&&this.start()}_calculateScanRegion(e){let t=Math.round(.6666666666666666*Math.min(e.videoWidth,e.videoHeight));return{x:Math.round((e.videoWidth-t)/2),y:Math.round((e.videoHeight-t)/2),width:t,height:t,downScaledWidth:this._legacyCanvasSize,downScaledHeight:this._legacyCanvasSize}}_updateOverlay(){requestAnimationFrame(()=>{if(this.$overlay){var e=this.$video,t=e.videoWidth,o=e.videoHeight,i=e.offsetWidth,s=e.offsetHeight,n=e.offsetLeft,l=e.offsetTop,u=window.getComputedStyle(e),w=u.objectFit,g=t/o,M=i/s;switch(w){case"none":var f=t,p=o;break;case"fill":f=i,p=s;break;default:(w==="cover"?g>M:g<M)?(p=s,f=p*g):(f=i,p=f/g),w==="scale-down"&&(f=Math.min(f,t),p=Math.min(p,o))}var[h,k]=u.objectPosition.split(" ").map((V,F)=>{const I=parseFloat(V);return V.endsWith("%")?(F?s-p:i-f)*I/100:I});u=this._scanRegion.width||t,M=this._scanRegion.height||o,w=this._scanRegion.x||0;var y=this._scanRegion.y||0;g=this.$overlay.style,g.width=`${u/t*f}px`,g.height=`${M/o*p}px`,g.top=`${l+k+y/o*p}px`,o=/scaleX\(-1\)/.test(e.style.transform),g.left=`${n+(o?i-h-f:h)+(o?t-w-u:w)/t*f}px`,g.transform=e.style.transform}})}static _convertPoints(e,t){if(!t)return e;let o=t.x||0,i=t.y||0,s=t.width&&t.downScaledWidth?t.width/t.downScaledWidth:1;t=t.height&&t.downScaledHeight?t.height/t.downScaledHeight:1;for(let n of e)n.x=n.x*s+o,n.y=n.y*t+i;return e}_scanFrame(){!this._active||this.$video.paused||this.$video.ended||("requestVideoFrameCallback"in this.$video?this.$video.requestVideoFrameCallback.bind(this.$video):requestAnimationFrame)(async()=>{if(!(1>=this.$video.readyState)){var e=Date.now()-this._lastScanTimestamp,t=1e3/this._maxScansPerSecond;e<t&&await new Promise(i=>setTimeout(i,t-e)),this._lastScanTimestamp=Date.now();try{var o=await c.scanImage(this.$video,{scanRegion:this._scanRegion,qrEngine:this._qrEnginePromise,canvas:this.$canvas})}catch(i){if(!this._active)return;this._onDecodeError(i)}!c._disableBarcodeDetector||await this._qrEnginePromise instanceof Worker||(this._qrEnginePromise=c.createQrEngine()),o?(this._onDecode?this._onDecode(o):this._legacyOnDecode&&this._legacyOnDecode(o.data),this.$codeOutlineHighlight&&(clearTimeout(this._codeOutlineHighlightRemovalTimeout),this._codeOutlineHighlightRemovalTimeout=void 0,this.$codeOutlineHighlight.setAttribute("viewBox",`${this._scanRegion.x||0} ${this._scanRegion.y||0} ${this._scanRegion.width||this.$video.videoWidth} ${this._scanRegion.height||this.$video.videoHeight}`),this.$codeOutlineHighlight.firstElementChild.setAttribute("points",o.cornerPoints.map(({x:i,y:s})=>`${i},${s}`).join(" ")),this.$codeOutlineHighlight.style.display="")):this.$codeOutlineHighlight&&!this._codeOutlineHighlightRemovalTimeout&&(this._codeOutlineHighlightRemovalTimeout=setTimeout(()=>this.$codeOutlineHighlight.style.display="none",100))}this._scanFrame()})}_onDecodeError(e){e!==c.NO_QR_CODE_FOUND&&console.log(e)}async _getCameraStream(){if(!navigator.mediaDevices)throw"Camera not found.";let e=/^(environment|user)$/.test(this._preferredCamera)?"facingMode":"deviceId",t=[{width:{min:1024}},{width:{min:768}},{}],o=t.map(i=>Object.assign({},i,{[e]:{exact:this._preferredCamera}}));for(let i of[...o,...t])try{let s=await navigator.mediaDevices.getUserMedia({video:i,audio:!1}),n=this._getFacingMode(s)||(i.facingMode?this._preferredCamera:this._preferredCamera==="environment"?"user":"environment");return{stream:s,facingMode:n}}catch{}throw"Camera not found."}async _restartVideoStream(){let e=this._paused;await this.pause(!0)&&!e&&this._active&&await this.start()}static _stopVideoStream(e){for(let t of e.getTracks())t.stop(),e.removeTrack(t)}_setVideoMirror(e){this.$video.style.transform="scaleX("+(e==="user"?-1:1)+")"}_getFacingMode(e){return(e=e.getVideoTracks()[0])?/rear|back|environment/i.test(e.label)?"environment":/front|user|face/i.test(e.label)?"user":null:null}static _drawToCanvas(e,t,o,i=!1){o=o||document.createElement("canvas");let s=t&&t.x?t.x:0,n=t&&t.y?t.y:0,l=t&&t.width?t.width:e.videoWidth||e.width,u=t&&t.height?t.height:e.videoHeight||e.height;return i||(i=t&&t.downScaledWidth?t.downScaledWidth:l,t=t&&t.downScaledHeight?t.downScaledHeight:u,o.width!==i&&(o.width=i),o.height!==t&&(o.height=t)),t=o.getContext("2d",{alpha:!1}),t.imageSmoothingEnabled=!1,t.drawImage(e,s,n,l,u,0,0,o.width,o.height),[o,t]}static async _loadImage(e){if(e instanceof Image)return await c._awaitImageLoad(e),e;if(e instanceof HTMLVideoElement||e instanceof HTMLCanvasElement||e instanceof SVGImageElement||"OffscreenCanvas"in window&&e instanceof OffscreenCanvas||"ImageBitmap"in window&&e instanceof ImageBitmap)return e;if(e instanceof File||e instanceof Blob||e instanceof URL||typeof e=="string"){let t=new Image;t.src=e instanceof File||e instanceof Blob?URL.createObjectURL(e):e.toString();try{return await c._awaitImageLoad(t),t}finally{(e instanceof File||e instanceof Blob)&&URL.revokeObjectURL(t.src)}}else throw"Unsupported image type."}static async _awaitImageLoad(e){e.complete&&e.naturalWidth!==0||await new Promise((t,o)=>{let i=s=>{e.removeEventListener("load",i),e.removeEventListener("error",i),s instanceof ErrorEvent?o("Image load error"):t()};e.addEventListener("load",i),e.addEventListener("error",i)})}static async _postWorkerMessage(e,t,o,i){return c._postWorkerMessageSync(await e,t,o,i)}static _postWorkerMessageSync(e,t,o,i){if(!(e instanceof Worker))return-1;let s=c._workerMessageId++;return e.postMessage({id:s,type:t,data:o},i),s}}c.DEFAULT_CANVAS_SIZE=400;c.NO_QR_CODE_FOUND="No QR code found";c._disableBarcodeDetector=!1;c._workerMessageId=0;const fe=Object.freeze(Object.defineProperty({__proto__:null,default:c},Symbol.toStringTag,{value:"Module"})),pe={components:{InputLabel:se},props:{modelValue:{type:Object,default:()=>null},configSchemaEntity:{type:Object},paymentMethod:{type:Object}},data(){return{localModelValue:null,originalModelValue:null,onboardingState:D()}},watch:{modelValue:{immediate:!0,handler(a){this.localModelValue=U(a),this.originalModelValue==null&&(this.originalModelValue=U(a))},deep:!0},localModelValue:{handler(a){$(this.modelValue,a)||this.$emit("update:modelValue",a)},deep:!0}},computed:{acceptedFileTypes(){var a,e;if((e=(a=this.configSchemaEntity)==null?void 0:a.validationRules)!=null&&e.mimeTypes){const[t]=this.configSchemaEntity.validationRules.mimeTypes;if(Array.isArray(t)&&t.length>0)return t.join(",")}return"image/*"},hasSelectedImage(){var a,e;return((a=this.localModelValue)==null?void 0:a.filePath)&&((e=this.localModelValue)==null?void 0:e.filePath.startsWith("blob:"))}},methods:{triggerFileInput(){this.$refs.fileInput.click()},handleFileUpload(a){const e=a.target.files[0];e&&this.processFile(e)},handleDrop(a){a.preventDefault();const e=a.dataTransfer.files[0];e&&this.processFile(e)},processFile(a){a&&new Promise(e=>{const t=new FileReader;t.onload=()=>{var o;this.localModelValue.filePath=URL.createObjectURL(a),this.localModelValue.uploading=!1,this.localModelValue.uploaded=null,this.localModelValue.fileRef=a,(o=this.configSchemaEntity.validationRules)!=null&&o.qrCode&&this.validateQRCode(),e()},t.readAsDataURL(a)}).then(()=>{this.uploadImage()})},async validateQRCode(){try{const e=await(await N(async()=>{const{default:o}=await Promise.resolve().then(()=>fe);return{default:o}},void 0)).default.scanImage(this.localModelValue.filePath,{returnDetailedScanResult:!0}),t=(e==null?void 0:e.data)??e;if(t)console.log(`✅ QR Code detected: ${t}`),this.localModelValue={...this.localModelValue,validQR:!0,qrData:t};else throw new Error("Invalid QR Code")}catch(a){console.error("❌ Invalid QR Code:",a),this.localModelValue={...this.localModelValue,validQR:!1}}},async removeImage(){this.hasSelectedImage?this.localModelValue=U(this.originalModelValue):this.localModelValue.filePath!=null&&await this.onboardingState.deletePaymentMethodImage(this.paymentMethod,this.configSchemaEntity.attribute)},async uploadImage(){const{attribute:a}=this.configSchemaEntity,e={[a]:this.paymentMethod.configs[a]};if(!e[a]){console.warn(`⚠️ No valid config found for '${a}'`);return}const t=this.onboardingState.getPaymentMethodValidationErrors(this.configSchemaEntity,e);t.length?console.warn("❌ Upload failed due to validation errors:",t):await this.onboardingState.uploadSinglePaymentMethodImage(this.paymentMethod,a)}}},ye=["accept"],ve={key:1,class:"relative mt-2"},_e={key:0,class:"absolute z-10 top-0 right-0 h-full p-2 flex flex-col items-end justify-between space-y-2"},we={class:"flex flex-col items-end space-y-2"},Me={class:"flex"},Se={key:0,class:"bg-green-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs"},be={key:1,class:"bg-red-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs"},Pe={key:1,class:"absolute inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center"},Ve={key:2,class:"absolute inset-0 bg-red-900 bg-opacity-50 flex items-center justify-center"},xe=["src"],ke=["accept"];function Ce(a,e,t,o,i,s){const n=v("InputLabel");return d(),m("div",null,[L(n,{secondaryLabel:t.configSchemaEntity.optional?"(optional)":null},{default:E(()=>[R(S(t.configSchemaEntity.label),1)]),_:1},8,["secondaryLabel"]),i.localModelValue.filePath?(d(),m("div",ve,[i.localModelValue.uploading?_("",!0):(d(),m("div",_e,[r("div",we,[i.localModelValue.uploadFailed===!0?(d(),m("button",{key:0,onClick:e[4]||(e[4]=(...l)=>s.uploadImage&&s.uploadImage(...l)),class:"cursor-pointer bg-yellow-500 hover:bg-yellow-600 text-white rounded-full w-fit px-4 py-1 flex items-center justify-center text-xs active:scale-95 transition-all"},e[9]||(e[9]=[r("div",{class:"flex items-center space-x-1"},[r("svg",{class:"w-4 h-4",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor"},[r("path",{"fill-rule":"evenodd",d:"M4.755 10.059a7.5 7.5 0 0 1 12.548-3.364l1.903 1.903h-3.183a.75.75 0 1 0 0 1.5h4.992a.75.75 0 0 0 .75-.75V4.356a.75.75 0 0 0-1.5 0v3.18l-1.9-1.9A9 9 0 0 0 3.306 9.67a.75.75 0 1 0 1.45.388Zm15.408 3.352a.75.75 0 0 0-.919.53 7.5 7.5 0 0 1-12.548 3.364l-1.902-1.903h3.183a.75.75 0 0 0 0-1.5H2.984a.75.75 0 0 0-.75.75v4.992a.75.75 0 0 0 1.5 0v-3.18l1.9 1.9a9 9 0 0 0 15.059-4.035.75.75 0 0 0-.53-.918Z","clip-rule":"evenodd"})]),r("span",{class:"text-xs"},"Retry")],-1)]))):_("",!0),i.localModelValue.uploading?_("",!0):(d(),m("button",{key:1,onClick:e[5]||(e[5]=(...l)=>s.removeImage&&s.removeImage(...l)),class:"cursor-pointer bg-red-500 hover:bg-red-600 text-white rounded-full w-fit px-4 py-1 flex items-center justify-center text-xs active:scale-95 transition-all"}," Remove "))]),r("div",Me,[i.localModelValue.uploaded===!0?(d(),m("div",Se,e[10]||(e[10]=[r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m4.5 12.75 6 6 9-13.5"})],-1)]))):_("",!0),i.localModelValue.uploaded===!1?(d(),m("div",be,e[11]||(e[11]=[r("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor"},[r("path",{"fill-rule":"evenodd",d:"M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12ZM12 8.25a.75.75 0 0 1 .75.75v3.75a.75.75 0 0 1-1.5 0V9a.75.75 0 0 1 .75-.75Zm0 8.25a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z","clip-rule":"evenodd"})],-1)]))):_("",!0)])])),i.localModelValue.uploading?(d(),m("div",Pe,e[12]||(e[12]=[r("span",{class:"text-white text-xs font-bold"},"Uploading...",-1)]))):_("",!0),i.localModelValue.deleting?(d(),m("div",Ve,e[13]||(e[13]=[r("span",{class:"text-white text-xs font-bold"},"Deleting...",-1)]))):_("",!0),r("img",{onClick:e[6]||(e[6]=(...l)=>s.triggerFileInput&&s.triggerFileInput(...l)),src:i.localModelValue.filePath,class:"w-full h-40 p-4 object-contain rounded-lg border border-gray-300 dark:border-gray-700 cursor-pointer hover:opacity-80 transition"},null,8,xe),r("input",{type:"file",class:"hidden",ref:"fileInput",onChange:e[7]||(e[7]=(...l)=>s.handleFileUpload&&s.handleFileUpload(...l)),accept:s.acceptedFileTypes},null,40,ke)])):(d(),m("div",{key:0,onDragover:e[1]||(e[1]=Z(()=>{},["prevent"])),onDrop:e[2]||(e[2]=(...l)=>s.handleDrop&&s.handleDrop(...l)),onClick:e[3]||(e[3]=(...l)=>s.triggerFileInput&&s.triggerFileInput(...l)),class:"mt-2 w-full h-40 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg flex flex-col items-center justify-center text-gray-500 dark:text-gray-400 text-sm cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 transition"},[e[8]||(e[8]=r("p",null,"Click or Drag & Drop Image",-1)),r("input",{type:"file",class:"hidden",ref:"fileInput",onChange:e[0]||(e[0]=(...l)=>s.handleFileUpload&&s.handleFileUpload(...l)),accept:s.acceptedFileTypes},null,40,ye)],32))])}const Ee=P(pe,[["render",Ce]]),Ie={components:{SelectInput:ne},props:{modelValue:{type:String},configSchemaEntity:{type:Object}},data(){return{localModelValue:this.modelValue}},watch:{modelValue(a){this.localModelValue=a},localModelValue(a,e){this.$emit("update:modelValue",a)}}},Le=["value"];function Re(a,e,t,o,i,s){const n=v("SelectInput");return d(),b(n,{width:"w-full",modelValue:i.localModelValue,"onUpdate:modelValue":e[0]||(e[0]=l=>i.localModelValue=l),label:t.configSchemaEntity.label,placeholder:t.configSchemaEntity.placeholder,description:t.configSchemaEntity.description,secondaryLabel:t.configSchemaEntity.optional?"(optional)":null,learnMoreLink:t.configSchemaEntity.learnMore?t.configSchemaEntity.learnMore.href:null,learnMoreLabel:t.configSchemaEntity.learnMore?t.configSchemaEntity.learnMore.label:null},{default:E(()=>[(d(!0),m(C,null,O(t.configSchemaEntity.options,(l,u)=>(d(),m("option",{value:l.value,key:u},S(l.label),9,Le))),128))]),_:1},8,["modelValue","label","placeholder","description","secondaryLabel","learnMoreLink","learnMoreLabel"])}const Ue=P(Ie,[["render",Re]]),Oe={components:{TextInput:T},props:{modelValue:{type:String},configSchemaEntity:{type:Object}},data(){return{localModelValue:this.modelValue}},watch:{modelValue(a){this.localModelValue=a},localModelValue(a,e){this.$emit("update:modelValue",a)}}};function Fe(a,e,t,o,i,s){const n=v("TextInput");return d(),b(n,{modelValue:i.localModelValue,"onUpdate:modelValue":e[0]||(e[0]=l=>i.localModelValue=l),label:t.configSchemaEntity.label,placeholder:t.configSchemaEntity.placeholder,description:t.configSchemaEntity.description,secondaryLabel:t.configSchemaEntity.optional?"(optional)":null,learnMoreLink:t.configSchemaEntity.learnMore?t.configSchemaEntity.learnMore.href:null,learnMoreLabel:t.configSchemaEntity.learnMore?t.configSchemaEntity.learnMore.label:null},null,8,["modelValue","label","placeholder","description","secondaryLabel","learnMoreLink","learnMoreLabel"])}const Te=P(Oe,[["render",Fe]]),De={props:{configSchemaEntity:{type:Object}}},je={class:"space-x-1"},Ae=["href"],He={key:1,class:"text-xs"};function Ne(a,e,t,o,i,s){return d(),m("div",je,[(d(!0),m(C,null,O(t.configSchemaEntity.content,(n,l)=>(d(),m(C,{key:l},[n.text&&n.href?(d(),m("a",{key:0,target:"_blank",href:n.href,class:"text-xs text-blue-700 hover:underline hover:text-blue-90"},[R(S(n.text)+" ",1),e[0]||(e[0]=r("svg",{class:"w-3 h-3 inline-block ml-0.5 -mt-1",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25"})],-1))],8,Ae)):n.text?(d(),m("span",He,S(n.text),1)):_("",!0)],64))),128))])}const $e=P(De,[["render",Ne]]),Be={components:{MobileNumberInput:le},props:{modelValue:{type:String},configSchemaEntity:{type:Object}},data(){return{localModelValue:this.modelValue}},watch:{modelValue(a){this.localModelValue=a},localModelValue(a,e){this.$emit("update:modelValue",a)}}};function We(a,e,t,o,i,s){const n=v("MobileNumberInput");return d(),b(n,{modelValue:i.localModelValue,"onUpdate:modelValue":e[0]||(e[0]=l=>i.localModelValue=l),label:t.configSchemaEntity.label,description:t.configSchemaEntity.description,secondaryLabel:t.configSchemaEntity.optional?"(optional)":null,learnMoreLink:t.configSchemaEntity.learnMore?t.configSchemaEntity.learnMore.href:null,learnMoreLabel:t.configSchemaEntity.learnMore?t.configSchemaEntity.learnMore.label:null},null,8,["modelValue","label","description","secondaryLabel","learnMoreLink","learnMoreLabel"])}const qe=P(Be,[["render",We]]),Qe={props:{paymentMethod:{type:Object},paymentMethodIndex:{type:Number}},components:{TextInput:T,UrlConfig:he,EmailConfig:ge,ImageConfig:Ee,SelectConfig:Ue,StringConfig:Te,ContentConfig:$e,MobileNumberConfig:qe},data(){return{onboardingState:D()}},methods:{checkIfPaymentMethodConfigSchemaEntityPassesCondition(a,e){return this.onboardingState.checkIfPaymentMethodConfigSchemaEntityPassesCondition(a,e)},getPaymentMethodFirstValidationError(a,e){return this.onboardingState.getPaymentMethodFirstValidationError(a,e)}}},ze={key:0},Ze={key:7,class:"flex space-x-1 text-xs text-yellow-600 font-semibold bg-yellow-100 border border-yellow-300 p-3 rounded-lg shadow-md mt-2"};function Ye(a,e,t,o,i,s){const n=v("TextInput"),l=v("StringConfig"),u=v("MobileNumberConfig"),w=v("EmailConfig"),g=v("UrlConfig"),M=v("SelectConfig"),f=v("ImageConfig"),p=v("ContentConfig");return t.paymentMethod.active?(d(),m("div",ze,[t.paymentMethod.type=="other"?(d(),b(n,{key:0,class:"mt-4",label:"Custom Name",modelValue:t.paymentMethod.customName,"onUpdate:modelValue":e[0]||(e[0]=h=>t.paymentMethod.customName=h),description:"Provide your own custom payment name"},null,8,["modelValue"])):_("",!0),(d(!0),m(C,null,O(t.paymentMethod.configSchema,(h,k)=>(d(),m("div",{key:k,class:"mt-4"},[s.checkIfPaymentMethodConfigSchemaEntityPassesCondition(h,t.paymentMethod.configs)?(d(),m(C,{key:0},[h.type=="string"?(d(),b(l,{key:0,configSchemaEntity:h,modelValue:t.paymentMethod.configs[h.attribute],"onUpdate:modelValue":y=>t.paymentMethod.configs[h.attribute]=y},null,8,["configSchemaEntity","modelValue","onUpdate:modelValue"])):h.type=="mobile_number"?(d(),b(u,{key:1,configSchemaEntity:h,modelValue:t.paymentMethod.configs[h.attribute],"onUpdate:modelValue":y=>t.paymentMethod.configs[h.attribute]=y},null,8,["configSchemaEntity","modelValue","onUpdate:modelValue"])):h.type=="email"?(d(),b(w,{key:2,configSchemaEntity:h,modelValue:t.paymentMethod.configs[h.attribute],"onUpdate:modelValue":y=>t.paymentMethod.configs[h.attribute]=y},null,8,["configSchemaEntity","modelValue","onUpdate:modelValue"])):h.type=="url"?(d(),b(g,{key:3,configSchemaEntity:h,modelValue:t.paymentMethod.configs[h.attribute],"onUpdate:modelValue":y=>t.paymentMethod.configs[h.attribute]=y},null,8,["configSchemaEntity","modelValue","onUpdate:modelValue"])):h.type=="select"?(d(),b(M,{key:4,configSchemaEntity:h,modelValue:t.paymentMethod.configs[h.attribute],"onUpdate:modelValue":y=>t.paymentMethod.configs[h.attribute]=y},null,8,["configSchemaEntity","modelValue","onUpdate:modelValue"])):h.type=="image"?(d(),b(f,{key:5,paymentMethod:t.paymentMethod,configSchemaEntity:h,modelValue:t.paymentMethod.configs[h.attribute],"onUpdate:modelValue":y=>t.paymentMethod.configs[h.attribute]=y},null,8,["paymentMethod","configSchemaEntity","modelValue","onUpdate:modelValue"])):h.type=="content"?(d(),b(p,{key:6,configSchemaEntity:h},null,8,["configSchemaEntity"])):_("",!0),s.getPaymentMethodFirstValidationError(h,t.paymentMethod.configs)?(d(),m("p",Ze,[e[1]||(e[1]=r("svg",{class:"w-4 h-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z"})],-1)),r("span",null,S(s.getPaymentMethodFirstValidationError(h,t.paymentMethod.configs)),1)])):_("",!0)],64)):_("",!0)]))),128))])):_("",!0)}const Ge=P(Qe,[["render",Ye]]),Ke={components:{StoreLogo:B,PrimaryButton:W,ToogleSwitch:oe,PaymentMethodConfigInputs:Ge},data(){return{uploadsFailedBefore:!1,onboardingState:D()}},computed:{logo(){return this.onboardingState.logo},store(){return this.onboardingState.store},isUploading(){return this.onboardingState.isUploading},uploadMessage(){return this.onboardingState.uploadMessage},hasFailedUploads(){return this.onboardingState.hasFailedUploads},paymentMethods(){return this.onboardingState.paymentMethods},totalFailedUploads(){return this.onboardingState.totalFailedUploads},totalCompletedSteps(){return this.onboardingState.totalCompletedSteps},totalCompletionSteps(){return this.onboardingState.totalCompletionSteps},progressPercentage(){return this.onboardingState.progressPercentage},hasChangedPaymentMethods(){return this.onboardingState.hasChangedPaymentMethods},isSubmittingPaymentMethods(){return this.onboardingState.isSubmittingPaymentMethods},hasSelectedPaymentMethods(){return this.onboardingState.hasSelectedPaymentMethods},hasAssociatedPaymentMethods(){return this.onboardingState.hasAssociatedPaymentMethods},totalSelectedPaymentMethods(){return this.onboardingState.totalSelectedPaymentMethods},paymentMethodValidationErrors(){return this.onboardingState.paymentMethodValidationErrors},hasPaymentMethodValidationErrors(){return this.onboardingState.hasPaymentMethodValidationErrors},isLoadingAssociatedPaymentMethods(){return this.onboardingState.isLoadingAssociatedPaymentMethods},isLoadingUnassociatedPaymentMethods(){return this.onboardingState.isLoadingUnassociatedPaymentMethods}},methods:{submitPaymentMethods(){this.isSubmittingPaymentMethods||this.isUploading||this.onboardingState.submitPaymentMethods().then(()=>{this.totalFailedUploads==0||this.uploadsFailedBefore?this.navigateToAddSocials():this.uploadsFailedBefore=!0})},navigateToAddSocials(){this.$router.push({name:"add-socials",params:{store_href:this.store._links.showStore}})}},beforeRouteLeave(a,e,t){if((this.isSubmittingPaymentMethods||this.isUploading||this.hasChangedPaymentMethods&&this.progressPercentage!=100&&!this.hasFailedUploads)&&!window.confirm("You have unsaved changes. Are you sure you want to leave?"))return t(!1);t()},created(){this.onboardingState.reset(),this.onboardingState.showAssociatedPaymentMethods(),this.onboardingState.showUnassociatedPaymentMethods()}},Xe={class:"min-h-screen flex flex-col items-center pt-20 pb-40"},Je={class:"w-full max-w-lg"},et={class:"w-full max-w-lg"},tt={class:"space-y-3 mb-4"},at={class:"flex justify-between items-center"},ot={class:"flex items-center space-x-2 font-bold"},it={class:"w-8 h-8 rounded-full overflow-hidden flex items-center justify-center"},st=["src"],nt={class:"text-sm"},lt={key:0,class:"list-disc text-xs text-yellow-600 bg-yellow-100 border border-yellow-300 py-3 px-4 rounded-lg shadow-md mb-4"},rt={class:"space-y-1"},dt={key:1,class:"text-blue-600 bg-blue-100 border border-blue-300 p-3 rounded-lg shadow-md mb-4"},ct={class:"flex items-center space-x-2"},ht={key:0,class:"text-sm font-semibold"},ut={class:"font-bold"},mt={key:2,class:"mb-4"},gt={class:"w-full max-w-lg bg-gray-200 rounded-full h-2 mb-2"},ft={class:"text-xs text-center mt-2 font-bold"},pt={key:3,class:"text-xs text-blue-600 font-semibold bg-blue-100 border border-blue-300 p-3 rounded-lg shadow-md mb-4"},yt={class:"flex items-center space-x-2"},vt={key:0},_t={class:"flex justify-end"};function wt(a,e,t,o,i,s){const n=v("StoreLogo"),l=v("ToogleSwitch"),u=v("PaymentMethodConfigInputs"),w=v("PrimaryButton");return d(),m("div",Xe,[r("div",Je,[L(n,{showButton:!1,class:"flex justify-center mb-4"}),e[0]||(e[0]=r("h2",{class:"text-2xl font-semibold text-center mb-2"},"Add Payment Methods",-1)),e[1]||(e[1]=r("p",{class:"text-gray-500 text-center mb-6"},"Make it easy for customers to pay! Pick the payment options you’d like to accept",-1))]),r("div",et,[r("div",tt,[(d(!0),m(C,null,O(s.paymentMethods,(g,M)=>(d(),m("div",{key:M,class:"bg-white p-4 shadow-sm rounded-xl transition-all duration-300 border border-transparent hover:border-gray-300 hover:shadow-lg cursor-pointer"},[r("div",at,[r("div",ot,[r("div",it,[r("img",{alt:"Payment Method Logo",class:"h-full object-contain",src:g.configs.logo&&g.configs.logo.filePath?g.configs.logo.filePath:g.logo},null,8,st)]),r("span",nt,S(g.type=="other"&&g.customName?g.customName:g.name),1)]),L(l,{size:"md",modelValue:g.active,"onUpdate:modelValue":f=>g.active=f},null,8,["modelValue","onUpdate:modelValue"])]),L(u,{paymentMethod:g,paymentMethodIndex:M},null,8,["paymentMethod","paymentMethodIndex"])]))),128))]),s.hasPaymentMethodValidationErrors?(d(),m("div",lt,[e[2]||(e[2]=r("p",{class:"text-lg font-semibold mb-2"},"Resolve these to continue",-1)),r("ul",rt,[(d(!0),m(C,null,O(s.paymentMethodValidationErrors,(g,M)=>(d(),m("li",{key:M},S(g),1))),128))])])):(d(),m("div",dt,[r("div",ct,[e[3]||(e[3]=r("svg",{class:"w-8 h-8",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M2.25 18.75a60.07 60.07 0 0 1 15.797 2.101c.727.198 1.453-.342 1.453-1.096V18.75M3.75 4.5v.75A.75.75 0 0 1 3 6h-.75m0 0v-.375c0-.621.504-1.125 1.125-1.125H20.25M2.25 6v9m18-10.5v.75c0 .414.336.75.75.75h.75m-1.5-1.5h.375c.621 0 1.125.504 1.125 1.125v9.75c0 .621-.504 1.125-1.125 1.125h-.375m1.5-1.5H21a.75.75 0 0 0-.75.75v.75m0 0H3.75m0 0h-.375a1.125 1.125 0 0 1-1.125-1.125V15m1.5 1.5v-.75A.75.75 0 0 0 3 15h-.75M15 10.5a3 3 0 1 1-6 0 3 3 0 0 1 6 0Zm3 0h.008v.008H18V10.5Zm-12 0h.008v.008H6V10.5Z"})],-1)),r("div",null,[s.hasSelectedPaymentMethods?(d(),m("p",ht,[R(S(s.store.name)+" supports ",1),r("span",ut,S(s.totalSelectedPaymentMethods)+" "+S(s.totalSelectedPaymentMethods==1?"payment method":"payment methods"),1)])):_("",!0),r("p",{class:j([s.hasSelectedPaymentMethods?"text-xs":"text-sm font-semibold"])},"You can always "+S(s.hasSelectedPaymentMethods?"add more":"add")+" payment options later! 😊",3)])])])),s.isSubmittingPaymentMethods||s.isUploading||s.progressPercentage===100?(d(),m("div",mt,[r("div",gt,[r("div",{class:j(["h-2 rounded-full transition-all duration-500",s.progressPercentage===100?"bg-green-500":"bg-blue-500"]),style:Y({width:s.progressPercentage+"%"})},null,6)]),r("p",ft,S(s.progressPercentage===100?"Payment Methods Ready 🎉":`${s.uploadMessage} (${s.progressPercentage}%)`),1)])):_("",!0),s.hasFailedUploads?(d(),m("div",pt,[r("div",yt,[e[6]||(e[6]=r("svg",{class:"w-10 h-10",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 16.5V9.75m0 0 3 3m-3-3-3 3M6.75 19.5a4.5 4.5 0 0 1-1.41-8.775 5.25 5.25 0 0 1 10.233-2.33 3 3 0 0 1 3.758 3.848A3.752 3.752 0 0 1 18 19.5H6.75Z"})],-1)),r("div",null,[r("p",null,[e[4]||(e[4]=R(" We could not upload ")),s.totalFailedUploads?(d(),m("span",vt,S(s.totalFailedUploads)+" "+S(s.totalFailedUploads==1?"photo":"photos")+". ",1)):_("",!0)]),e[5]||(e[5]=r("p",null,"But no worries—you can always add more later! 😊",-1))])]),e[7]||(e[7]=G('<div class="mt-2 p-2 border-t border-dotted border-blue-300"><ul class="font-normal space-y-1"><li>✅ Make sure you’re uploading images (jpeg, jpg, png, gif or svg).</li><li>✅ Ensure your images are not too large (we accept up to 5MB).</li><li>✅ Use <a href="https://tinypng.com/" target="_blank" class="underline inline-flex items-center"> tinypng.com <svg class="w-3 h-3 ml-1" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25"></path></svg></a> to reduce image size (it’s free). </li></ul></div>',1))])):_("",!0),r("div",_t,[L(K,{name:"fade-1",mode:"out-in"},{default:E(()=>[s.hasSelectedPaymentMethods||s.hasAssociatedPaymentMethods?(d(),b(w,{key:0,class:"w-full",action:s.submitPaymentMethods,loading:s.isSubmittingPaymentMethods,disabled:s.isLoadingAssociatedPaymentMethods||s.isLoadingUnassociatedPaymentMethods||s.isSubmittingPaymentMethods||s.hasPaymentMethodValidationErrors},{default:E(()=>e[8]||(e[8]=[R(" Continue ")])),_:1},8,["action","loading","disabled"])):(d(),b(w,{key:1,type:"light",class:"w-40",action:s.navigateToAddSocials},{default:E(()=>e[9]||(e[9]=[r("span",null,"Skip",-1),r("svg",{class:"w-4 h-4 ml-1",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M17.25 8.25 21 12m0 0-3.75 3.75M21 12H3"})],-1)])),_:1},8,["action"]))]),_:1})])])])}const At=P(Ke,[["render",wt]]);export{At as default};
