import{R as L,u as q,a as v,c as l,b as m,d as t,w as c,e as g,f as d,g as b,F as p,r as s,o as i,h as n,t as x}from"./app-CEqZm7x2.js";import{L as T}from"./Logo-B2wTlgs-.js";import{A as I}from"./Alert-C7rdlNs-.js";import{F as U}from"./FormMixin-C7gN2sKm.js";import{U as A}from"./UtilsMixin-CbFS-0FV.js";import{T as M}from"./TextHeader-D6Nt-ESW.js";import{l as B}from"./auth-repository-Ba0ynhfu.js";import{p as K}from"./api-repository-BYhA_WkR.js";import{P as H}from"./PasswordInput-DUfktjN4.js";import{O}from"./OtpInput-SrtAKH6u.js";import{P as R}from"./PrimaryButton-DiavIMuW.js";import{S as D}from"./SocialLinks-B4fPMzKr.js";import{S as G}from"./SpinningLoader-DgjJNHBi.js";import{u as j}from"./form-store-CrrDqP0A.js";import{M as W}from"./MobileNumberInput-DY58FjSn.js";import{F as z}from"./FormErrorMessages-FXMYtfyg.js";import{C as J}from"./ConfirmPasswordInput-RDKFPcAR.js";import{_ as Q}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./InputLabel-C48W3Gag.js";import"./MoreInfoPopover-C6NcNDlq.js";import"./InputErrorMessage-BPFjWBUg.js";const X={mixins:[U,A],components:{Logo:T,Alert:I,RouterLink:L,TextHeader:M,PasswordInput:H,OtpInput:O,PrimaryButton:R,SocialLinks:D,SpinningLoader:G,MobileNumberInput:W,FormErrorMessages:z,ConfirmPasswordInput:J},data(){return{loginUrl:null,isSubmitting:!1,accountExistsUrl:null,apiState:q(),authState:v(),showPasswordConfirmation:!1,mobileVerificationShortcode:null,notificationState:j(),accountExists:!1,requiresPassword:!1,password:"",mobileNumber:"",verificationCode:"",passwordConfirmation:""}},beforeRouteEnter(r,e,u){u(h=>{r.query.hasOwnProperty("mobileNumber")&&(h.mobileNumber=r.query.mobileNumber,h.handleLogin())})},methods:{handleLogin(){this.hideFormErrors(),this.accountExists?this.attemptLogin():this.checkIfAccountExists()},checkIfAccountExists(){if(this.mobileNumber.trim()=="")this.setFormError("mobileNumber","Enter your mobile number");else if(this.accountExistsUrl!=null){this.isSubmitting=!0;const r={mobileNumber:this.mobileNumber};K(this.accountExistsUrl,r).then(e=>{this.isSubmitting=!1,this.accountExists=e.data.exists,this.accountExists?this.requiresPassword=e.data.accountSummary.requiresPassword:this.$router.push({name:"register",query:{mobileNumber:this.mobileNumber}})}).catch(e=>{this.isSubmitting=!1,this.setServerFormErrors(e)})}else this.setGeneralFormError("The accountExistsUrl does not exist")},attemptLogin(){if(this.mobileNumber.trim()=="")this.setFormError("mobileNumber","Enter your mobile number");else if(this.password.trim()=="")this.setFormError("password","Enter your password");else if(this.requiresPassword&&this.passwordConfirmation.trim()=="")this.setFormError("passwordConfirmation","Enter your password confirmation");else if(this.requiresPassword&&this.password!=this.passwordConfirmation)this.setFormError("password","Password does not match confirmation");else if(this.requiresPassword&&this.verificationCode.trim()=="")this.setFormError("verificationCode","Enter your verification code");else if(this.loginUrl!=null){this.isSubmitting=!0;let r={password:this.password,mobileNumber:this.mobileNumber};this.requiresPassword&&(r.verificationCode=this.verificationCode,r.passwordConfirmation=this.passwordConfirmation),B(r).then(e=>{if(e.status==200){this.isSubmitting=!1;const u=this.$route.query.redirect;u?this.$router.replace(u):(this.$router.replace({name:"dashboard"}),this.showSuccessfulNotification("Welcome back "+this.authState.user.firstName))}}).catch(e=>{this.isSubmitting=!1,this.setServerFormErrors(e)})}else this.setGeneralFormError("The loginUrl does not exist")}},created(){this.loginUrl=this.apiState.apiHome._links.login,this.accountExistsUrl=this.apiState.apiHome._links.accountExists,this.mobileVerificationShortcode=this.apiState.apiHome.mobileVerificationShortcode}},Y={class:"flex min-h-screen flex-col justify-center px-6 py-12 lg:px-8 bg-gray-100"},Z={class:"sm:mx-auto sm:w-full sm:max-w-sm"},$={class:"mt-10 sm:mx-auto sm:w-full sm:max-w-sm"},oo={class:"space-y-6",action:"#",method:"POST"},eo={class:"font-bold"},ro={class:"font-bold"},so={class:"text-sm text-center mt-8"},to=m("span",{class:"text-gray-500 mr-1"},"Don't have an account?",-1);function io(r,e,u,h,o,f){const E=s("Logo"),_=s("TextHeader"),S=s("FormErrorMessages"),y=s("MobileNumberInput"),w=s("Alert"),P=s("PasswordInput"),N=s("ConfirmPasswordInput"),C=s("OtpInput"),F=s("PrimaryButton"),k=s("SocialLinks"),V=s("router-link");return i(),l("div",Y,[m("div",Z,[t(E,{class:"mx-auto"}),t(_,{class:"mt-10 text-center"},{default:c(()=>[n("Sign in to your account")]),_:1})]),m("div",$,[m("form",oo,[r.hasGeneralError?(i(),g(S,{key:0})):d("",!0),t(y,{modelValue:o.mobileNumber,"onUpdate:modelValue":e[0]||(e[0]=a=>o.mobileNumber=a),errorText:r.getFormError("mobileNumber"),onKeydown:b(f.handleLogin,["enter"])},null,8,["modelValue","errorText","onKeydown"]),o.accountExists?(i(),l(p,{key:1},[o.requiresPassword?(i(),g(w,{key:0},{default:c(()=>[n(" Please set a new password for your account. ")]),_:1})):d("",!0),t(P,{modelValue:o.password,"onUpdate:modelValue":e[1]||(e[1]=a=>o.password=a),showForgotPassword:!o.requiresPassword,errorText:r.getFormError("password"),onKeydown:b(f.handleLogin,["enter"])},null,8,["modelValue","showForgotPassword","errorText","onKeydown"]),o.requiresPassword?(i(),l(p,{key:1},[t(N,{modelValue:o.passwordConfirmation,"onUpdate:modelValue":e[2]||(e[2]=a=>o.passwordConfirmation=a),errorText:r.getFormError("passwordConfirmation"),onKeydown:b(f.handleLogin,["enter"])},null,8,["modelValue","errorText","onKeydown"]),t(w,null,{default:c(()=>[n(" Dial "),m("span",eo,x(o.mobileVerificationShortcode),1),n(" and enter the verification code below to confirm ownership of the mobile number "),m("span",ro,x(o.mobileNumber),1)]),_:1}),t(C,{modelValue:o.verificationCode,"onUpdate:modelValue":e[3]||(e[3]=a=>o.verificationCode=a),errorText:r.getFormError("verificationCode")},null,8,["modelValue","errorText"])],64)):d("",!0)],64)):d("",!0),t(F,{action:f.handleLogin,loading:o.isSubmitting,class:"w-full"},{default:c(()=>[o.accountExists&&o.requiresPassword?(i(),l(p,{key:0},[n("Set Password")],64)):o.accountExists&&!o.requiresPassword?(i(),l(p,{key:1},[n("Sign In")],64)):!o.accountExists&&!o.requiresPassword?(i(),l(p,{key:2},[n("Continue")],64)):d("",!0)]),_:1},8,["action","loading"])]),t(k),m("p",so,[to,t(V,{to:{name:"register"}},{default:c(()=>[n("Register")]),_:1})])])])}const ko=Q(X,[["render",io]]);export{ko as default};
