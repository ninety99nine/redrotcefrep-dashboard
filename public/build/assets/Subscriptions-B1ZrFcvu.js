import{u as T,x as V,c as d,b as e,d as l,w as p,r as m,o as n,h as b,q as h,Y as g,e as M,F as v,k as F,t as a,m as w}from"./app-DKsaVPPK.js";import{U as C}from"./UtilsMixin-CBwmyCNB.js";import{T as D}from"./TextHeader-49LsHqmQ.js";import{B as O}from"./BasicTable-8qw1iYP_.js";import{D as H}from"./Datepicker-cOkpTrdy.js";import{M as U}from"./MoreInfoPopover-D-2z7nDh.js";import{g as N}from"./api-repository-CzfJNX-W.js";import{_ as B}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./SearchInput-CAaLFhVF.js";import"./index-D19FfSVG.js";import"./TextInput-D4GnoRym.js";import"./InputErrorMessage-B6-uruB8.js";import"./SpinningLoader-DIvh5Pfz.js";const R=()=>T().apiHome._links;async function E(r=null,t={}){return await N(r??R().showSubscriptions,t)}const L={mixins:[C],components:{TextHeader:D,BasicTable:O,Datepicker:H,MoreInfoPopover:U},data(){return{url:null,searchTerm:null,pagination:null,isFetching:!1,subscriptions:[],tableHeaders:["Name","Mobile #","Service","Status","Start Date","End Date","Plan",""],serviceFilter:"all",statusFilter:"all",dateNameFilter:null,dateValueFilter:null,dateOperationFilter:null,filters:[]}},methods:{onView(r){console.log("view:"+r.name)},onEdit(r){console.log("edit:"+r.name)},onDelete(r){console.log("delete:"+r.name)},paginate(r){this.url=r,this._getSubscriptions()},search(r){this.url=null,this.searchTerm=r,this._getSubscriptions()},addOrUpdateFilter(r){var t="";this.dateOperationFilter=="gte"?t=">=":this.dateOperationFilter=="lte"?t="<=":this.dateOperationFilter=="gt"?t=">":this.dateOperationFilter=="lt"?t="<":this.dateOperationFilter=="e"&&(t="="),this.filters=this.filters.filter(y=>y.name!==this.dateNameFilter);const c={name:this.dateNameFilter,value:this.dateValueFilter,operation:this.dateOperationFilter,displayName:this.dateNameFilter+" "+t+" "+this.dateValueFilter};r==null?this.filters.push(c):this.filters[r]=c,this._getSubscriptions()},showSelectedFilter(r){this.dateNameFilter=r.name,this.dateValueFilter=r.value,this.dateOperationFilter=r.operation},resetAddFilterModal(){this.dateNameFilter="startAt",this.dateOperationFilter="gte",this.dateValueFilter=this.formattedDate()},hideFilterModal(){this.resetAddFilterModal()},removeFilter(){this._getSubscriptions()},_getSubscriptions(){this.isFetching=!0;const r={with_user:"1",with_owner:"1",search:this.searchTerm,with_subscription_plan:"1"};this.statusFilter!="all"&&(r.status=this.statusFilter),this.serviceFilter!="all"&&(r.service=this.serviceFilter);for(let t=0;t<this.filters.length;t++){const c=this.filters[t];["startAt","endAt"].includes(c.name)&&(r[c.name]=c.operation+"-"+this.dateToTimestamp(c.value))}E(this.url,r).then(t=>{t.status==200&&(this.pagination=t.data,this.subscriptions=this.pagination.data),this.isFetching=!1}).catch(t=>{this.isFetching=!1})}},mounted(){V()},created(){this.resetAddFilterModal(),this._getSubscriptions()}},P={class:"px-16 pt-8"},q={class:"flex items-center border-dashed border-b py-6 mb-6"},I={class:"lg:col-span-6 col-span-12"},Z={class:"lg:col-span-6 col-span-12"},j={class:"col-span-12"},G=["onClick"],W={class:"whitespace-nowrap px-4 py-4"},z={class:"whitespace-nowrap px-4 py-4"},Y={class:"whitespace-nowrap px-4 py-4"},J={key:0,class:"flex space-x-1 items-center"},K={key:1,class:"flex space-x-1 items-center text-blue-500"},Q={key:2,class:"flex space-x-1 items-center text-green-500"},X={class:"whitespace-nowrap px-4 py-4"},$={class:"whitespace-nowrap px-4 py-4"},ee={class:"flex space-x-1 items-center"},te={class:"whitespace-nowrap px-4 py-4"},se={class:"flex space-x-1 items-center"},re={class:"whitespace-nowrap px-4 py-4"},ie={class:"flex space-x-1 items-center"},ae={class:"opacity-0 group-hover:opacity-100 transition-opacity px-4 py-4 space-x-4"},oe=["onClick"],le=["onClick"];function ne(r,t,c,y,i,o){const x=m("TextHeader"),u=m("MoreInfoPopover"),_=m("Datepicker"),S=m("BadgeIndicator"),A=m("BasicTable");return n(),d("div",P,[e("div",q,[l(x,null,{default:p(()=>t[7]||(t[7]=[b("Subscriptions")])),_:1}),l(u,{class:"ml-2 mt-1",title:"What Is This?",description:"Subscriptions are records of transactions for services that have a start and end date such as Store or AI Assistant subscriptions",placement:"top"})]),l(A,{pagination:i.pagination,isLoading:i.isFetching,onPaginate:o.paginate,onSearch:o.search,onRefresh:o._getSubscriptions,showAddFilter:!0,filters:i.filters,onAddOrUpdateFilter:o.addOrUpdateFilter,onShowSelectedFilter:o.showSelectedFilter,onHideFilterModal:o.hideFilterModal,onRemoveFilter:o.removeFilter,totalHeaders:i.tableHeaders.length},{primaryFilters:p(()=>[h(e("select",{"onUpdate:modelValue":t[0]||(t[0]=s=>i.serviceFilter=s),onChange:t[1]||(t[1]=(...s)=>o._getSubscriptions&&o._getSubscriptions(...s)),id:"select-service",class:"w-40 block p-2 bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"},t[8]||(t[8]=[e("option",{value:"all"},"Service = All",-1),e("option",{value:"store"},"Store",-1),e("option",{value:"sms alert"},"Sms Alerts",-1),e("option",{value:"ai assistant"},"Ai Assistant",-1)]),544),[[g,i.serviceFilter]]),h(e("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>i.statusFilter=s),onChange:t[3]||(t[3]=(...s)=>o._getSubscriptions&&o._getSubscriptions(...s)),id:"select-status",class:"w-40 block p-2 bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"},t[9]||(t[9]=[e("option",{value:"all"},"Status = All",-1),e("option",{value:"active"},"Active",-1),e("option",{value:"inactive"},"Inactive",-1)]),544),[[g,i.statusFilter]])]),modalFilters:p(()=>[e("div",I,[t[11]||(t[11]=e("label",{for:"select-filter",class:"block mb-2 text-xs font-medium text-gray-900 dark:text-white"},"Select Filter",-1)),h(e("select",{"onUpdate:modelValue":t[4]||(t[4]=s=>i.dateNameFilter=s),id:"select-filter",class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"},t[10]||(t[10]=[e("option",{value:"startAt"},"Start date",-1),e("option",{value:"endAt"},"End date",-1)]),512),[[g,i.dateNameFilter]])]),e("div",Z,[t[13]||(t[13]=e("label",{for:"select-filter-operation",class:"block mb-2 text-xs font-medium text-gray-900 dark:text-white"},"Select Operation",-1)),h(e("select",{"onUpdate:modelValue":t[5]||(t[5]=s=>i.dateOperationFilter=s),id:"select-filter-operation",class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"},t[12]||(t[12]=[e("option",{value:"gte"},"Greater or equal to",-1),e("option",{value:"lte"},"Less or equal to",-1),e("option",{value:"gt"},"Greater than",-1),e("option",{value:"lt"},"Less than",-1),e("option",{value:"e"},"Equal to",-1)]),512),[[g,i.dateOperationFilter]])]),e("div",j,[(n(),M(_,{modelValue:i.dateValueFilter,"onUpdate:modelValue":t[6]||(t[6]=s=>i.dateValueFilter=s),key:i.dateValueFilter},null,8,["modelValue"]))])]),head:p(()=>[e("tr",null,[(n(!0),d(v,null,F(i.tableHeaders,(s,f)=>(n(),d("th",{key:f,scope:"col",class:"whitespace-nowrap px-4 py-3"},a(s),1))),128))])]),body:p(()=>[(n(!0),d(v,null,F(i.subscriptions,(s,f)=>(n(),d("tr",{onClick:w(k=>o.onView(s),["stop"]),key:f,class:"group cursor-pointer bg-white hover:bg-gray-50 border-b"},[e("td",W,a(s._relationships.user._attributes.name),1),e("td",z,a(s._relationships.user.mobileNumber.national),1),e("td",Y,[s.ownerType.toLowerCase()=="store"?(n(),d("div",J,[t[14]||(t[14]=e("svg",{class:"w-3 h-3",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M13.5 21v-7.5a.75.75 0 0 1 .75-.75h3a.75.75 0 0 1 .75.75V21m-4.5 0H2.36m11.14 0H18m0 0h3.64m-1.39 0V9.349M3.75 21V9.349m0 0a3.001 3.001 0 0 0 3.75-.615A2.993 2.993 0 0 0 9.75 9.75c.896 0 1.7-.393 2.25-1.016a2.993 2.993 0 0 0 2.25 1.016c.896 0 1.7-.393 2.25-1.015a3.001 3.001 0 0 0 3.75.614m-16.5 0a3.004 3.004 0 0 1-.621-4.72l1.189-1.19A1.5 1.5 0 0 1 5.378 3h13.243a1.5 1.5 0 0 1 1.06.44l1.19 1.189a3 3 0 0 1-.621 4.72M6.75 18h3.75a.75.75 0 0 0 .75-.75V13.5a.75.75 0 0 0-.75-.75H6.75a.75.75 0 0 0-.75.75v3.75c0 .414.336.75.75.75Z"})],-1)),e("span",null,a(s._relationships.owner.name),1),l(u,{class:"opacity-0 group-hover:opacity-100",title:s._relationships.owner.name,placement:"top"},{description:p(()=>[e("p",null,a(s._relationships.owner.description),1)]),_:2},1032,["title"])])):s.ownerType.toLowerCase()=="ai assistant"?(n(),d("div",K,[t[16]||(t[16]=e("svg",{class:"w-3 h-3",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z"})],-1)),t[17]||(t[17]=e("span",null,"Ai Assistant",-1)),l(u,{class:"opacity-0 group-hover:opacity-100",title:"Ai Assistant",placement:"top"},{description:p(()=>[e("p",null,"Total Requests: "+a(s._relationships.owner.totalRequests),1),e("p",null,"Remaining Tokens: "+a(s._relationships.owner.remainingPaidTokens),1),t[15]||(t[15]=e("div",{class:"my-4 border-b"},null,-1)),e("p",null,"Request Tokens Used: "+a(s._relationships.owner.requestTokensUsed),1),e("p",null,"Response Tokens Used: "+a(s._relationships.owner.responseTokensUsed),1)]),_:2},1024)])):s.ownerType.toLowerCase()=="sms alert"?(n(),d("div",Q,[t[18]||(t[18]=e("svg",{class:"w-3 h-3",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 20.25c4.97 0 9-3.694 9-8.25s-4.03-8.25-9-8.25S3 7.444 3 12c0 2.104.859 4.023 2.273 5.48.432.447.74 1.04.586 1.641a4.483 4.483 0 0 1-.923 1.785A5.969 5.969 0 0 0 6 21c1.282 0 2.47-.402 3.445-1.087.81.22 1.668.337 2.555.337Z"})],-1)),t[19]||(t[19]=e("span",null,"Sms Alerts",-1)),l(u,{class:"opacity-0 group-hover:opacity-100",title:"Sms Alerts",placement:"top"},{description:p(()=>[e("p",null,"Sms Credits Left: "+a(s._relationships.owner.smsCredits),1)]),_:2},1024)])):(n(),d(v,{key:3},[b(a(r.capitalizeAllWords(s.ownerType)),1)],64))]),e("td",X,[l(S,{type:s.hasExpired==!1?"success":"warning",text:s.hasExpired?"Inactive":"Active",showDot:!1},null,8,["type","text"])]),e("td",$,[e("div",ee,[e("span",null,a(r.formattedDatetime(s.startAt)),1),l(u,{class:"opacity-0 group-hover:opacity-100",title:r.formattedRelativeDate(s.startAt),placement:"top"},null,8,["title"])])]),e("td",te,[e("div",se,[e("span",null,a(r.formattedDatetime(s.endAt)),1),l(u,{class:"opacity-0 group-hover:opacity-100",title:r.formattedRelativeDate(s.endAt),placement:"top"},null,8,["title"])])]),e("td",re,[e("div",ie,[e("span",null,a(s._relationships.subscriptionPlan.name),1),l(u,{class:"opacity-0 group-hover:opacity-100",title:s._relationships.subscriptionPlan.name,placement:"top"},{description:p(()=>[e("p",null,a(s._relationships.subscriptionPlan.description),1)]),_:2},1032,["title"])])]),e("td",ae,[e("a",{href:"#",onClick:w(k=>o.onEdit(s),["stop","prevent"]),class:"font-medium text-blue-600 dark:text-blue-500 hover:underline"},"Edit",8,oe),e("a",{href:"#",onClick:w(k=>o.onDelete(s),["stop","prevent"]),class:"font-medium text-red-600 dark:text-red-500 hover:underline"},"Delete",8,le)])],8,G))),128))]),_:1},8,["pagination","isLoading","onPaginate","onSearch","onRefresh","filters","onAddOrUpdateFilter","onShowSelectedFilter","onHideFilterModal","onRemoveFilter","totalHeaders"])])}const Fe=B(L,[["render",ne]]);export{Fe as default};
