import{c,i as N}from"./cloneDeep-oqn_4Jlj.js";import{A}from"./Alert-BJCbLq-J.js";import{F as B}from"./FormMixin-BSf8Kh8A.js";import{U as E,S as D}from"./SpiningLoader-COnJLsaj.js";import{a as V,c as l,d as t,e as a,w as m,F as _,g as n,h as b,t as p,l as H,i as u,r as h,o as r}from"./app-piavnWUw.js";import{u as O}from"./store-store-CV52Rs-E.js";import{T as j}from"./TextInput-DrcRoVTX.js";import{I as R,N as W,L as U}from"./LoadingBackdrop-DMqonLig.js";import{T as Z}from"./TextHeader-C9wn3Won.js";import{C as q}from"./Checkbox-DVNqMNJl.js";import{B as G}from"./BackButton-Jzb0508Y.js";import{S as Y}from"./SelectInput-CfaK-FWb.js";import{C as z}from"./ConfirmModal-CfNuJ83i.js";import{S as J,L as K}from"./LineSkeleton-CjlPsSYc.js";import{P as Q}from"./PrimaryButton-CZPI_FYh.js";import{S as X}from"./SelectInputTags-DVAiCTKu.js";import{M as $}from"./MoreInfoPopover-CKuNZTrg.js";import{M as ee}from"./MobileNumberInput-hFL8-GL-.js";import{B as se}from"./BadgeIndicator-CL1O2gvW.js";import{g as w,p as te,a as ie,d as re}from"./api-repository-LmUqmO20.js";import{_ as oe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./InputLabel-CtY3wyzz.js";import"./InputErrorMessage-D6kZl79B.js";import"./vue3-tags-input.esm-_7BFvsmR.js";import"./StatusDot-BROLAEOo.js";const ae={mixins:[E,B],components:{Alert:A,TextInput:j,TextHeader:Z,Checkbox:q,InputTags:R,BackButton:G,NumberInput:W,SelectInput:Y,ConfirmModal:z,ShineEffect:J,PrimaryButton:Q,LineSkeleton:K,SpiningLoader:D,SelectInputTags:X,MoreInfoPopover:$,LoadingBackdrop:U,MobileNumberInput:ee,BadgeIndicator:se},data(){return{form:{hasFullPermissions:!1,mobileNumbers:["+26772000001"],permissions:[]},teamMember:null,isDeleting:!1,originalForm:null,isSubmitting:!1,authState:V(),isLoadingTeamMember:!1,storeState:O(),selectedAllPermissions:!1,teamMemberPermissionOptions:[],isLoadingTeamMemberPermissions:!1,isLoadingAvailableTeamMemberPermissions:!1}},watch:{"$route.params.team_member_href"(e,s){window.scrollTo(0,0),this.getTeamMember()}},computed:{store(){return this.storeState.store},isInviting(){return this.$route.name==="invite-store-team-member"},isEditting(){return this.$route.name==="show-store-team-member"},teamMemberRole(){return this.teamMember==null?null:this.teamMember._attributes.userStoreAssociation.teamMemberRole},teamMemberStatus(){return this.teamMember==null?null:this.teamMember._attributes.userStoreAssociation.teamMemberStatus},hasPermissions(){return this.totalPermissions>0},totalPermissions(){return this.form.permissions.length},isMe(){return(this.teamMember||{}).id==this.authState.user.id},isCreator(){return this.teamMemberRole.toLowerCase()=="creator"},isInvited(){return this.teamMemberStatus.toLowerCase()=="invited"},hasFullPermissions(){return this.form.hasFullPermissions},hasProvidedMobileNumber(){return this.form.mobileNumbers.length>0&&this.form.mobileNumbers.some(e=>e.trim()!=="")},formHasChanged(){var e=c(this.form),s=c(this.originalForm);return!N(e,s)},mustSaveChanges(){return this.isEditting&&this.formHasChanged&&this.hasProvidedMobileNumber&&(this.hasFullPermissions||this.hasPermissions)&&!this.isLoadingTeamMemberPermissions&&!this.isLoadingAvailableTeamMemberPermissions&&!this.isSubmitting},mustInvite(){return this.isInviting&&this.formHasChanged&&this.hasProvidedMobileNumber&&(this.hasFullPermissions||this.hasPermissions)&&!this.isLoadingTeamMemberPermissions&&!this.isLoadingAvailableTeamMemberPermissions&&!this.isSubmitting}},methods:{goBack(){this.$router.replace({name:"show-store-team-members",params:{store_href:this.store._links.showStore}})},setTeamMemberFields(){this.form.mobileNumbers[0]=(this.teamMember.mobileNumber||{}).international||this.teamMember._relationships.userStoreAssociation.mobileNumber.international,this.originalForm=c(this.form)},getTeamMember(){this.isLoadingTeamMember=!0,w(this.$route.params.team_member_href).then(e=>{e.status==200&&(this.teamMember=e.data.user,this.setTeamMemberFields(),this.showStoreTeamMemberPermissions()),this.isLoadingTeamMember=!1}).catch(e=>{this.isLoadingTeamMember=!1,this.setServerFormErrors(e)})},showStoreTeamMemberPermissions(){this.isLoadingTeamMemberPermissions=!0,w(this.teamMember._links.showStoreTeamMemberPermissions).then(e=>{e.status==200&&(this.form.hasFullPermissions=e.data.hasFullPermissions,this.form.permissions=e.data.permissions.map(s=>({text:s.name,grant:s.grant})),this.originalForm=c(this.form)),this.isLoadingTeamMemberPermissions=!1}).catch(e=>{this.isLoadingTeamMemberPermissions=!1,this.setServerFormErrors(e)})},showTeamMemberPermissionOptions(){this.isLoadingAvailableTeamMemberPermissions=!0,w(this.store._links.showTeamMemberPermissionOptions).then(e=>{e.status==200&&(this.teamMemberPermissionOptions=e.data.map(s=>({text:s.name,grant:s.grant}))),this.isLoadingAvailableTeamMemberPermissions=!1}).catch(e=>{this.isLoadingAvailableTeamMemberPermissions=!1,this.setServerFormErrors(e)})},inviteTeamMember(){this.isSubmitting=!0;var e=c(this.form);this.form.hasFullPermissions?e.permissions=["*"]:e.permissions=e.permissions.map(s=>s.grant),te(this.store._links.inviteStoreTeamMembers,e).then(s=>{s.status==200&&(this.showSuccessfulNotification(s.data.message),this.$router.push({name:"show-store-team-members",params:{store_href:this.store._links.showStore}}),window.scrollTo(0,0)),this.isSubmitting=!1}).catch(s=>{this.isSubmitting=!1,this.setServerFormErrors(s)})},updateTeamMember(){if(!this.isMe){this.isSubmitting=!0;var e=c(this.form);this.form.hasFullPermissions?e.permissions=["*"]:e.permissions=e.permissions.map(s=>s.grant),ie(this.teamMember._links.updateStoreTeamMemberPermissions,e).then(s=>{s.status==200&&(s.data.updated?(this.originalForm=c(this.form),this.showSuccessfulNotification("Team member updated"),this.form.hasFullPermissions&&this.showStoreTeamMemberPermissions()):(this.form=c(this.originalForm),this.setFormError("general",s.data.message),this.notificationState.addWarningNotification(s.data.message))),this.isSubmitting=!1}).catch(s=>{this.isSubmitting=!1,this.setServerFormErrors(s)})}},deleteTeamMember(){this.isDeleting=!0;var e={mobileNumbers:this.form.mobileNumbers};re(this.store._links.removeStoreTeamMembers,e).then(s=>{s.status==200&&(this.showSuccessfulNotification(s.data.message),this.$router.push({name:"show-store-team-members",params:{store_href:this.store._links.showStore}}),window.scrollTo(0,0)),this.isDeleting=!1}).catch(s=>{this.isDeleting=!1,this.setServerFormErrors(s)})}},created(){this.originalForm=c(this.form),this.isEditting&&this.getTeamMember(),this.showTeamMemberPermissionOptions()}},me={class:"flex justify-start items-center border-dashed py-6"},ne={key:0,class:"flex items-center space-x-2"},le={class:"flex items-center space-x-2"},he={class:"relative",action:"#",method:"POST"},ue={class:"flex items-center space-x-2"},de=t("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-6 h-6"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 9v3.75m9-.75a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 3.75h.008v.008H12v-.008Z"})],-1),ce={class:"grid grid-cols-12 gap-4 mb-8"},be={class:"col-span-8 relative"},ge={class:"space-y-4 bg-white shadow-lg rounded-lg border p-4 mb-4"},pe=t("p",{class:"font-bold text-sm"},"Invitation",-1),fe=t("p",{class:"text-sm text-gray-400"},"Enter the mobile number of the person you want to invite e.g +26772000001",-1),_e={key:2},ve={class:"flex items-center space-x-2"},Me=t("span",null,"Mobile Number: ",-1),we={key:1,class:"font-bold"},Te={class:"bg-white shadow-lg rounded-lg border p-4"},Pe={key:1,class:"space-y-2"},Se=t("svg",{class:"w-4 h-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M16.5 10.5V6.75a4.5 4.5 0 1 0-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 0 0 2.25-2.25v-6.75a2.25 2.25 0 0 0-2.25-2.25H6.75a2.25 2.25 0 0 0-2.25 2.25v6.75a2.25 2.25 0 0 0 2.25 2.25Z"})],-1),ke=t("span",null,"You cannot change your own permissions",-1),xe=t("span",{class:"font-bold"},"Full Permissions",-1),ye={class:"col-span-4"},Fe={class:"flex flex-col justify-between bg-white shadow-lg rounded-lg border p-4 relative"},Le={class:"flex items-center space-x-4 mb-2"},Ie=t("div",{class:"flex items-center space-x-2"},[t("svg",{class:"w-4 h-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M13.5 10.5V6.75a4.5 4.5 0 1 1 9 0v3.75M3.75 21.75h10.5a2.25 2.25 0 0 0 2.25-2.25v-6.75a2.25 2.25 0 0 0-2.25-2.25H3.75a2.25 2.25 0 0 0-2.25 2.25v6.75a2.25 2.25 0 0 0 2.25 2.25Z"})]),t("p",{class:"font-bold text-lg"},"Permissions")],-1),Ce=t("p",{class:"text-sm text-gray-400 border-b border-dashed pb-2 mb-4"},"See permissions granted",-1),Ne={key:2,class:"space-y-2"},Ae={class:"text-xs"},Be={key:2,class:"space-y-4 shadow-lg rounded-lg border border-red-300 bg-red-50 p-4"},Ee={class:"font-bold text-black"},De={class:"flex justify-end"},Ve=t("p",{class:"text-lg font-bold border-b border-dashed pb-4 mb-4"},"Confirm Delete",-1),He={class:"mb-8"},Oe={class:"font-bold text-black"};function je(e,s,Re,We,i,o){const S=h("BackButton"),g=h("LineSkeleton"),v=h("ShineEffect"),k=h("TextHeader"),M=h("BadgeIndicator"),x=h("MoreInfoPopover"),T=h("PrimaryButton"),f=h("Alert"),P=h("LoadingBackdrop"),y=h("MobileNumberInput"),F=h("Checkbox"),L=h("SelectInputTags"),I=h("ConfirmModal");return r(),l("div",null,[t("div",me,[a(S,{class:"w-16 mr-4",action:o.goBack},null,8,["action"]),i.isLoadingTeamMember?(r(),l("div",ne,[a(v,{class:"flex space-x-2"},{default:m(()=>[a(g,{width:"w-20 mt-2"}),a(g,{width:"w-16 mt-2"}),a(g,{width:"w-4 mt-2"})]),_:1})])):(r(),l(_,{key:1},[t("div",le,[a(k,null,{default:m(()=>[u(p(o.isInviting?"Add Team Member":i.teamMember._attributes.name),1)]),_:1}),o.isEditting?(r(),n(M,{key:0,type:o.isCreator?"success":"info",text:o.teamMemberRole,showDot:o.isCreator},null,8,["type","text","showDot"])):b("",!0),o.isEditting?(r(),n(M,{key:1,type:o.isInvited?"warning":"info",text:o.teamMemberStatus,showDot:o.isCreator},null,8,["type","text","showDot"])):b("",!0)]),a(x,{class:"ml-2",title:"What Is This?",description:"Team members are people who help you manage your store and grow your business",placement:"top"})],64))]),t("form",he,[o.mustInvite||o.mustSaveChanges?(r(),n(f,{key:0,type:"warning",class:"flex justify-between items-center mb-2"},{default:m(()=>[t("div",ue,[de,t("span",null,p(o.isInviting?"Invite your team member":"Please save your changes"),1)]),a(T,{action:o.isInviting?o.inviteTeamMember:o.updateTeamMember,loading:i.isSubmitting,class:"w-40"},{default:m(()=>[u(p(o.isInviting?"Invite":"Save Changes"),1)]),_:1},8,["action","loading"])]),_:1})):b("",!0),e.getFormError("general")?(r(),n(f,{key:1,type:"warning",class:"mb-4"},{default:m(()=>[u(p(e.getFormError("general")),1)]),_:1})):b("",!0),t("div",ce,[t("div",be,[i.isLoadingTeamMember||i.isSubmitting?(r(),n(P,{key:0,class:"rounded-lg"})):b("",!0),t("div",ge,[o.isInviting?(r(),l(_,{key:0},[pe,fe],64)):b("",!0),o.isInviting?(r(),n(y,{key:1,modelValue:i.form.mobileNumbers[0],"onUpdate:modelValue":s[0]||(s[0]=d=>i.form.mobileNumbers[0]=d),labelPopoverTitle:"What Is This?",errorText:e.getFormError("mobileNumbers0"),labelPopoverDescription:"The mobile number that will be used by customers as the primary contact number of your store"},null,8,["modelValue","errorText"])):(r(),l("div",_e,[t("div",ve,[Me,i.isLoadingTeamMember?(r(),n(v,{key:0},{default:m(()=>[a(g,{width:"w-24"})]),_:1})):(r(),l("span",we,p((i.teamMember.mobileNumber||{}).national||i.teamMember._relationships.userStoreAssociation.mobileNumber.national),1))])]))]),t("div",Te,[i.isLoadingTeamMember||i.isLoadingTeamMemberPermissions||i.isLoadingAvailableTeamMemberPermissions?(r(),n(v,{key:0,class:"space-y-4"},{default:m(()=>[a(g,{width:"w-24"}),a(g,{width:"w-60"})]),_:1})):(r(),l("div",Pe,[o.isMe?(r(),l(_,{key:0},[i.form.hasFullPermissions?(r(),n(f,{key:0,class:"flex items-center space-x-2"},{default:m(()=>[Se,ke]),_:1})):b("",!0)],64)):(r(),l(_,{key:1},[a(F,{label:"Grant Full Permissions",modelValue:i.form.hasFullPermissions,"onUpdate:modelValue":s[1]||(s[1]=d=>i.form.hasFullPermissions=d),labelPopoverTitle:"What Is This?",labelPopoverDescription:"The team member will be granted all available permissions when this is checked"},null,8,["modelValue"]),i.form.hasFullPermissions?(r(),n(f,{key:0},{default:m(()=>[u(" This team member has been granted "),xe,u(" to manage this store ")]),_:1})):(r(),n(L,{key:1,class:"w-full",label:"Permissions",tags:i.form.permissions,labelPopoverTitle:"What Is This?",errorText:e.getFormError("permissions"),selectableTags:i.teamMemberPermissionOptions,onOnTagsChanged:s[2]||(s[2]=d=>i.form.permissions=d),labelPopoverDescription:"Set the permissions for your team member"},null,8,["tags","errorText","selectableTags"]))],64))]))])]),t("div",ye,[t("div",Fe,[i.isLoadingTeamMember||i.isSubmitting?(r(),n(P,{key:0,showSpiningLoader:!1,class:"rounded-lg"})):b("",!0),t("div",Le,[Ie,a(M,{type:"primary",text:i.form.hasFullPermissions?"All":o.totalPermissions,showDot:!1},null,8,["text"])]),Ce,i.isLoadingTeamMember||i.isLoadingTeamMemberPermissions?(r(),n(v,{key:1,class:"space-y-4"},{default:m(()=>[a(g,{width:"w-32"}),a(g,{width:"w-60"})]),_:1})):o.hasPermissions?(r(),l("div",Ne,[(r(!0),l(_,null,H(i.form.permissions,(d,C)=>(r(),l("div",{key:C,class:"flex space-x-2 px-2 border-l-4 border-green-300"},[t("p",Ae,p(d.text),1)]))),128))])):(r(),n(f,{key:3},{default:m(()=>[u(" No permissions granted ")]),_:1}))])])]),i.teamMember&&!o.isCreator?(r(),l("div",Be,[t("p",null,[u("Do you want to remove "),t("span",Ee,p(i.teamMember._attributes.name),1),u("?")]),t("div",De,[a(I,{approveText:"Remove Team Member",approveAction:o.deleteTeamMember,isLoading:i.isDeleting},{content:m(()=>[Ve,t("p",He,[u("Are you sure you want to remove "),t("span",Oe,p(i.teamMember._attributes.name),1),u("?")])]),trigger:m(d=>[a(T,{onClick:d.showModal,loading:i.isDeleting,class:"w-60",type:"danger"},{default:m(()=>[u(" Remove Team Member ")]),_:2},1032,["onClick","loading"])]),_:1},8,["approveAction","isLoading"])])])):b("",!0)])])}const bs=oe(ae,[["render",je]]);export{bs as default};
