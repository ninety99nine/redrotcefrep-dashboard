import{o as l,c as m,d as i,w as u,h as a,b as s,q as E,v as F,n as P,r as n,u as k,a as U,x as D,F as b,f as w,t as N}from"./app-D0qimAzV.js";import{A as B}from"./Alert-CDhotiL-.js";import{F as q}from"./FormMixin-C63lX0CN.js";import{T as A}from"./TextInput-B1SJVYX2.js";import{P as j,u as z}from"./ProfilePhoto-DgeufxP0.js";import{T as L}from"./TextareaInput-Bvsc_tPX.js";import{P as O}from"./PasswordInput-BA4XLAhv.js";import{O as H}from"./OtpInput-DubhvfOg.js";import{P as G}from"./PrimaryButton-DE5VW1bd.js";import{M as J}from"./MoreInfoPopover-CoNeH2Aq.js";import{u as K}from"./form-store-Bfvic_NI.js";import{T as Q}from"./ToogleSwitch-k_ctvUyD.js";import{M as R}from"./MobileNumberInput-B9uBO3bG.js";import{F as W}from"./FormErrorMessages-BONizjl2.js";import{C as X}from"./ConfirmPasswordInput-CMUeTXKp.js";import{U as Y}from"./UtilsMixin-CbFS-0FV.js";import{I as Z}from"./InputLabel-UAYg7twD.js";import{I as $}from"./InputErrorMessage-DyTqa7UM.js";import{_}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./api-repository-9G2HFkus.js";import"./SpinningLoader-bIOLFk1n.js";const ee={props:{modelValue:{type:String},labelPopoverTitle:{type:String},labelPopoverDescription:{type:String},errorText:{type:String}},mixins:[Y],components:{InputLabel:Z,InputErrorMessage:$},data(){return{showPassword:!1,localModelValue:this.modelValue,uniqueId:this.generateUniqueId("current_password")}},watch:{modelValue(r,o){this.updateValue(r)},localModelValue(r,o){this.$emit("update:modelValue",r)}},methods:{updateValue(r){this.localModelValue=r}}},oe={class:"mt-2 relative"},re=["id","name","type"],te={class:"absolute inset-y-0 right-0 flex items-center pr-3"},se=["xmlns"],ie=s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 12a2 2 0 100-4 2 2 0 000 4z"},null,-1),ne=s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M18 10a8.001 8.001 0 11-16 0 8.001 8.001 0 0116 0z"},null,-1),ae=[ie,ne],le=["xmlns"],me=s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"},null,-1),ue=s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 12a7.5 7.5 0 1114.999-1.5L19.5 12H5z"},null,-1),de=[me,ue];function he(r,o,d,M,e,c){const f=n("InputLabel"),h=n("InputErrorMessage");return l(),m("div",null,[i(f,{_for:e.uniqueId,labelPopoverTitle:d.labelPopoverTitle,labelPopoverDescription:d.labelPopoverDescription},{default:u(()=>[a(" Current Password ")]),_:1},8,["_for","labelPopoverTitle","labelPopoverDescription"]),s("div",oe,[E(s("input",{"onUpdate:modelValue":o[0]||(o[0]=p=>e.localModelValue=p),id:e.uniqueId,name:e.uniqueId,type:e.showPassword?"text":"password",autocomplete:"current-password",required:"",class:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-blue-700 sm:text-sm sm:leading-6 px-3"},null,8,re),[[F,e.localModelValue]]),s("div",te,[s("button",{onClick:o[1]||(o[1]=p=>e.showPassword=!e.showPassword),type:"button",class:"text-gray-400 hover:text-gray-700 focus:outline-none focus:text-gray-700"},[(l(),m("svg",{class:P(["h-5 w-5",{hidden:!e.showPassword,block:e.showPassword}]),fill:"none",xmlns:e.showPassword?"http://www.w3.org/2000/svg":"",viewBox:"0 0 20 20",stroke:"currentColor"},ae,10,se)),(l(),m("svg",{class:P(["h-5 w-5",{block:!e.showPassword,hidden:e.showPassword}]),fill:"none",xmlns:e.showPassword?"":"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",stroke:"currentColor"},de,10,le))])])]),i(h,{errorText:d.errorText},null,8,["errorText"])])}const pe=_(ee,[["render",he]]),ce={mixins:[q],components:{Alert:B,TextInput:A,TextareaInput:L,PasswordInput:O,OtpInput:H,PrimaryButton:G,MoreInfoPopover:J,ProfilePhoto:j,ToogleSwitch:Q,MobileNumberInput:R,FormErrorMessages:W,ConfirmPasswordInput:X,CurrentPasswordInput:pe},data(){return{isSubmitting:!1,changePassword:!1,apiState:k(),authState:U(),changeMobileNumber:!1,notificationState:K(),aboutMe:"",lastName:"",firstName:"",password:"",mobileNumber:"",currentPassword:"",verificationCode:"",originalMobileNumber:"",passwordConfirmation:"",mobileVerificationShortcode:null}},computed:{hasChangedMobileNumber(){return this.originalMobileNumber.length==8&&this.originalMobileNumber!=this.mobileNumber}},methods:{setUserDetails(){this.aboutMe=this.authState.user.aboutMe,this.lastName=this.authState.user.lastName,this.firstName=this.authState.user.firstName,this.mobileNumber=this.authState.user.mobileNumber.national,this.originalMobileNumber=this.authState.user.mobileNumber.national,this.mobileVerificationShortcode=this.apiState.apiHome.mobileVerificationShortcode},updateUser(){if(this.hideFormErrors(),this.firstName.trim()=="")this.setFormError("firstName","Enter your first name");else if(this.lastName.trim()=="")this.setFormError("lastName","Enter your last name");else if(this.changePassword&&this.currentPassword.trim()=="")this.setFormError("currentPassword","Enter your current password");else if(this.changePassword&&this.password.trim()=="")this.setFormError("password","Enter your password");else if(this.changePassword&&this.passwordConfirmation.trim()=="")this.setFormError("passwordConfirmation","Enter your password confirmation");else if(this.changePassword&&this.password!=this.passwordConfirmation)this.setFormError("password","Password does not match confirmation");else if(this.changeMobileNumber&&this.mobileNumber.trim()=="")this.setFormError("mobileNumber","Enter your mobile number");else if(this.changeMobileNumber&&this.hasChangedMobileNumber&&this.verificationCode.trim()=="")this.setFormError("verificationCode","Enter your verification code");else{let r={lastName:this.lastName,firstName:this.firstName};this.aboutMe!=null&&this.aboutMe.length&&(r.aboutMe=this.aboutMe),this.changePassword&&(r.password=this.password,r.currentPassword=this.currentPassword,r.passwordConfirmation=this.passwordConfirmation),this.changeMobileNumber&&this.hasChangedMobileNumber&&(r.mobileNumber=this.mobileNumber,r.verificationCode=this.verificationCode),this.isSubmitting=!0,z(this.authState.user,r).then(o=>{o.status==200&&(this.isSubmitting=!1,this.password="",this.currentPassword="",this.changePassword=!1,this.passwordConfirmation="",this.changeMobileNumber=!1,this.originalMobileNumber=this.mobileNumber,this.authState.user=o.data,this.showSuccessfulNotification("Profile updated"))}).catch(o=>{this.isSubmitting=!1,this.setServerFormErrors(o)})}}},mounted(){D()},created(){this.setUserDetails()}},fe={class:"px-16 pt-8"},be={class:"flex min-h-full flex-col justify-center"},we={class:"sm:mx-auto sm:w-full sm:max-w-md p-4 bg-white border border-gray-200 rounded-lg shadow sm:p-6"},ge={class:"mt-10 space-y-6",action:"#",method:"POST"},Pe={class:"grid grid-cols-2 gap-4"},Ne={class:"md:col-span-1 col-span-2"},_e={class:"md:col-span-1 col-span-2"},Me={class:"md:col-span-2"},Ve={class:"font-bold"},xe={class:"font-bold"};function ve(r,o,d,M,e,c){const f=n("ProfilePhoto"),h=n("TextInput"),p=n("TextareaInput"),g=n("ToogleSwitch"),V=n("CurrentPasswordInput"),x=n("PasswordInput"),v=n("ConfirmPasswordInput"),C=n("MobileNumberInput"),T=n("Alert"),S=n("OtpInput"),y=n("FormErrorMessages"),I=n("PrimaryButton");return l(),m("div",fe,[s("div",be,[s("div",we,[i(f,{user:e.authState.user,class:"mx-auto",width:"w-40",height:"h-40"},null,8,["user"]),s("form",ge,[s("div",Pe,[s("div",Ne,[i(h,{modelValue:e.firstName,"onUpdate:modelValue":o[0]||(o[0]=t=>e.firstName=t),label:"First Name",autocomplete:"given-name",errorText:r.getFormError("firstName")},null,8,["modelValue","errorText"])]),s("div",_e,[i(h,{label:"Last Name",modelValue:e.lastName,"onUpdate:modelValue":o[1]||(o[1]=t=>e.lastName=t),autocomplete:"family-name",errorText:r.getFormError("lastName")},null,8,["modelValue","errorText"])]),s("div",Me,[i(p,{rows:2,label:"About Me",modelValue:e.aboutMe,"onUpdate:modelValue":o[2]||(o[2]=t=>e.aboutMe=t),errorText:r.getFormError("aboutMe"),placeholder:"Say something about yourself"},null,8,["modelValue","errorText"])])]),i(g,{modelValue:e.changePassword,"onUpdate:modelValue":o[3]||(o[3]=t=>e.changePassword=t)},{default:u(()=>[a("Change Password")]),_:1},8,["modelValue"]),e.changePassword?(l(),m(b,{key:0},[i(V,{modelValue:e.currentPassword,"onUpdate:modelValue":o[4]||(o[4]=t=>e.currentPassword=t),showForgotPassword:!1,errorText:r.getFormError("currentPassword")},null,8,["modelValue","errorText"]),i(x,{modelValue:e.password,"onUpdate:modelValue":o[5]||(o[5]=t=>e.password=t),showForgotPassword:!1,errorText:r.getFormError("password")},null,8,["modelValue","errorText"]),i(v,{modelValue:e.passwordConfirmation,"onUpdate:modelValue":o[6]||(o[6]=t=>e.passwordConfirmation=t),errorText:r.getFormError("passwordConfirmation")},null,8,["modelValue","errorText"])],64)):w("",!0),i(g,{modelValue:e.changeMobileNumber,"onUpdate:modelValue":o[7]||(o[7]=t=>e.changeMobileNumber=t)},{default:u(()=>[a("Change Mobile Number")]),_:1},8,["modelValue"]),e.changeMobileNumber?(l(),m(b,{key:1},[i(C,{modelValue:e.mobileNumber,"onUpdate:modelValue":o[8]||(o[8]=t=>e.mobileNumber=t),errorText:r.getFormError("mobileNumber")},null,8,["modelValue","errorText"]),c.hasChangedMobileNumber?(l(),m(b,{key:0},[i(T,null,{default:u(()=>[a(" Dial "),s("span",Ve,N(e.mobileVerificationShortcode),1),a(" on "),s("span",xe,N(e.mobileNumber),1),a(" to confirm ownership of this mobile number. ")]),_:1}),i(S,{modelValue:e.verificationCode,"onUpdate:modelValue":o[9]||(o[9]=t=>e.verificationCode=t),errorText:r.getFormError("verificationCode")},null,8,["modelValue","errorText"])],64)):w("",!0)],64)):w("",!0),i(y),i(I,{action:c.updateUser,loading:e.isSubmitting,class:"w-full"},{default:u(()=>[a(" Save Changes ")]),_:1},8,["action","loading"])])])])])}const Qe=_(ce,[["render",ve]]);export{Qe as default};
