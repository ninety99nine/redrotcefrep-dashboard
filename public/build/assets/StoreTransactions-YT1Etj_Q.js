import{s as V,c as a,b as s,d as l,w as c,F as w,f as h,e as u,h as m,r as d,o,k,t as p,m as f,n as U}from"./app-BLw6N2N-.js";import{F as N}from"./FormMixin-DjetEzI6.js";import{U as R}from"./UtilsMixin-CBwmyCNB.js";import{u as H}from"./store-store-BVdLpB3d.js";import{A as F}from"./AddButton-CpCoc2va.js";import{T as q}from"./TextHeader-OjVLqHHa.js";import{B as z}from"./BasicTable-DCt0DyAa.js";import{C as W}from"./Checkbox-DK7vQ2Yi.js";import{C as j}from"./Countdown-C9JdFgeQ.js";import{E as Y}from"./ExternalLink-C-ie89H8.js";import{C as G}from"./ConfirmModal-Bb006nsT.js";import{S as J}from"./SpinningLoader-tCIeisvg.js";import{P as K}from"./PrimaryButton-D5bAGBbb.js";import{M as O}from"./MoreInfoPopover-BMtshnfg.js";import{g as Q,d as X}from"./api-repository-Dpcq158Q.js";import{T as Z}from"./ToogleSwitch-4RJmzzSZ.js";import{B as $}from"./BadgeIndicator-Xeze-fzj.js";import{T as ee}from"./TransactionPaymentStatus-C_bkuCL5.js";import{_ as te}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./form-store-Yx_7yNdu.js";import"./cloneDeep-BSUglKOW.js";import"./SearchInput-U98QlO4-.js";import"./index-D19FfSVG.js";import"./TextInput-DDx3bJaO.js";import"./InputErrorMessage-Bkre_tes.js";const se={mixins:[N,R],components:{AddButton:F,TextHeader:q,BasicTable:z,Checkbox:W,Countdown:j,ExternalLink:Y,ConfirmModal:G,SpinningLoader:J,PrimaryButton:K,MoreInfoPopover:O,ToogleSwitch:Z,BadgeIndicator:$,TransactionPaymentStatus:ee},data(){return{transactions:[],pagination:null,searchTerm:null,checkedRowIds:[],showEverything:!1,appName:V.appName,deletableTransaction:null,isDeletingTransactionIds:[],isLoadingTransactions:!1,storeState:H()}},computed:{store(){return this.storeState.store},tableHeaders(){return this.showEverything?["","Trans #","Description","Payment Status","Amount","Percentage","Payment Method","Requester","Verifyer","Payment Link","Created Date",""]:["","Trans #","Payment Status","Amount","Payment Method","Requester","Verifyer","Payment Link",""]},hasSearchTerm(){return this.searchTerm!=null&&this.searchTerm.trim()!=""}},methods:{onView(n){this.$router.push({name:"show-store-transaction",params:{store_href:this.store._links.showStore,transaction_href:n._links.showTransaction}}).then(()=>{window.scrollTo(0,0)})},navigateToShowCustomers(){this.$router.push({name:"show-store-customers",params:{store_href:this.store._links.showStore}})},showDeleteConfirmationModal(n){this.deletableTransaction=n,this.$nextTick(()=>{this.$refs.confirmDeleteButton.$el.click()})},isDeleting(n){return this.isDeletingTransactionIds.findIndex(e=>e==n.id)!=-1},onAddTransaction(){this.$router.push({name:"create-store-transaction",params:{store_href:this.store._links.showStore}})},paginate(n){this.getTransactions(n)},search(n){this.searchTerm=n,this.getTransactions()},getTransactions(n=null){this.isLoadingTransactions=!0;const e={_relationships:"customer,requestedByUser,manuallyVerifiedByUser,paymentMethod"};this.hasSearchTerm&&(e.search=this.searchTerm),n=n??this.store._links.showStoreTransactions,Q(n,e).then(g=>{g.status==200&&(this.pagination=g.data,this.transactions=this.pagination.data,this.checkedRowIds=this.transactions.map(v=>!1)),this.isLoadingTransactions=!1}).catch(g=>{this.isLoadingTransactions=!1})},deleteTransaction(){this.isDeletingTransactionIds.push(this.deletableTransaction.id),X(this.deletableTransaction._links.deleteTransaction).then(n=>{this.isDeletingTransactionIds.splice(this.isDeletingTransactionIds.findIndex(e=>e==this.deletableTransaction.id,1)),n.status==200&&(n.data.deleted?(this.showSuccessfulNotification("Transaction deleted"),this.isDeletingTransactionIds.length==0&&this.getTransactions()):(this.setFormError("general",n.data.message),this.showUnsuccessfulNotification(n.data.message)))}).catch(n=>{this.isDeletingTransactionIds.splice(this.isDeletingTransactionIds.findIndex(e=>e==this.deletableTransaction.id,1)),this.setServerFormErrors(n)})}},mounted(){},created(){this.getTransactions()}},oe={class:"flex justify-between items-center border-dashed py-6"},ne={class:"flex items-center"},ae=["onClick"],re={class:"whitespace-nowrap px-4 py-4"},ie={class:"flex space-x-1 items-center"},le={key:0,class:"px-4 py-4"},de={class:"min-w-80"},ce={class:"whitespace-nowrap px-4 py-4"},pe={class:"whitespace-nowrap px-4 py-4 text-center"},me={key:1,class:"whitespace-nowrap px-4 py-4 text-center"},he={class:"whitespace-nowrap px-4 py-4 text-center"},ue={class:"whitespace-nowrap px-4 py-4"},ye={key:0},fe={key:1,class:"text-xs text-center text-gray-300"},ge={class:"text-xs text-center text-gray-300"},_e={key:0,class:"whitespace-nowrap px-4 py-4"},xe={key:0,class:"flex items-start space-x-2"},Te={key:0,class:"max-w-80"},we={key:2,class:"text-xs text-center text-gray-300"},be={key:1,class:"text-xs text-center text-gray-300"},ke={key:2,class:"whitespace-nowrap px-4 py-4"},ve={class:"flex space-x-1 items-center"},Se={class:"px-4 py-4 flex items-center space-x-4"},De=["onClick"],Ce=["onClick"],Pe={key:1,class:"flex justify-between space-x-20 bg-white shadow-lg rounded-lg border p-20"},Be={class:"space-y-4"},Ie={class:"mb-8"},Ee={class:"font-bold text-black"};function Le(n,e,g,v,r,i){const S=d("TextHeader"),_=d("MoreInfoPopover"),D=d("ToogleSwitch"),b=d("AddButton"),C=d("Checkbox"),P=d("TransactionPaymentStatus"),T=d("BadgeIndicator"),B=d("ExternalLink"),I=d("Countdown"),E=d("SpinningLoader"),L=d("BasicTable"),A=d("PrimaryButton"),M=d("ConfirmModal");return o(),a("div",null,[s("div",oe,[s("div",ne,[l(S,null,{default:c(()=>e[3]||(e[3]=[s("span",{class:"mr-2"},"ðŸ’µ",-1),m(" Transactions")])),_:1}),l(_,{class:"ml-2 mt-1",title:"What Is This?",description:"Transactions are detailed records of payments made by customers for purchasing products or services from your store.",placement:"top"})]),(r.pagination??{}).total>0?(o(),a(w,{key:0},[l(D,{modelValue:r.showEverything,"onUpdate:modelValue":e[0]||(e[0]=t=>r.showEverything=t),size:"md",labelPopoverTitle:"What Is This?",labelPopoverDescription:"Turn on if you want to show more information about your transactions"},{default:c(()=>e[4]||(e[4]=[m(" Show Everything ")])),_:1},8,["modelValue"]),l(b,{action:i.onAddTransaction},{default:c(()=>e[5]||(e[5]=[s("span",{class:"ml-2"},"Add Transaction",-1)])),_:1},8,["action"])],64)):h("",!0)]),r.isLoadingTransactions||(r.pagination??{}).total>0||i.hasSearchTerm?(o(),u(L,{key:0,pagination:r.pagination,isLoading:r.isLoadingTransactions,onPaginate:i.paginate,onSearch:i.search,onRefresh:i.getTransactions,totalHeaders:i.tableHeaders.length},{head:c(()=>[s("tr",null,[(o(!0),a(w,null,k(i.tableHeaders,(t,y)=>(o(),a("th",{key:y,scope:"col",class:"whitespace-nowrap px-4 py-3"},p(t),1))),128))])]),body:c(()=>[(o(!0),a(w,null,k(r.transactions,(t,y)=>(o(),a("tr",{onClick:f(x=>i.onView(t),["stop"]),key:t.id,class:U(["group cursor-pointer border-b",r.checkedRowIds[y]?"bg-blue-100":"bg-white hover:bg-gray-50"])},[s("td",{onClick:e[1]||(e[1]=f(()=>{},["stop"])),class:"whitespace-nowrap pl-4"},[l(C,{size:"xs",modelValue:r.checkedRowIds[y],"onUpdate:modelValue":x=>r.checkedRowIds[y]=x},null,8,["modelValue","onUpdate:modelValue"])]),s("td",re,[s("div",ie,[s("span",null,"#"+p(t._attributes.number),1),l(_,{class:"opacity-0 group-hover:opacity-100",title:"#"+t._attributes.number,description:t.description,placement:"top"},null,8,["title","description"])])]),r.showEverything?(o(),a("td",le,[s("div",de,p(t.description),1)])):h("",!0),s("td",ce,[l(P,{transaction:t},null,8,["transaction"])]),s("td",pe,p(t.amount.amountWithCurrency),1),r.showEverything?(o(),a("td",me,p(t.percentage.valueSymbol),1)):h("",!0),s("td",he,p(t._relationships.paymentMethod.name),1),s("td",ue,[t._relationships.requestedByUser?(o(),a("span",ye,p(t._relationships.requestedByUser._attributes.name),1)):(o(),a("span",fe,"---"))]),s("td",ge,[t._relationships.verifiedByUser?(o(),a("span",_e,p(t._relationships.verifiedByUser._attributes.name),1)):(o(),u(T,{key:1,type:"info",text:r.appName,showDot:!1},null,8,["text"]))]),s("td",{class:"px-4 py-4",onClick:e[2]||(e[2]=f(()=>{},["stop"]))},[t.metadata?(o(),a("div",xe,[t.metadata.canPayUsingDpo?(o(),a("div",Te,[l(B,{url:t.metadata.dpoPaymentUrl,class:"text-xs"},{default:c(()=>[m(p(t.metadata.dpoPaymentUrl),1)]),_:2},1032,["url"])])):t.metadata.dpoPaymentLinkHasExpired==!0?(o(),u(T,{key:1,type:"warning",text:"Expired",showDot:!1})):(o(),a("span",we,"---")),t.metadata.canPayUsingDpo?(o(),u(_,{key:3,title:"Expires In",placement:"top",class:"opacity-0 group-hover:opacity-100 mt-1"},{description:c(()=>[e[6]||(e[6]=s("div",{class:"border-t border-dashed my-2"},null,-1)),l(I,{showMoreInfoPopover:!1,time:t.metadata.dpoPaymentUrlExpiresAt},null,8,["time"])]),_:2},1024)):h("",!0)])):(o(),a("span",be,"---"))]),r.showEverything?(o(),a("td",ke,[s("div",ve,[s("span",null,p(n.formattedDatetime(t.createdAt)),1),l(_,{class:"opacity-0 group-hover:opacity-100",title:n.formattedRelativeDate(t.createdAt),placement:"top"},null,8,["title"])])])):h("",!0),s("td",Se,[i.isDeleting(t)?h("",!0):(o(),a("a",{key:0,href:"#",onClick:f(x=>i.onView(t),["stop","prevent"]),class:"font-medium text-blue-600 dark:text-blue-500 hover:underline"},"View",8,De)),i.isDeleting(t)?(o(),u(E,{key:1,type:"danger"},{default:c(()=>e[7]||(e[7]=[s("span",{class:"text-xs ml-2"},"Deleting...",-1)])),_:1})):(o(),a("a",{key:2,href:"#",onClick:f(x=>i.showDeleteConfirmationModal(t),["stop","prevent"]),class:"font-medium text-red-600 dark:text-red-500 hover:underline"},"Delete",8,Ce))])],10,ae))),128))]),_:1},8,["pagination","isLoading","onPaginate","onSearch","onRefresh","totalHeaders"])):(o(),a("div",Pe,[s("div",Be,[e[11]||(e[11]=s("h1",{class:"text-2xl font-bold"},"No Transactions Yet",-1)),s("p",null,[e[8]||(e[8]=m("Your transactions will appear here once ")),l(T,{type:"primary",text:"customers",showDot:!1,clickable:!0,action:i.navigateToShowCustomers},null,8,["action"]),e[9]||(e[9]=m(" start paying. Start promoting your store to attract buyers and generate sales. Promote your store on as many platforms as possible."))]),l(b,{action:i.onAddTransaction,class:"w-40",size:"sm"},{default:c(()=>e[10]||(e[10]=[s("span",{class:"ml-2"},"Add Transaction",-1)])),_:1},8,["action"])]),e[12]||(e[12]=s("div",null,[s("span",{class:"text-8xl"},"ðŸ’µ")],-1))])),r.deletableTransaction?(o(),u(M,{key:2,approveText:"Delete Transaction",approveAction:i.deleteTransaction,isLoading:i.isDeleting(r.deletableTransaction)},{content:c(()=>[e[15]||(e[15]=s("p",{class:"text-lg font-bold border-b border-dashed pb-4 mb-4"},"Confirm Delete",-1)),s("p",Ie,[e[13]||(e[13]=m("Are you sure you want to permanently delete ")),s("span",Ee,"transaction #"+p(r.deletableTransaction._attributes.number),1),e[14]||(e[14]=m("?"))])]),trigger:c(t=>[l(A,{ref:"confirmDeleteButton",action:t.showModal,class:"hidden",type:"danger"},{default:c(()=>e[16]||(e[16]=[m(" Delete Transaction ")])),_:2},1032,["action"])]),_:1},8,["approveAction","isLoading"])):h("",!0)])}const nt=te(se,[["render",Le]]);export{nt as default};
