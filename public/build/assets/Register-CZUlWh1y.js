import{R,u as U,s as I,b as P,c as l,d as a,e as i,w as f,f as w,g as h,F as u,h as d,r as s,o as n,i as c,t as N}from"./app-Kf0mCOXy.js";import{L as B}from"./Logo-BQNoWMfN.js";import{A as K}from"./Alert-BHnqwbfj.js";import{F as A,u as M}from"./FormMixin-CYiBG1ca.js";import{U as H}from"./SpiningLoader-CsPmXxst.js";import{T as L}from"./TextInput-_gM6fl6u.js";import{T as O}from"./TextHeader-Cdgnrugi.js";import{B as G}from"./BackButton-CDDlBeJF.js";import{P as q}from"./PasswordInput-BzudAHId.js";import{O as D}from"./OtpInput-BIgB8jHe.js";import{P as j}from"./PrimaryButton-DULDYb5e.js";import{M as W}from"./MobileNumberInput-E_RreW9n.js";import{F as z}from"./FormErrorMessages-Bdf-el1D.js";import{C as J}from"./ConfirmPasswordInput-QARiilHA.js";import{v as Q,r as X}from"./auth-repository-DTDJWzxb.js";import{_ as Y}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./InputLabel-B11U1-WT.js";import"./MoreInfoPopover-gLIaCQca.js";import"./InputErrorMessage-B1NpEu7u.js";const Z={mixins:[A,H],components:{Logo:B,Alert:K,RouterLink:R,TextInput:L,TextHeader:O,BackButton:G,PasswordInput:q,OtpInput:D,PrimaryButton:j,MobileNumberInput:W,FormErrorMessages:z,ConfirmPasswordInput:J},data(){return{registerUrl:null,isSubmitting:!1,accountExistsUrl:null,apiState:U(),validateRegisterUrl:null,appName:I.appName,mobileVerificationShortcode:null,notificationState:M(),accountExists:null,showVerificationCode:!1,lastName:"",password:"",firstName:"",mobileNumber:"",verificationCode:"",passwordConfirmation:""}},beforeRouteEnter(o,e,b){b(p=>{o.query.hasOwnProperty("mobileNumber")&&(p.mobileNumber=o.query.mobileNumber,p.handleRegistration())})},methods:{setUrls(){this.registerUrl=this.apiState.apiHome._links.register,this.accountExistsUrl=this.apiState.apiHome._links.accountExists,this.validateRegisterUrl=this.apiState.apiHome._links.validateRegister,this.mobileVerificationShortcode=this.apiState.apiHome.mobileVerificationShortcode},handleRegistration(){this.hideFormErrors(),this.showVerificationCode?this.attemptRegistration():this.accountExists==null?this.checkIfAccountExists():this.validateRegistration()},checkIfAccountExists(){this.mobileNumber.trim()==""?this.setFormError("mobileNumber","Enter your mobile number"):this.accountExistsUrl!=null?(this.isSubmitting=!0,P.post(this.accountExistsUrl,{mobileNumber:this.mobileNumber}).then(o=>{this.isSubmitting=!1,this.accountExists=o.data.exists,this.accountExists&&this.$router.push({name:"login",query:{mobileNumber:this.mobileNumber}})}).catch(o=>{this.isSubmitting=!1,this.setServerFormErrors(o)})):this.setGeneralFormError("The accountExistsUrl does not exist")},validateRegistration(){if(this.firstName.trim()=="")this.setFormError("firstName","Enter your first name");else if(this.lastName.trim()=="")this.setFormError("lastName","Enter your last name");else if(this.mobileNumber.trim()=="")this.setFormError("mobileNumber","Enter your mobile number");else if(this.password.trim()=="")this.setFormError("password","Enter your password");else if(this.passwordConfirmation.trim()=="")this.setFormError("passwordConfirmation","Enter your password confirmation");else if(this.password!=this.passwordConfirmation)this.setFormError("password","Password does not match confirmation");else if(this.validateRegisterUrl!=null){this.isSubmitting=!0;let o={lastName:this.lastName,password:this.password,firstName:this.firstName,mobileNumber:this.mobileNumber,passwordConfirmation:this.passwordConfirmation};Q(o).then(e=>{e.status==200&&(this.isSubmitting=!1,this.showVerificationCode=!0)}).catch(e=>{this.isSubmitting=!1,this.setServerFormErrors(e)})}else this.setGeneralFormError("The validateRegisterUrl does not exist")},attemptRegistration(){if(this.verificationCode.trim()=="")this.setFormError("verificationCode","Enter your verification code");else if(this.registerUrl!=null){this.isSubmitting=!0;let o={lastName:this.lastName,password:this.password,firstName:this.firstName,mobileNumber:this.mobileNumber,verificationCode:this.verificationCode,passwordConfirmation:this.passwordConfirmation};X(o).then(e=>{e.status==200&&(this.isSubmitting=!1,this.$router.replace({name:"dashboard"}),this.showSuccessfulNotification("Welcome to "+this.appName))}).catch(e=>{this.isSubmitting=!1,this.setServerFormErrors(e)})}else this.setGeneralFormError("The registerUrl does not exist")},backToRegistrationForm(){this.showVerificationCode=!1}},created(){this.setUrls()}},$={class:"flex min-h-full flex-col justify-center px-6 py-12 lg:px-8"},ee={class:"sm:mx-auto sm:w-full sm:max-w-sm"},te={class:"mt-10 sm:mx-auto sm:w-full sm:max-w-sm"},oe={class:"space-y-6",action:"#",method:"POST"},se={class:"font-bold"},re={class:"font-bold"},ie={class:"grid grid-cols-2 gap-4"},ae={class:"md:col-span-1 col-span-2"},ne={class:"md:col-span-1 col-span-2"},me={class:"flex"},le={class:"text-sm text-center mt-8"},ue=a("span",{class:"text-gray-500 mr-1"},"Already have an account?",-1);function ce(o,e,b,p,t,m){const x=s("Logo"),E=s("TextHeader"),_=s("FormErrorMessages"),y=s("Alert"),C=s("OtpInput"),F=s("MobileNumberInput"),g=s("TextInput"),V=s("PasswordInput"),v=s("ConfirmPasswordInput"),S=s("BackButton"),T=s("PrimaryButton"),k=s("router-link");return n(),l("div",$,[a("div",ee,[i(x,{class:"mx-auto"}),i(E,{class:"mt-10 text-center"},{default:f(()=>[c("Create your account")]),_:1})]),a("div",te,[a("form",oe,[o.hasGeneralError?(n(),w(_,{key:0})):h("",!0),t.showVerificationCode?(n(),l(u,{key:1},[i(y,null,{default:f(()=>[c(" Dial "),a("span",se,N(t.mobileVerificationShortcode),1),c(" and enter the verification code below to confirm ownership of the mobile number "),a("span",re,N(t.mobileNumber),1)]),_:1}),i(C,{modelValue:t.verificationCode,"onUpdate:modelValue":e[0]||(e[0]=r=>t.verificationCode=r),errorText:o.getFormError("verificationCode")},null,8,["modelValue","errorText"])],64)):(n(),l(u,{key:2},[i(F,{modelValue:t.mobileNumber,"onUpdate:modelValue":e[1]||(e[1]=r=>t.mobileNumber=r),errorText:o.getFormError("mobileNumber"),onKeydown:d(m.handleRegistration,["enter"])},null,8,["modelValue","errorText","onKeydown"]),t.accountExists==!1?(n(),l(u,{key:0},[a("div",ie,[a("div",ae,[i(g,{modelValue:t.firstName,"onUpdate:modelValue":e[2]||(e[2]=r=>t.firstName=r),label:"First Name",autocomplete:"given-name",errorText:o.getFormError("firstName"),onKeydown:d(m.handleRegistration,["enter"])},null,8,["modelValue","errorText","onKeydown"])]),a("div",ne,[i(g,{modelValue:t.lastName,"onUpdate:modelValue":e[3]||(e[3]=r=>t.lastName=r),label:"Last Name",autocomplete:"family-name",errorText:o.getFormError("lastName"),onKeydown:d(m.handleRegistration,["enter"])},null,8,["modelValue","errorText","onKeydown"])])]),t.firstName&&t.lastName?(n(),l(u,{key:0},[i(V,{modelValue:t.password,"onUpdate:modelValue":e[4]||(e[4]=r=>t.password=r),showForgotPassword:!1,errorText:o.getFormError("password"),onKeydown:d(m.handleRegistration,["enter"])},null,8,["modelValue","errorText","onKeydown"]),i(v,{modelValue:t.passwordConfirmation,"onUpdate:modelValue":e[5]||(e[5]=r=>t.passwordConfirmation=r),errorText:o.getFormError("passwordConfirmation"),onKeydown:d(m.handleRegistration,["enter"])},null,8,["modelValue","errorText","onKeydown"])],64)):h("",!0)],64)):h("",!0)],64)),a("div",me,[t.showVerificationCode?(n(),w(S,{key:0,action:m.backToRegistrationForm,class:"w-16 mr-2"},null,8,["action"])):h("",!0),i(T,{action:m.handleRegistration,loading:t.isSubmitting,class:"w-full"},{default:f(()=>[t.showVerificationCode?(n(),l(u,{key:0},[c("Create Account")],64)):(n(),l(u,{key:1},[c("Continue")],64))]),_:1},8,["action","loading"])])]),a("p",le,[ue,i(k,{to:{name:"login"}},{default:f(()=>[c("Login")]),_:1})])])])}const Re=Y(Z,[["render",ce]]);export{Re as default};
