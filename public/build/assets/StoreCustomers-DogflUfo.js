import{F as L}from"./FormMixin-Dgvngqr1.js";import{U as M}from"./UtilsMixin-CbFS-0FV.js";import{u as V}from"./store-store-Bg5rYxD_.js";import{A as P}from"./AddButton-DSp6KANw.js";import{T as R}from"./TextHeader-2OONdxAo.js";import{C as H}from"./Checkbox-B2GtC5uq.js";import{B as F}from"./BasicTable-uw6X2awn.js";import{C as O}from"./ConfirmModal-DKlczlqI.js";import{P as U}from"./PrimaryButton-DHUftccA.js";import{S as z}from"./SpinningLoader-DBJE88C5.js";import{M as W}from"./MoreInfoPopover-BZ2tVscg.js";import{g as j,d as Y}from"./api-repository-CRee0Q10.js";import{T as q}from"./ToogleSwitch-C2xupFTj.js";import{B as G}from"./BadgeIndicator-CQIXUZqg.js";import{N as J}from"./NoDataPlaceholder-D5cUVnek.js";import{c as a,b as e,d as l,w as m,F as b,f as h,e as u,h as p,r as d,o,k,t as c,p as C,n as K}from"./app-BBiNtTMT.js";import{_ as Q}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./form-store-DVy4TZqf.js";import"./InputErrorMessage-B5IzqFhT.js";import"./SearchInput-CDeKnusL.js";import"./index-B_gOZyBG.js";import"./TextInput-ENsoNhZ_.js";import"./InputLabel-BcWBYAbx.js";import"./StatusDot-Cj_cMTkK.js";const X={mixins:[L,M],components:{AddButton:P,TextHeader:R,BasicTable:F,Checkbox:H,ConfirmModal:O,PrimaryButton:U,SpinningLoader:z,MoreInfoPopover:W,ToogleSwitch:q,BadgeIndicator:G,NoDataPlaceholder:J},data(){return{customers:[],pagination:null,searchTerm:null,checkedRowIds:[],showEverything:!1,deletableCustomer:null,isDeletingCustomerIds:[],isLoadingCustomers:!1,storeState:V()}},computed:{store(){return this.storeState.store},tableHeaders(){return this.showEverything?["","Name","Mobile Number","Email","Birthday","Total Orders","Total Spend","Total Average Spend","Last Order Date","Created Date",""]:["","Name","Mobile Number","Email","Total Orders","Total Spend",""]},hasSearchTerm(){return this.searchTerm!=null&&this.searchTerm.trim()!=""}},methods:{onView(s){this.$router.push({name:"show-store-customer",params:{store_href:this.store._links.showStore,customer_href:s._links.showCustomer}}).then(()=>{window.scrollTo(0,0)})},onAddCustomer(){this.$router.push({name:"create-store-customer",params:{store_href:this.store._links.showStore}})},showDeleteConfirmationModal(s){this.deletableCustomer=s,this.$nextTick(()=>{this.$refs.confirmDeleteButton.$el.click()})},isDeleting(s){return this.isDeletingCustomerIds.findIndex(n=>n==s.id)!=-1},paginate(s){this.getCustomers(s)},search(s){this.searchTerm=s,this.getCustomers()},getCustomers(s=null){this.isLoadingCustomers=!0;const n={};this.hasSearchTerm&&(n.search=this.searchTerm),s=s??this.store._links.showStoreCustomers,j(s,n).then(_=>{_.status==200&&(this.pagination=_.data,this.customers=this.pagination.data,this.checkedRowIds=this.customers.map(v=>!1)),this.isLoadingCustomers=!1}).catch(_=>{this.isLoadingCustomers=!1,this.setServerFormErrors(_)})},deleteCustomer(){this.isDeletingCustomerIds.push(this.deletableCustomer.id),Y(this.deletableCustomer._links.deleteCustomer).then(s=>{this.isDeletingCustomerIds.splice(this.isDeletingCustomerIds.findIndex(n=>n==this.deletableCustomer.id,1)),s.status==200&&(s.data.deleted?(this.showSuccessfulNotification("Customer deleted"),this.isDeletingCustomerIds.length==0&&this.getCustomers()):(this.setFormError("general",s.data.message),this.showUnsuccessfulNotification(s.data.message)))}).catch(s=>{this.isDeletingCustomerIds.splice(this.isDeletingCustomerIds.findIndex(n=>n==this.deletableCustomer.id,1)),this.setServerFormErrors(s)})}},mounted(){},created(){this.getCustomers()}},Z={class:"flex justify-between items-center border-dashed py-6"},$={class:"flex items-center"},ee=e("span",{class:"mr-2"},"ðŸ˜Š",-1),te=e("span",{class:"ml-2"},"Add Customer",-1),se=["onClick"],oe={class:"whitespace-nowrap align-top px-4 py-4"},ie={class:"flex space-x-1 items-center w-40"},re={class:"align-top px-4 py-4"},ae={class:"flex space-x-1 items-center"},ne={key:1},le={class:"align-top px-4 py-4"},de={class:"flex space-x-1 items-center"},ce={key:1},me={key:0,class:"align-top px-4 py-4"},he={class:"flex space-x-1 items-center w-24"},pe={key:1},ue={class:"align-top px-4 py-4"},_e={class:"whitespace-nowrap px-4 py-4"},ge={key:1,class:"whitespace-nowrap px-4 py-4"},fe={key:2,class:"whitespace-nowrap align-top px-4 py-4"},ye={class:"flex space-x-1 items-center"},Ce={key:3,class:"whitespace-nowrap align-top px-4 py-4"},we={class:"flex space-x-1 items-center"},be={class:"align-top px-4 py-4 flex items-center space-x-4"},xe=["onClick"],ke=e("span",{class:"text-xs ml-2"},"Deleting...",-1),ve=["onClick"],De={key:1,class:"flex justify-between space-x-20 bg-white shadow-lg rounded-lg border p-20"},Te={class:"space-y-4"},Se=e("h1",{class:"text-2xl font-bold"},"Add your first customer",-1),Ie=e("span",{class:"ml-2"},"Add Customer",-1),Ae=e("div",null,[e("span",{class:"text-8xl"},"ðŸŽ‰")],-1),Be=e("p",{class:"text-lg font-bold border-b border-dashed pb-4 mb-4"},"Confirm Delete",-1),Ne={class:"mb-8"},Ee={class:"font-bold text-black"};function Le(s,n,_,v,i,r){const D=d("TextHeader"),f=d("MoreInfoPopover"),T=d("ToogleSwitch"),x=d("AddButton"),S=d("Checkbox"),w=d("NoDataPlaceholder"),I=d("SpinningLoader"),A=d("BasicTable"),B=d("BadgeIndicator"),N=d("PrimaryButton"),E=d("ConfirmModal");return o(),a("div",null,[e("div",Z,[e("div",$,[l(D,null,{default:m(()=>[ee,p(" Customers")]),_:1}),l(f,{class:"ml-2 mt-1",title:"What Is This?",description:"Customers are people who are interested in buying your goods or services",placement:"top"})]),(i.pagination??{}).total>0?(o(),a(b,{key:0},[l(T,{modelValue:i.showEverything,"onUpdate:modelValue":n[0]||(n[0]=t=>i.showEverything=t),size:"md",labelPopoverTitle:"What Is This?",labelPopoverDescription:"Turn on if you want to show more information about your customers"},{default:m(()=>[p(" Show Everything ")]),_:1},8,["modelValue"]),l(x,{action:r.onAddCustomer,class:"w-44"},{default:m(()=>[te]),_:1},8,["action"])],64)):h("",!0)]),i.isLoadingCustomers||(i.pagination??{}).total>0||r.hasSearchTerm?(o(),u(A,{key:0,pagination:i.pagination,isLoading:i.isLoadingCustomers,onPaginate:r.paginate,onSearch:r.search,onRefresh:r.getCustomers,totalHeaders:r.tableHeaders.length},{head:m(()=>[e("tr",null,[(o(!0),a(b,null,k(r.tableHeaders,(t,g)=>(o(),a("th",{key:g,scope:"col",class:"whitespace-nowrap px-4 py-3"},c(t),1))),128))])]),body:m(()=>[(o(!0),a(b,null,k(i.customers,(t,g)=>(o(),a("tr",{onClick:C(y=>r.onView(t),["stop"]),key:t.id,class:K(["group cursor-pointer border-b",i.checkedRowIds[g]?"bg-blue-100":"bg-white hover:bg-gray-50"])},[e("td",{onClick:n[1]||(n[1]=C(()=>{},["stop"])),class:"whitespace-nowrap pl-4"},[l(S,{size:"xs",modelValue:i.checkedRowIds[g],"onUpdate:modelValue":y=>i.checkedRowIds[g]=y},null,8,["modelValue","onUpdate:modelValue"])]),e("td",oe,[e("div",ie,[e("span",null,c(t._attributes.name),1),l(f,{class:"opacity-0 group-hover:opacity-100",title:t._attributes.name,description:t.notes,placement:"top"},null,8,["title","description"])])]),e("td",re,[e("div",ae,[t.mobileNumber==null?(o(),u(w,{key:0})):(o(),a("span",ne,c(t.mobileNumber.national),1))])]),e("td",le,[e("div",de,[t.email==null?(o(),u(w,{key:0})):(o(),a("span",ce,c(t.email),1))])]),i.showEverything?(o(),a("td",me,[e("div",he,[t.birthday==null?(o(),u(w,{key:0})):(o(),a("span",pe,c(s.formattedDate(t.birthday)),1))])])):h("",!0),e("td",ue,[e("span",null,c(t.totalOrders),1)]),e("td",_e,[e("span",null,c(t.totalSpend.amountWithCurrency),1)]),i.showEverything?(o(),a("td",ge,[e("span",null,c(t.totalAverageSpend.amountWithCurrency),1)])):h("",!0),i.showEverything?(o(),a("td",fe,[e("div",ye,[e("span",null,c(s.formattedDatetime(t.lastOrderAt)),1),l(f,{class:"opacity-0 group-hover:opacity-100",title:s.formattedRelativeDate(t.lastOrderAt),placement:"top"},null,8,["title"])])])):h("",!0),i.showEverything?(o(),a("td",Ce,[e("div",we,[e("span",null,c(s.formattedDatetime(t.createdAt)),1),l(f,{class:"opacity-0 group-hover:opacity-100",title:s.formattedRelativeDate(t.createdAt),placement:"top"},null,8,["title"])])])):h("",!0),e("td",be,[r.isDeleting(t)?h("",!0):(o(),a("a",{key:0,href:"#",onClick:C(y=>r.onView(t),["stop","prevent"]),class:"font-medium text-blue-600 dark:text-blue-500 hover:underline"},"View",8,xe)),r.isDeleting(t)?(o(),u(I,{key:1,type:"danger"},{default:m(()=>[ke]),_:1})):(o(),a("a",{key:2,href:"#",onClick:C(y=>r.showDeleteConfirmationModal(t),["stop","prevent"]),class:"font-medium text-red-600 dark:text-red-500 hover:underline"},"Delete",8,ve))])],10,se))),128))]),_:1},8,["pagination","isLoading","onPaginate","onSearch","onRefresh","totalHeaders"])):(o(),a("div",De,[e("div",Te,[Se,e("p",null,[p("Start building your customer base! You can "),l(B,{type:"primary",text:"add customers",showDot:!1,clickable:!0,action:r.onAddCustomer,class:"cursor-pointer hover:opacity-80"},null,8,["action"]),p(" directly or let them find you by marketing your store.")]),l(x,{action:r.onAddCustomer,class:"w-40",size:"sm"},{default:m(()=>[Ie]),_:1},8,["action"])]),Ae])),i.deletableCustomer?(o(),u(E,{key:2,approveText:"Delete Customer",approveAction:r.deleteCustomer,isLoading:r.isDeleting(i.deletableCustomer)},{content:m(()=>[Be,e("p",Ne,[p("Are you sure you want to permanently delete "),e("span",Ee,c(i.deletableCustomer.name),1),p("?")])]),trigger:m(t=>[l(N,{ref:"confirmDeleteButton",action:t.showModal,class:"hidden",type:"danger"},{default:m(()=>[p(" Delete Customer ")]),_:2},1032,["action"])]),_:1},8,["approveAction","isLoading"])):h("",!0)])}const it=Q(X,[["render",Le]]);export{it as default};
