import{U as C}from"./SpiningLoader-CsPmXxst.js";import{I as F}from"./InputLabel-B11U1-WT.js";import{I as T}from"./InputErrorMessage-B1NpEu7u.js";import{o as n,c as f,f as g,w as m,i as x,t as h,g as y,d as o,k as b,v as M,A as B,q as L,e as d,r as a,u as E}from"./app-Kf0mCOXy.js";import{_ as I}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{c as l,i as D}from"./cloneDeep-Cj89CU0d.js";import{F as U}from"./FormMixin-CYiBG1ca.js";import{T as P}from"./TextInput-_gM6fl6u.js";import{A as q}from"./AddButton-YPx_iiuG.js";import{B as N}from"./BasicModal-CDGWEgr6.js";import{D as z}from"./DeleteButton-qqIC3cPW.js";import{S as j,L as H}from"./LineSkeleton-Ckj2823e.js";import{P as Z}from"./PrimaryButton-DULDYb5e.js";import{C as W}from"./CountrySelectInput-BE301A7u.js";import{p as v,a as O,d as R}from"./api-repository-C4cDgx_E.js";const G={props:{modelValue:{type:String},label:{type:String,default:""},labelPopoverTitle:{type:String},labelPopoverDescription:{type:String},min:{type:String,default:null},max:{type:String,default:null},required:{type:Boolean,default:!0},errorText:{type:String}},mixins:[C],components:{InputLabel:F,InputErrorMessage:T},data(){return{localModelValue:this.modelValue,uniqueId:this.generateUniqueId("text")}},watch:{modelValue(t,e){this.updateValue(t)},localModelValue(t,e){this.$emit("update:modelValue",t)}},methods:{updateValue(t){this.localModelValue=t}}},J={key:0},K=["id","name","min","max","required"],Q={key:1};function X(t,e,r,V,s,p){const u=a("InputLabel"),_=a("InputErrorMessage");return n(),f("div",null,[r.label!=""?(n(),g(u,{key:0,_for:s.uniqueId,labelPopoverTitle:r.labelPopoverTitle,labelPopoverDescription:r.labelPopoverDescription},{default:m(()=>[x(h(r.label),1)]),_:1},8,["_for","labelPopoverTitle","labelPopoverDescription"])):y("",!0),o("div",{class:L([{"mt-2":r.label!=""},"flex items-center rounded-md border-0 shadow-sm ring-1 ring-gray-300 focus-within:ring-2 focus-within:ring-blue-700 sm:text-sm sm:leading-6 text-gray-900"])},[t.$slots.prepend?(n(),f("div",J,[b(t.$slots,"prepend")])):y("",!0),M(o("input",{"onUpdate:modelValue":e[0]||(e[0]=A=>s.localModelValue=A),id:s.uniqueId,name:s.uniqueId,type:"time",min:r.min,max:r.max,required:r.required,class:"w-full rounded-md border-0 focus:ring-0 py-1.5 px-3 sm:text-sm placeholder:text-gray-400"},null,8,K),[[B,s.localModelValue]]),t.$slots.suffix?(n(),f("div",Q,[b(t.$slots,"suffix")])):y("",!0)],2),d(_,{errorText:r.errorText},null,8,["errorText"])])}const Be=I(G,[["render",X]]),Y={mixins:[U],components:{TextInput:P,AddButton:q,BasicModal:N,DeleteButton:z,ShineEffect:j,PrimaryButton:Z,LineSkeleton:H,CountrySelectInput:W},props:{address:{type:[Object,null],default:null},userId:{type:[String,null],default:null},storeId:{type:[String,null],default:null},customerId:{type:[String,null],default:null},deliveryMethodId:{type:[String,null],default:null},title:{type:String,default:"Address"},subtitle:{type:String,default:"Address used by customers to know your store location."}},emits:["onValidated","onCreated","onUpdated","onDeleted"],data(){return{form:{city:"",state:"",country:"BW",placeId:null,addressLine:"",postalCode:"",addressLine2:""},originalForm:null,isSubmitting:!1,completeAddress:null,apiState:E()}},watch:{address(t,e){t?(this.setAddressFields(),this.completeAddress=t._attributes.completeAddress):(this.completeAddress=null,this.resetFormFields())}},computed:{hasAddress(){return this.address!=null},validate(){return this.address===null&&this.userId===null&&this.storeId===null&&this.customerId===null&&this.deliveryMethodId===null},formHasChanged(){var t=l(this.form),e=l(this.originalForm);return!D(t,e)},mustSaveChanges(){return this.formHasChanged&&!this.isSubmitting}},methods:{setAddressFields(){this.form.city=this.address.city,this.form.state=this.address.state,this.form.placeId=this.address.placeId,this.form.country=this.address.country,this.form.postalCode=this.address.postalCode,this.form.addressLine=this.address.addressLine,this.form.addressLine2=this.address.addressLine2,this.originalForm=l(this.form)},resetFormFields(){this.form.city="",this.form.state="",this.form.country="BW",this.form.placeId=null,this.form.postalCode="",this.form.addressLine="",this.form.addressLine2="",this.originalForm=l(this.form)},submit(t){this.validate?this.validateAddress(t):this.hasAddress?this.updateAddress(t):this.createAddress(t)},validateAddress(t){this.isSubmitting=!0,v(this.apiState.apiHome._links.validateAddAddress,this.form).then(e=>{e.status==200&&(t(),this.$emit("onValidated",this.form),this.completeAddress=e.data.completeAddress,this.originalForm=l(this.form)),this.isSubmitting=!1}).catch(e=>{this.isSubmitting=!1,this.setServerFormErrors(e)})},createAddress(t){this.isSubmitting=!0;let e={...this.form,return:"1"};this.userId?e.userId=this.userId:this.storeId?e.storeId=this.storeId:this.customerId?e.customerId=this.customerId:this.deliveryMethodId&&(e.deliveryMethodId=this.deliveryMethodId),v(this.apiState.apiHome._links.createAddress,e).then(r=>{r.status==200&&(t(),this.$emit("onCreated",r.data.address),this.showSuccessfulNotification("Address created"),this.originalForm=l(this.form)),this.isSubmitting=!1}).catch(r=>{this.isSubmitting=!1,this.setServerFormErrors(r)})},updateAddress(t){this.isSubmitting=!0;let e={...this.form,return:"1"};O(this.address._links.updateAddress,e).then(r=>{r.status==200&&(t(),this.$emit("onUpdated",r.data.address),this.showSuccessfulNotification("Address updated"),this.originalForm=l(this.form)),this.isSubmitting=!1}).catch(r=>{this.isSubmitting=!1,this.setServerFormErrors(r)})},deleteAddress(t){if(!this.hasAddress){this.$emit("onDeleted",this.form),this.completeAddress=null,this.resetFormFields(),t();return}this.isSubmitting=!0,R(this.address._links.deleteAddress).then(e=>{e.status==200&&(e.data.deleted?(t(),this.resetFormFields(),this.$emit("onDeleted",e.data.address),this.showSuccessfulNotification("Address deleted")):(this.setFormError("general",e.data.message),this.showUnsuccessfulNotification(e.data.message))),this.isSubmitting=!1}).catch(e=>{this.isSubmitting=!1,this.setServerFormErrors(e)})}},created(){this.address?(this.setAddressFields(),this.completeAddress=this.address._attributes.completeAddress):this.originalForm=l(this.form)}},$={class:"grid grid-cols-2 gap-2"},ee={class:"font-lg font-bold"},te={class:"col-span-2 space-y-2"},se={class:"col-span-1"},re={class:"col-span-1"},oe={class:"col-span-1"},ie={class:"col-span-1"},de={class:"col-span-2 flex space-x-2 mt-4"},le=o("span",{class:"ml-2"},"Delete",-1),ae={class:"space-y-4 p-4 border rounded-lg shadow-lg bg-white"},ne={class:"flex items-center font-lg font-bold"},ue=o("svg",{class:"w-6 h-6 mr-2 flex-shrink-0",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 10.5a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"}),o("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1 1 15 0Z"})],-1),me={class:"text-sm text-gray-500 mb-2 pb-4 border-b border-dashed"},ce={key:0,class:"flex justify-between items-center space-x-20"},he={class:"text-sm"},pe=o("span",{class:"whitespace-nowrap"},"Edit Address",-1),fe=o("span",{class:"ml-2"},"Add Address",-1);function ge(t,e,r,V,s,p){const u=a("TextInput"),_=a("CountrySelectInput"),A=a("DeleteButton"),S=a("PrimaryButton"),w=a("AddButton"),k=a("BasicModal");return n(),g(k,null,{content:m(c=>[o("div",$,[o("h1",ee,h(s.completeAddress?"Edit Address":"Add Address"),1),o("div",te,[d(u,{modelValue:s.form.addressLine,"onUpdate:modelValue":e[0]||(e[0]=i=>s.form.addressLine=i),placeholder:"Street address",errorText:t.getFormError("addressLine")},null,8,["modelValue","errorText"]),d(u,{modelValue:s.form.addressLine2,"onUpdate:modelValue":e[1]||(e[1]=i=>s.form.addressLine2=i),errorText:t.getFormError("addressLine2"),placeholder:"Apartment, unit number, suite, etc. (optional)"},null,8,["modelValue","errorText"])]),o("div",se,[d(u,{modelValue:s.form.city,"onUpdate:modelValue":e[2]||(e[2]=i=>s.form.city=i),placeholder:"City/Town",errorText:t.getFormError("city")},null,8,["modelValue","errorText"])]),o("div",re,[d(u,{modelValue:s.form.state,"onUpdate:modelValue":e[3]||(e[3]=i=>s.form.state=i),placeholder:"State/Province/Region",errorText:t.getFormError("state")},null,8,["modelValue","errorText"])]),o("div",oe,[d(u,{placeholder:"Postal/ZIP code",modelValue:s.form.postalCode,"onUpdate:modelValue":e[4]||(e[4]=i=>s.form.postalCode=i),errorText:t.getFormError("postalCode")},null,8,["modelValue","errorText"])]),o("div",ie,[d(_,{width:"w-full",modelValue:s.form.country,"onUpdate:modelValue":e[5]||(e[5]=i=>s.form.country=i)},null,8,["modelValue"])]),o("div",de,[s.completeAddress?(n(),g(A,{key:0,disabled:s.isSubmitting,onClick:()=>p.deleteAddress(c.hideModal),size:"xs",type:"danger"},{default:m(()=>[le]),_:2},1032,["disabled","onClick"])):y("",!0),d(S,{onClick:()=>p.submit(c.hideModal),disabled:!p.mustSaveChanges,size:"xs",type:"success",class:"w-full"},{default:m(()=>[x(h(s.completeAddress?"Save Address":"Add Address"),1)]),_:2},1032,["onClick","disabled"])])])]),trigger:m(c=>[b(t.$slots,"trigger",{showModal:c.showModal},()=>[o("div",ae,[o("h1",ne,[ue,o("span",null,h(r.title),1)]),o("p",me,h(r.subtitle),1),s.completeAddress?(n(),f("div",ce,[o("span",he,h(s.completeAddress),1),d(S,{onClick:c.showModal,size:"xs",type:"light"},{default:m(()=>[pe]),_:2},1032,["onClick"])])):(n(),g(w,{key:1,onClick:c.showModal,size:"sm",type:"light"},{default:m(()=>[fe]),_:2},1032,["onClick"]))])])]),_:3})}const Le=I(Y,[["render",ge]]);export{Le as A,Be as T};
