import{P as V}from"./Pill-CD_3pjy5.js";import{F as B}from"./FormMixin-D44Bj-el.js";import{B as A}from"./Button-CTlUNYLQ.js";import{U as N}from"./form-store-B_ZbhArT.js";import{u as E}from"./store-store-CxinBL3L.js";import{C as F}from"./Checkbox-BOFyOk4h.js";import{B as R}from"./BasicTable-BCie5vLF.js";import{C as z}from"./ConfirmModal-CKYpWGJT.js";import{S as U}from"./SpinningLoader-BnJGVf_7.js";import{M as H}from"./MoreInfoPopover-CrxGv8yo.js";import{g as j,d as O}from"./api-repository-CIJPUswr.js";import{T as W}from"./ToogleSwitch-CtY-gb5u.js";import{N as Y}from"./NoDataPlaceholder-L-PjtqdQ.js";import{c as n,b as t,e as _,B as q,w as l,d,r as m,o as i,h,F as f,k as w,t as c,m as x,n as G,f as u}from"./app-DEkFCb1u.js";import{_ as J}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ShineEffect-CWpUJr6E.js";import"./cloneDeep-BGE7Bmb-.js";import"./InputErrorMessage-lzTzq-uZ.js";import"./SearchInput-BKDyZ1Nd.js";import"./index-D14zHmA0.js";import"./TextInput-CwB-G_mS.js";import"./SelectInput-DXfLro8i.js";import"./Drawer-DoikbwU2.js";import"./MoneyInput-C1qj8tqg.js";import"./Datepicker-HHxVzfmA.js";import"./vue-draggable-next.esm-bundler-C7oHOHQm.js";const K={mixins:[B,N],components:{Pill:V,Button:A,BasicTable:R,Checkbox:F,ConfirmModal:z,SpinningLoader:U,MoreInfoPopover:H,ToogleSwitch:W,NoDataPlaceholder:Y},data(){return{promotions:[],pagination:null,searchTerm:null,checkedRowIds:[],showEverything:!1,deletablePromotion:null,isDeletingPromotionIds:[],isLoadingPromotions:!1,storeState:E()}},watch:{isLoadingStore(s){s||this.getPromotions()}},computed:{store(){return this.storeState.store},isLoadingStore(){return this.storeState.isLoadingStore},tableHeaders(){return this.showEverything?["","Name","Description","Instructions","Status","Offers","Created Date",""]:["","Name","Description","Status","Offers",""]},hasSearchTerm(){return this.searchTerm!=null&&this.searchTerm.trim()!=""}},methods:{onView(s){this.isDeletingPromotionIds.length||this.$router.push({name:"show-store-promotion",params:{store_href:this.store._links.showStore,promotion_href:s._links.showPromotion}})},showDeleteConfirmationModal(s){this.deletablePromotion=s,this.deletePromotionModal.showModal()},isDeleting(s){return this.isDeletingPromotionIds.findIndex(e=>e==s.id)!=-1},onAddPromotion(){this.isDeletingPromotionIds.length||this.$router.push({name:"create-store-promotion",params:{store_href:this.store._links.showStore}})},paginate(s){this.getPromotions(s)},search(s){this.searchTerm=s,this.getPromotions()},getPromotions(s=null){this.isLoadingPromotions=!0;const e={};this.hasSearchTerm&&(e.search=this.searchTerm),s=s??this.store._links.showStorePromotions,j(s,e).then(g=>{g.status==200&&(this.pagination=g.data,this.promotions=this.pagination.data,this.checkedRowIds=this.promotions.map(D=>!1)),this.isLoadingPromotions=!1}).catch(g=>{this.isLoadingPromotions=!1,this.formState.setServerFormErrors(g)})},deletePromotion(){this.isDeletingPromotionIds.push(this.deletablePromotion.id),O(this.deletablePromotion._links.deletePromotion).then(s=>{this.isDeletingPromotionIds.splice(this.isDeletingPromotionIds.findIndex(e=>e==this.deletablePromotion.id,1)),s.status==200&&(s.data.deleted?(this.notificationState.showSuccessNotification("Promotion deleted"),this.isDeletingPromotionIds.length==0&&this.getPromotions()):(this.formState.setFormError("general",s.data.message),this.notificationState.showWarningNotification(s.data.message)))}).catch(s=>{this.isDeletingPromotionIds.splice(this.isDeletingPromotionIds.findIndex(e=>e==this.deletablePromotion.id,1)),this.formState.setServerFormErrors(s)})}},mounted(){this.deletePromotionModal=this.$refs.deletePromotionModal},created(){this.isLoadingPromotions=!0}},Q={class:"pt-24 pb-80 px-8 relative"},X={class:"relative"},Z={class:"flex justify-center my-4"},$=["onClick"],ee={class:"whitespace-nowrap align-top px-4 py-4"},te={class:"flex space-x-1 items-center w-40"},oe={class:"align-top px-4 py-4"},se={class:"flex space-x-1 items-center w-80"},ie={key:1},ne={key:0,class:"align-top px-4 py-4"},re={class:"w-80 bg-green-50 border border-green-200 rounded-md py-2 px-6 mb-2 shadow-md"},ae={class:"space-y-2 list-disc text-xs"},le={class:"whitespace-nowrap align-top px-4 py-4"},de={class:"flex space-x-1 items-center"},ce={class:"whitespace-nowrap align-top px-4 py-4"},me={class:"flex items-center space-x-2"},pe={class:"whitespace-normal space-y-2 border-t border-dashed pt-2 mt-4"},he={key:1,class:"whitespace-nowrap align-top px-4 py-4"},ue={class:"flex space-x-1 items-center"},fe={class:"align-top px-4 py-4 flex items-center space-x-4"},ge=["onClick"],ye=["onClick"],_e={key:1,class:"flex justify-center"},Pe={class:"animated-border-blue w-96 bg-white py-4 px-4 shadow-sm space-y-4 rounded-xl"},we={class:"flex justify-end"},xe={key:0,class:"mb-8"},be={class:"font-bold text-black"};function ve(s,e,g,D,r,a){const S=m("ToogleSwitch"),k=m("Button"),C=m("Checkbox"),P=m("MoreInfoPopover"),I=m("NoDataPlaceholder"),b=m("Pill"),T=m("SpinningLoader"),L=m("BasicTable"),M=m("ConfirmModal");return i(),n("div",Q,[e[13]||(e[13]=t("img",{src:"/images/clouds.png",class:"absolute top-0"},null,-1)),t("div",X,[e[9]||(e[9]=t("div",{class:"flex flex-col items-center mb-8"},[t("h1",{class:"space-x-2 text-xl text-gray-700 font-semibold bg-white rounded-full py-2 px-8 mb-4"},[t("span",null,"ðŸ¤©"),t("span",null,"Promotions")]),t("img",{src:"/images/store-rooftop.png",class:"w-96"})],-1)),r.isLoadingPromotions||(r.pagination??{}).total>0||a.hasSearchTerm?(i(),_(L,{key:0,pagination:r.pagination,isLoading:r.isLoadingPromotions,onPaginate:a.paginate,onSearch:a.search,onRefresh:a.getPromotions,totalHeaders:a.tableHeaders.length},q({afterRefreshButton:l(()=>[d(k,{action:a.onAddPromotion,type:"primary",size:"sm",icon:"add"},{default:l(()=>e[3]||(e[3]=[t("span",null,"Add Promotion",-1)])),_:1},8,["action"])]),head:l(()=>[t("tr",null,[(i(!0),n(f,null,w(a.tableHeaders,(o,y)=>(i(),n("th",{key:y,scope:"col",class:"whitespace-nowrap px-4 py-3"},c(o),1))),128))])]),body:l(()=>[(i(!0),n(f,null,w(r.promotions,(o,y)=>(i(),n("tr",{onClick:x(p=>a.onView(o),["stop"]),key:o.id,class:G(["group cursor-pointer border-b",r.checkedRowIds[y]?"bg-blue-100":"bg-white hover:bg-gray-50"])},[t("td",{onClick:e[1]||(e[1]=x(()=>{},["stop"])),class:"whitespace-nowrap pl-4"},[d(C,{size:"xs",modelValue:r.checkedRowIds[y],"onUpdate:modelValue":p=>r.checkedRowIds[y]=p},null,8,["modelValue","onUpdate:modelValue"])]),t("td",ee,[t("div",te,[t("span",null,c(o.name),1),d(P,{class:"opacity-0 group-hover:opacity-100",title:o.name,description:o.description,placement:"top"},null,8,["title","description"])])]),t("td",oe,[t("div",se,[o.description==null?(i(),_(I,{key:0})):(i(),n("span",ie,c(o.description),1))])]),r.showEverything?(i(),n("td",ne,[t("div",re,[t("ul",ae,[(i(!0),n(f,null,w(o._attributes.instructions,(p,v)=>(i(),n("li",{key:v},c(p),1))),128))])])])):u("",!0),t("td",le,[t("div",de,[d(b,{type:o.active.status?"success":"warning",size:"xs"},{default:l(()=>[h(c(o.active.name),1)]),_:2},1032,["type"]),d(P,{class:"opacity-0 group-hover:opacity-100",description:o.active.description,placement:"top"},null,8,["description"])])]),t("td",ce,[t("div",me,[o.offerDiscount.status?(i(),_(b,{key:0,type:"success",size:"xs"},{default:l(()=>[o.discountType.toLowerCase()=="fixed"?(i(),n(f,{key:0},[h(c(`${o.discountFixedRate.amountWithCurrency} Discount`),1)],64)):o.discountType.toLowerCase()=="percentage"?(i(),n(f,{key:1},[h(c(`${o.discountPercentageRate.valueSymbol} Discount`),1)],64)):u("",!0)]),_:2},1024)):u("",!0),o.offerFreeDelivery.status?(i(),_(b,{key:1,type:"success",size:"xs"},{default:l(()=>e[4]||(e[4]=[h("Free Delivery")])),_:1})):u("",!0),d(P,{class:"opacity-0 group-hover:opacity-100",title:"Instructions",placement:"top"},{description:l(()=>[t("div",pe,[(i(!0),n(f,null,w(o._attributes.instructions,(p,v)=>(i(),n("p",{key:v},c(p),1))),128))])]),_:2},1024)])]),r.showEverything?(i(),n("td",he,[t("div",ue,[t("span",null,c(s.formattedDatetime(o.createdAt)),1),d(P,{class:"opacity-0 group-hover:opacity-100",title:s.formattedRelativeDate(o.createdAt),placement:"top"},null,8,["title"])])])):u("",!0),t("td",fe,[a.isDeleting(o)?u("",!0):(i(),n("span",{key:0,onClick:x(p=>a.onView(o),["stop","prevent"]),class:"cursor-pointer font-medium text-blue-600 dark:text-blue-500 hover:underline"},"View",8,ge)),a.isDeleting(o)?(i(),_(T,{key:1,type:"danger"},{default:l(()=>e[5]||(e[5]=[t("span",{class:"text-xs ml-2"},"Deleting...",-1)])),_:1})):(i(),n("span",{key:2,onClick:x(p=>a.showDeleteConfirmationModal(o),["stop","prevent"]),class:"cursor-pointer font-medium text-red-600 dark:text-red-500 hover:underline"},"Delete",8,ye))])],10,$))),128))]),_:2},[(r.pagination??{}).total>0?{name:"header",fn:l(()=>[t("div",Z,[d(S,{modelValue:r.showEverything,"onUpdate:modelValue":e[0]||(e[0]=o=>r.showEverything=o),size:"md",labelPopoverTitle:"What Is This?",labelPopoverDescription:"Turn on if you want to show more information about your promotions"},{default:l(()=>e[2]||(e[2]=[h(" Show Everything ")])),_:1},8,["modelValue"])])]),key:"0"}:void 0]),1032,["pagination","isLoading","onPaginate","onSearch","onRefresh","totalHeaders"])):(i(),n("div",_e,[t("div",Pe,[e[7]||(e[7]=t("h1",{class:"text-xl font-bold"}," Create Your First Promotion ",-1)),e[8]||(e[8]=t("p",{class:"text-sm text-gray-500"}," Create amazing incentives for your customers, such as offering discounts and free delivery, while determining who can claim them and when. ",-1)),t("div",we,[d(k,{action:a.onAddPromotion,type:"primary",size:"sm",icon:"add"},{default:l(()=>e[6]||(e[6]=[t("span",null,"Add Promotion",-1)])),_:1},8,["action"])])])]))]),d(M,{ref:"deletePromotionModal",approveText:"Delete Promotion",approveAction:a.deletePromotion,isLoading:a.isDeleting(r.deletablePromotion)},{content:l(()=>[e[12]||(e[12]=t("p",{class:"text-lg font-bold border-b border-dashed pb-4 mb-4"},"Confirm Delete",-1)),r.deletablePromotion?(i(),n("p",xe,[e[10]||(e[10]=h("Are you sure you want to permanently delete ")),t("span",be,c(r.deletablePromotion.name),1),e[11]||(e[11]=h("?"))])):u("",!0)]),_:1},8,["approveAction","isLoading"])])}const Qe=J(K,[["render",ve]]);export{Qe as default};
