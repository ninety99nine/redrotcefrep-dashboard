import{R as k,u as q,a as U,b as v,c as l,d as m,e as t,w as c,f as g,g as d,h as w,F as f,r as s,o as i,i as n,t as x}from"./app-Kf0mCOXy.js";import{L as T}from"./Logo-BQNoWMfN.js";import{A as I}from"./Alert-BHnqwbfj.js";import{F as L,u as M}from"./FormMixin-CYiBG1ca.js";import{U as A}from"./SpiningLoader-CsPmXxst.js";import{T as B}from"./TextHeader-Cdgnrugi.js";import{l as K}from"./auth-repository-DTDJWzxb.js";import{P as H}from"./PasswordInput-BzudAHId.js";import{O}from"./OtpInput-BIgB8jHe.js";import{P as R}from"./PrimaryButton-DULDYb5e.js";import{M as D}from"./MobileNumberInput-E_RreW9n.js";import{F as G}from"./FormErrorMessages-Bdf-el1D.js";import{C as j}from"./ConfirmPasswordInput-QARiilHA.js";import{_ as W}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./InputLabel-B11U1-WT.js";import"./MoreInfoPopover-gLIaCQca.js";import"./InputErrorMessage-B1NpEu7u.js";const z={mixins:[L,A],components:{Logo:T,Alert:I,RouterLink:k,TextHeader:B,PasswordInput:H,OtpInput:O,PrimaryButton:R,MobileNumberInput:D,FormErrorMessages:G,ConfirmPasswordInput:j},data(){return{loginUrl:null,isSubmitting:!1,accountExistsUrl:null,apiState:q(),authState:U(),showPasswordConfirmation:!1,mobileVerificationShortcode:null,notificationState:M(),accountExists:!1,requiresPassword:!1,password:"",mobileNumber:"",verificationCode:"",passwordConfirmation:""}},beforeRouteEnter(o,r,u){u(p=>{o.query.hasOwnProperty("mobileNumber")&&(p.mobileNumber=o.query.mobileNumber,p.handleLogin())})},methods:{setUrls(){this.loginUrl=this.apiState.apiHome._links.login,this.accountExistsUrl=this.apiState.apiHome._links.accountExists,this.mobileVerificationShortcode=this.apiState.apiHome.mobileVerificationShortcode},handleLogin(){this.hideFormErrors(),this.accountExists?this.attemptLogin():this.checkIfAccountExists()},checkIfAccountExists(){this.mobileNumber.trim()==""?this.setFormError("mobileNumber","Enter your mobile number"):this.accountExistsUrl!=null?(this.isSubmitting=!0,v.post(this.accountExistsUrl,{mobileNumber:this.mobileNumber}).then(o=>{this.isSubmitting=!1,this.accountExists=o.data.exists,this.accountExists?this.requiresPassword=o.data.accountSummary.requiresPassword:this.$router.push({name:"register",query:{mobileNumber:this.mobileNumber}})}).catch(o=>{this.isSubmitting=!1,this.setServerFormErrors(o)})):this.setGeneralFormError("The accountExistsUrl does not exist")},attemptLogin(){if(this.mobileNumber.trim()=="")this.setFormError("mobileNumber","Enter your mobile number");else if(this.password.trim()=="")this.setFormError("password","Enter your password");else if(this.requiresPassword&&this.passwordConfirmation.trim()=="")this.setFormError("passwordConfirmation","Enter your password confirmation");else if(this.requiresPassword&&this.password!=this.passwordConfirmation)this.setFormError("password","Password does not match confirmation");else if(this.requiresPassword&&this.verificationCode.trim()=="")this.setFormError("verificationCode","Enter your verification code");else if(this.loginUrl!=null){this.isSubmitting=!0;let o={password:this.password,mobileNumber:this.mobileNumber};this.requiresPassword&&(o.verificationCode=this.verificationCode,o.passwordConfirmation=this.passwordConfirmation),K(o).then(r=>{if(r.status==200){this.isSubmitting=!1;const u=this.$route.query.redirect;u?this.$router.replace(u):(this.$router.replace({name:"dashboard"}),this.showSuccessfulNotification("Welcome back "+this.authState.user.firstName))}}).catch(r=>{this.isSubmitting=!1,this.setServerFormErrors(r)})}else this.setGeneralFormError("The loginUrl does not exist")}},created(){this.setUrls()}},J={class:"flex min-h-full flex-col justify-center px-6 py-12 lg:px-8"},Q={class:"sm:mx-auto sm:w-full sm:max-w-sm"},X={class:"mt-10 sm:mx-auto sm:w-full sm:max-w-sm"},Y={class:"space-y-6",action:"#",method:"POST"},Z={class:"font-bold"},$={class:"font-bold"},ee={class:"text-sm text-center mt-8"},oe=m("span",{class:"text-gray-500 mr-1"},"Don't have an account?",-1);function re(o,r,u,p,e,h){const E=s("Logo"),_=s("TextHeader"),y=s("FormErrorMessages"),P=s("MobileNumberInput"),b=s("Alert"),S=s("PasswordInput"),N=s("ConfirmPasswordInput"),C=s("OtpInput"),F=s("PrimaryButton"),V=s("router-link");return i(),l("div",J,[m("div",Q,[t(E,{class:"mx-auto"}),t(_,{class:"mt-10 text-center"},{default:c(()=>[n("Sign in to your account")]),_:1})]),m("div",X,[m("form",Y,[o.hasGeneralError?(i(),g(y,{key:0})):d("",!0),t(P,{modelValue:e.mobileNumber,"onUpdate:modelValue":r[0]||(r[0]=a=>e.mobileNumber=a),errorText:o.getFormError("mobileNumber"),onKeydown:w(h.handleLogin,["enter"])},null,8,["modelValue","errorText","onKeydown"]),e.accountExists?(i(),l(f,{key:1},[e.requiresPassword?(i(),g(b,{key:0},{default:c(()=>[n(" Please set a new password for your account. ")]),_:1})):d("",!0),t(S,{modelValue:e.password,"onUpdate:modelValue":r[1]||(r[1]=a=>e.password=a),showForgotPassword:!e.requiresPassword,errorText:o.getFormError("password"),onKeydown:w(h.handleLogin,["enter"])},null,8,["modelValue","showForgotPassword","errorText","onKeydown"]),e.requiresPassword?(i(),l(f,{key:1},[t(N,{modelValue:e.passwordConfirmation,"onUpdate:modelValue":r[2]||(r[2]=a=>e.passwordConfirmation=a),errorText:o.getFormError("passwordConfirmation"),onKeydown:w(h.handleLogin,["enter"])},null,8,["modelValue","errorText","onKeydown"]),t(b,null,{default:c(()=>[n(" Dial "),m("span",Z,x(e.mobileVerificationShortcode),1),n(" and enter the verification code below to confirm ownership of the mobile number "),m("span",$,x(e.mobileNumber),1)]),_:1}),t(C,{modelValue:e.verificationCode,"onUpdate:modelValue":r[3]||(r[3]=a=>e.verificationCode=a),errorText:o.getFormError("verificationCode")},null,8,["modelValue","errorText"])],64)):d("",!0)],64)):d("",!0),t(F,{action:h.handleLogin,loading:e.isSubmitting,class:"w-full"},{default:c(()=>[e.accountExists&&e.requiresPassword?(i(),l(f,{key:0},[n("Set Password")],64)):e.accountExists&&!e.requiresPassword?(i(),l(f,{key:1},[n("Sign In")],64)):!e.accountExists&&!e.requiresPassword?(i(),l(f,{key:2},[n("Continue")],64)):d("",!0)]),_:1},8,["action","loading"])]),m("p",ee,[oe,t(V,{to:{name:"register"}},{default:c(()=>[n("Register")]),_:1})])])])}const Ee=W(z,[["render",re]]);export{Ee as default};
