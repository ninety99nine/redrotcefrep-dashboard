import{u as T,x as V,c as d,b as e,d as l,w as p,r as m,o as n,h as b,q as h,Y as g,e as M,F as v,k as F,t as o,m as w}from"./app-DEkFCb1u.js";import{U as C}from"./form-store-B_ZbhArT.js";import{T as D}from"./TextHeader-DRGBY_Ui.js";import{B as O}from"./BasicTable-BCie5vLF.js";import{D as H}from"./Datepicker-HHxVzfmA.js";import{M as U}from"./MoreInfoPopover-CrxGv8yo.js";import{g as N}from"./api-repository-CIJPUswr.js";import{_ as P}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./Pill-CD_3pjy5.js";import"./Button-CTlUNYLQ.js";import"./ShineEffect-CWpUJr6E.js";import"./SpinningLoader-BnJGVf_7.js";import"./SearchInput-BKDyZ1Nd.js";import"./index-D14zHmA0.js";import"./TextInput-CwB-G_mS.js";import"./InputErrorMessage-lzTzq-uZ.js";import"./SelectInput-DXfLro8i.js";import"./cloneDeep-BGE7Bmb-.js";import"./FormMixin-D44Bj-el.js";import"./Drawer-DoikbwU2.js";import"./store-store-CxinBL3L.js";import"./Checkbox-BOFyOk4h.js";import"./MoneyInput-C1qj8tqg.js";import"./vue-draggable-next.esm-bundler-C7oHOHQm.js";import"./ToogleSwitch-CtY-gb5u.js";const B=()=>T().apiHome._links;async function R(s=null,t={}){return await N(s??B().showSubscriptions,t)}const E={mixins:[C],components:{TextHeader:D,BasicTable:O,Datepicker:H,MoreInfoPopover:U},data(){return{url:null,searchTerm:null,pagination:null,isFetching:!1,subscriptions:[],tableHeaders:["Name","Mobile #","Service","Status","Start Date","End Date","Plan",""],serviceFilter:"all",statusFilter:"all",dateNameFilter:null,dateValueFilter:null,dateOperationFilter:null,filters:[]}},methods:{onView(s){console.log("view:"+s.name)},onEdit(s){console.log("edit:"+s.name)},onDelete(s){console.log("delete:"+s.name)},paginate(s){this.url=s,this._getSubscriptions()},search(s){this.url=null,this.searchTerm=s,this._getSubscriptions()},addOrUpdateFilter(s){var t="";this.dateOperationFilter=="gte"?t=">=":this.dateOperationFilter=="lte"?t="<=":this.dateOperationFilter=="gt"?t=">":this.dateOperationFilter=="lt"?t="<":this.dateOperationFilter=="e"&&(t="="),this.filters=this.filters.filter(y=>y.name!==this.dateNameFilter);const c={name:this.dateNameFilter,value:this.dateValueFilter,operation:this.dateOperationFilter,displayName:this.dateNameFilter+" "+t+" "+this.dateValueFilter};s==null?this.filters.push(c):this.filters[s]=c,this._getSubscriptions()},showSelectedFilter(s){this.dateNameFilter=s.name,this.dateValueFilter=s.value,this.dateOperationFilter=s.operation},resetAddFilterModal(){this.dateNameFilter="startAt",this.dateOperationFilter="gte",this.dateValueFilter=this.formattedDate()},hideFilterModal(){this.resetAddFilterModal()},removeFilter(){this._getSubscriptions()},_getSubscriptions(){this.isFetching=!0;const s={with_user:"1",with_owner:"1",search:this.searchTerm,with_subscription_plan:"1"};this.statusFilter!="all"&&(s.status=this.statusFilter),this.serviceFilter!="all"&&(s.service=this.serviceFilter);for(let t=0;t<this.filters.length;t++){const c=this.filters[t];["startAt","endAt"].includes(c.name)&&(s[c.name]=c.operation+"-"+this.dateToTimestamp(c.value))}R(this.url,s).then(t=>{t.status==200&&(this.pagination=t.data,this.subscriptions=this.pagination.data),this.isFetching=!1}).catch(t=>{this.isFetching=!1})}},mounted(){V()},created(){this.resetAddFilterModal(),this._getSubscriptions()}},L={class:"px-16 pt-8"},q={class:"flex items-center border-dashed border-b py-6 mb-6"},I={class:"lg:col-span-6 col-span-12"},Z={class:"lg:col-span-6 col-span-12"},j={class:"col-span-12"},G=["onClick"],W={class:"whitespace-nowrap px-4 py-4"},z={class:"whitespace-nowrap px-4 py-4"},Y={class:"whitespace-nowrap px-4 py-4"},J={key:0,class:"flex space-x-1 items-center"},K={key:1,class:"flex space-x-1 items-center text-blue-500"},Q={key:2,class:"flex space-x-1 items-center text-green-500"},X={class:"whitespace-nowrap px-4 py-4"},$={class:"whitespace-nowrap px-4 py-4"},ee={class:"flex space-x-1 items-center"},te={class:"whitespace-nowrap px-4 py-4"},re={class:"flex space-x-1 items-center"},se={class:"whitespace-nowrap px-4 py-4"},ie={class:"flex space-x-1 items-center"},oe={class:"opacity-0 group-hover:opacity-100 transition-opacity px-4 py-4 space-x-4"},ae=["onClick"],le=["onClick"];function ne(s,t,c,y,i,a){const x=m("TextHeader"),u=m("MoreInfoPopover"),_=m("Datepicker"),S=m("Pill"),A=m("BasicTable");return n(),d("div",L,[e("div",q,[l(x,null,{default:p(()=>t[7]||(t[7]=[b("Subscriptions")])),_:1}),l(u,{class:"ml-2 mt-1",title:"What Is This?",description:"Subscriptions are records of transactions for services that have a start and end date such as Store or AI Assistant subscriptions",placement:"top"})]),l(A,{pagination:i.pagination,isLoading:i.isFetching,onPaginate:a.paginate,onSearch:a.search,onRefresh:a._getSubscriptions,showAddFilter:!0,filters:i.filters,onAddOrUpdateFilter:a.addOrUpdateFilter,onShowSelectedFilter:a.showSelectedFilter,onHideFilterModal:a.hideFilterModal,onRemoveFilter:a.removeFilter,totalHeaders:i.tableHeaders.length},{primaryFilters:p(()=>[h(e("select",{"onUpdate:modelValue":t[0]||(t[0]=r=>i.serviceFilter=r),onChange:t[1]||(t[1]=(...r)=>a._getSubscriptions&&a._getSubscriptions(...r)),id:"select-service",class:"w-40 block p-2 bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"},t[8]||(t[8]=[e("option",{value:"all"},"Service = All",-1),e("option",{value:"store"},"Store",-1),e("option",{value:"sms alert"},"Sms Alerts",-1),e("option",{value:"ai assistant"},"Ai Assistant",-1)]),544),[[g,i.serviceFilter]]),h(e("select",{"onUpdate:modelValue":t[2]||(t[2]=r=>i.statusFilter=r),onChange:t[3]||(t[3]=(...r)=>a._getSubscriptions&&a._getSubscriptions(...r)),id:"select-status",class:"w-40 block p-2 bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"},t[9]||(t[9]=[e("option",{value:"all"},"Status = All",-1),e("option",{value:"active"},"Active",-1),e("option",{value:"inactive"},"Inactive",-1)]),544),[[g,i.statusFilter]])]),modalFilters:p(()=>[e("div",I,[t[11]||(t[11]=e("label",{for:"select-filter",class:"block mb-2 text-xs font-medium text-gray-900 dark:text-white"},"Select Filter",-1)),h(e("select",{"onUpdate:modelValue":t[4]||(t[4]=r=>i.dateNameFilter=r),id:"select-filter",class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"},t[10]||(t[10]=[e("option",{value:"startAt"},"Start date",-1),e("option",{value:"endAt"},"End date",-1)]),512),[[g,i.dateNameFilter]])]),e("div",Z,[t[13]||(t[13]=e("label",{for:"select-filter-operation",class:"block mb-2 text-xs font-medium text-gray-900 dark:text-white"},"Select Operation",-1)),h(e("select",{"onUpdate:modelValue":t[5]||(t[5]=r=>i.dateOperationFilter=r),id:"select-filter-operation",class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"},t[12]||(t[12]=[e("option",{value:"gte"},"Greater or equal to",-1),e("option",{value:"lte"},"Less or equal to",-1),e("option",{value:"gt"},"Greater than",-1),e("option",{value:"lt"},"Less than",-1),e("option",{value:"e"},"Equal to",-1)]),512),[[g,i.dateOperationFilter]])]),e("div",j,[(n(),M(_,{modelValue:i.dateValueFilter,"onUpdate:modelValue":t[6]||(t[6]=r=>i.dateValueFilter=r),key:i.dateValueFilter},null,8,["modelValue"]))])]),head:p(()=>[e("tr",null,[(n(!0),d(v,null,F(i.tableHeaders,(r,f)=>(n(),d("th",{key:f,scope:"col",class:"whitespace-nowrap px-4 py-3"},o(r),1))),128))])]),body:p(()=>[(n(!0),d(v,null,F(i.subscriptions,(r,f)=>(n(),d("tr",{onClick:w(k=>a.onView(r),["stop"]),key:f,class:"group cursor-pointer bg-white hover:bg-gray-50 border-b"},[e("td",W,o(r._relationships.user._attributes.name),1),e("td",z,o(r._relationships.user.mobileNumber.national),1),e("td",Y,[r.ownerType.toLowerCase()=="store"?(n(),d("div",J,[t[14]||(t[14]=e("svg",{class:"w-3 h-3",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M13.5 21v-7.5a.75.75 0 0 1 .75-.75h3a.75.75 0 0 1 .75.75V21m-4.5 0H2.36m11.14 0H18m0 0h3.64m-1.39 0V9.349M3.75 21V9.349m0 0a3.001 3.001 0 0 0 3.75-.615A2.993 2.993 0 0 0 9.75 9.75c.896 0 1.7-.393 2.25-1.016a2.993 2.993 0 0 0 2.25 1.016c.896 0 1.7-.393 2.25-1.015a3.001 3.001 0 0 0 3.75.614m-16.5 0a3.004 3.004 0 0 1-.621-4.72l1.189-1.19A1.5 1.5 0 0 1 5.378 3h13.243a1.5 1.5 0 0 1 1.06.44l1.19 1.189a3 3 0 0 1-.621 4.72M6.75 18h3.75a.75.75 0 0 0 .75-.75V13.5a.75.75 0 0 0-.75-.75H6.75a.75.75 0 0 0-.75.75v3.75c0 .414.336.75.75.75Z"})],-1)),e("span",null,o(r._relationships.owner.name),1),l(u,{class:"opacity-0 group-hover:opacity-100",title:r._relationships.owner.name,placement:"top"},{description:p(()=>[e("p",null,o(r._relationships.owner.description),1)]),_:2},1032,["title"])])):r.ownerType.toLowerCase()=="ai assistant"?(n(),d("div",K,[t[16]||(t[16]=e("svg",{class:"w-3 h-3",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z"})],-1)),t[17]||(t[17]=e("span",null,"Ai Assistant",-1)),l(u,{class:"opacity-0 group-hover:opacity-100",title:"Ai Assistant",placement:"top"},{description:p(()=>[e("p",null,"Total Requests: "+o(r._relationships.owner.totalRequests),1),e("p",null,"Remaining Tokens: "+o(r._relationships.owner.remainingPaidTokens),1),t[15]||(t[15]=e("div",{class:"my-4 border-b"},null,-1)),e("p",null,"Request Tokens Used: "+o(r._relationships.owner.requestTokensUsed),1),e("p",null,"Response Tokens Used: "+o(r._relationships.owner.responseTokensUsed),1)]),_:2},1024)])):r.ownerType.toLowerCase()=="sms alert"?(n(),d("div",Q,[t[18]||(t[18]=e("svg",{class:"w-3 h-3",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 20.25c4.97 0 9-3.694 9-8.25s-4.03-8.25-9-8.25S3 7.444 3 12c0 2.104.859 4.023 2.273 5.48.432.447.74 1.04.586 1.641a4.483 4.483 0 0 1-.923 1.785A5.969 5.969 0 0 0 6 21c1.282 0 2.47-.402 3.445-1.087.81.22 1.668.337 2.555.337Z"})],-1)),t[19]||(t[19]=e("span",null,"Sms Alerts",-1)),l(u,{class:"opacity-0 group-hover:opacity-100",title:"Sms Alerts",placement:"top"},{description:p(()=>[e("p",null,"Sms Credits Left: "+o(r._relationships.owner.smsCredits),1)]),_:2},1024)])):(n(),d(v,{key:3},[b(o(s.capitalizeAllWords(r.ownerType)),1)],64))]),e("td",X,[l(S,{type:r.hasExpired==!1?"success":"warning",text:r.hasExpired?"Inactive":"Active",showDot:!1},null,8,["type","text"])]),e("td",$,[e("div",ee,[e("span",null,o(s.formattedDatetime(r.startAt)),1),l(u,{class:"opacity-0 group-hover:opacity-100",title:s.formattedRelativeDate(r.startAt),placement:"top"},null,8,["title"])])]),e("td",te,[e("div",re,[e("span",null,o(s.formattedDatetime(r.endAt)),1),l(u,{class:"opacity-0 group-hover:opacity-100",title:s.formattedRelativeDate(r.endAt),placement:"top"},null,8,["title"])])]),e("td",se,[e("div",ie,[e("span",null,o(r._relationships.subscriptionPlan.name),1),l(u,{class:"opacity-0 group-hover:opacity-100",title:r._relationships.subscriptionPlan.name,placement:"top"},{description:p(()=>[e("p",null,o(r._relationships.subscriptionPlan.description),1)]),_:2},1032,["title"])])]),e("td",oe,[e("a",{href:"#",onClick:w(k=>a.onEdit(r),["stop","prevent"]),class:"font-medium text-blue-600 dark:text-blue-500 hover:underline"},"Edit",8,ae),e("a",{href:"#",onClick:w(k=>a.onDelete(r),["stop","prevent"]),class:"font-medium text-red-600 dark:text-red-500 hover:underline"},"Delete",8,le)])],8,G))),128))]),_:1},8,["pagination","isLoading","onPaginate","onSearch","onRefresh","filters","onAddOrUpdateFilter","onShowSelectedFilter","onHideFilterModal","onRemoveFilter","totalHeaders"])])}const Ue=P(E,[["render",ne]]);export{Ue as default};
