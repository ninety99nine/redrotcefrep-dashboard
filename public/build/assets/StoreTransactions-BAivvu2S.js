import{s as V,c as a,b as t,d as c,w as d,F as w,f as m,e as u,h,r as l,o as s,k,t as p,p as y,n as U}from"./app-D0qimAzV.js";import{F as N}from"./FormMixin-C63lX0CN.js";import{U as R}from"./UtilsMixin-CbFS-0FV.js";import{u as H}from"./store-store-C-ru5QfR.js";import{A as F}from"./AddButton-DY-U8Alz.js";import{T as q}from"./TextHeader-BfSiTDm9.js";import{B as z}from"./BasicTable-DH2Hnuv2.js";import{C as W}from"./Checkbox-CKnLkmG1.js";import{C as j}from"./Countdown-C8qzmfdl.js";import{E as Y}from"./ExternalLink-DeatE5HC.js";import{C as G}from"./ConfirmModal-7YwgFzGZ.js";import{S as J}from"./SpinningLoader-bIOLFk1n.js";import{P as K}from"./PrimaryButton-DE5VW1bd.js";import{M as O}from"./MoreInfoPopover-CoNeH2Aq.js";import{g as Q,d as X}from"./api-repository-9G2HFkus.js";import{T as Z}from"./ToogleSwitch-k_ctvUyD.js";import{B as $}from"./BadgeIndicator-BTyTsWIY.js";import{T as ee}from"./TransactionPaymentStatus-3ZzsJE7I.js";import{_ as te}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./form-store-Bfvic_NI.js";import"./SearchInput-C_FpErlS.js";import"./index-B_gOZyBG.js";import"./TextInput-B1SJVYX2.js";import"./InputLabel-UAYg7twD.js";import"./InputErrorMessage-DyTqa7UM.js";import"./StatusDot-pRRXUUZ9.js";const se={mixins:[N,R],components:{AddButton:F,TextHeader:q,BasicTable:z,Checkbox:W,Countdown:j,ExternalLink:Y,ConfirmModal:G,SpinningLoader:J,PrimaryButton:K,MoreInfoPopover:O,ToogleSwitch:Z,BadgeIndicator:$,TransactionPaymentStatus:ee},data(){return{transactions:[],pagination:null,searchTerm:null,checkedRowIds:[],showEverything:!1,appName:V.appName,deletableTransaction:null,isDeletingTransactionIds:[],isLoadingTransactions:!1,storeState:H()}},computed:{store(){return this.storeState.store},tableHeaders(){return this.showEverything?["","Trans #","Description","Payment Status","Amount","Percentage","Payment Method","Requester","Verifyer","Payment Link","Created Date",""]:["","Trans #","Payment Status","Amount","Payment Method","Requester","Verifyer","Payment Link",""]},hasSearchTerm(){return this.searchTerm!=null&&this.searchTerm.trim()!=""}},methods:{onView(o){this.$router.push({name:"show-store-transaction",params:{store_href:this.store._links.showStore,transaction_href:o._links.showTransaction}}).then(()=>{window.scrollTo(0,0)})},navigateToShowCustomers(){this.$router.push({name:"show-store-customers",params:{store_href:this.store._links.showStore}})},showDeleteConfirmationModal(o){this.deletableTransaction=o,this.$nextTick(()=>{this.$refs.confirmDeleteButton.$el.click()})},isDeleting(o){return this.isDeletingTransactionIds.findIndex(r=>r==o.id)!=-1},onAddTransaction(){this.$router.push({name:"create-store-transaction",params:{store_href:this.store._links.showStore}})},paginate(o){this.getTransactions(o)},search(o){this.searchTerm=o,this.getTransactions()},getTransactions(o=null){this.isLoadingTransactions=!0;const r={_relationships:"customer,requestedByUser,manuallyVerifiedByUser,paymentMethod"};this.hasSearchTerm&&(r.search=this.searchTerm),o=o??this.store._links.showStoreTransactions,Q(o,r).then(f=>{f.status==200&&(this.pagination=f.data,this.transactions=this.pagination.data,this.checkedRowIds=this.transactions.map(v=>!1)),this.isLoadingTransactions=!1}).catch(f=>{this.isLoadingTransactions=!1})},deleteTransaction(){this.isDeletingTransactionIds.push(this.deletableTransaction.id),X(this.deletableTransaction._links.deleteTransaction).then(o=>{this.isDeletingTransactionIds.splice(this.isDeletingTransactionIds.findIndex(r=>r==this.deletableTransaction.id,1)),o.status==200&&(o.data.deleted?(this.showSuccessfulNotification("Transaction deleted"),this.isDeletingTransactionIds.length==0&&this.getTransactions()):(this.setFormError("general",o.data.message),this.showUnsuccessfulNotification(o.data.message)))}).catch(o=>{this.isDeletingTransactionIds.splice(this.isDeletingTransactionIds.findIndex(r=>r==this.deletableTransaction.id,1)),this.setServerFormErrors(o)})}},mounted(){},created(){this.getTransactions()}},oe={class:"flex justify-between items-center border-dashed py-6"},ae={class:"flex items-center"},ne=t("span",{class:"mr-2"},"ðŸ’µ",-1),ie=t("span",{class:"ml-2"},"Add Transaction",-1),re=["onClick"],ce={class:"whitespace-nowrap px-4 py-4"},le={class:"flex space-x-1 items-center"},de={key:0,class:"px-4 py-4"},pe={class:"min-w-80"},he={class:"whitespace-nowrap px-4 py-4"},me={class:"whitespace-nowrap px-4 py-4 text-center"},ue={key:1,class:"whitespace-nowrap px-4 py-4 text-center"},_e={class:"whitespace-nowrap px-4 py-4 text-center"},ye={class:"whitespace-nowrap px-4 py-4"},fe={key:0},ge={key:1,class:"text-xs text-center text-gray-300"},xe={class:"text-xs text-center text-gray-300"},Te={key:0,class:"whitespace-nowrap px-4 py-4"},we={key:0,class:"flex items-start space-x-2"},be={key:0,class:"max-w-80"},ke={key:2,class:"text-xs text-center text-gray-300"},ve=t("div",{class:"border-t border-dashed my-2"},null,-1),Se={key:1,class:"text-xs text-center text-gray-300"},De={key:2,class:"whitespace-nowrap px-4 py-4"},Ce={class:"flex space-x-1 items-center"},Pe={class:"px-4 py-4 flex items-center space-x-4"},Be=["onClick"],Ie=t("span",{class:"text-xs ml-2"},"Deleting...",-1),Ee=["onClick"],Le={key:1,class:"flex justify-between space-x-20 bg-white shadow-lg rounded-lg border p-20"},Ae={class:"space-y-4"},Me=t("h1",{class:"text-2xl font-bold"},"No Transactions Yet",-1),Ve=t("span",{class:"ml-2"},"Add Transaction",-1),Ue=t("div",null,[t("span",{class:"text-8xl"},"ðŸ’µ")],-1),Ne=t("p",{class:"text-lg font-bold border-b border-dashed pb-4 mb-4"},"Confirm Delete",-1),Re={class:"mb-8"},He={class:"font-bold text-black"};function Fe(o,r,f,v,n,i){const S=l("TextHeader"),g=l("MoreInfoPopover"),D=l("ToogleSwitch"),b=l("AddButton"),C=l("Checkbox"),P=l("TransactionPaymentStatus"),T=l("BadgeIndicator"),B=l("ExternalLink"),I=l("Countdown"),E=l("SpinningLoader"),L=l("BasicTable"),A=l("PrimaryButton"),M=l("ConfirmModal");return s(),a("div",null,[t("div",oe,[t("div",ae,[c(S,null,{default:d(()=>[ne,h(" Transactions")]),_:1}),c(g,{class:"ml-2 mt-1",title:"What Is This?",description:"Transactions are detailed records of payments made by customers for purchasing products or services from your store.",placement:"top"})]),(n.pagination??{}).total>0?(s(),a(w,{key:0},[c(D,{modelValue:n.showEverything,"onUpdate:modelValue":r[0]||(r[0]=e=>n.showEverything=e),size:"md",labelPopoverTitle:"What Is This?",labelPopoverDescription:"Turn on if you want to show more information about your transactions"},{default:d(()=>[h(" Show Everything ")]),_:1},8,["modelValue"]),c(b,{action:i.onAddTransaction},{default:d(()=>[ie]),_:1},8,["action"])],64)):m("",!0)]),n.isLoadingTransactions||(n.pagination??{}).total>0||i.hasSearchTerm?(s(),u(L,{key:0,pagination:n.pagination,isLoading:n.isLoadingTransactions,onPaginate:i.paginate,onSearch:i.search,onRefresh:i.getTransactions,totalHeaders:i.tableHeaders.length},{head:d(()=>[t("tr",null,[(s(!0),a(w,null,k(i.tableHeaders,(e,_)=>(s(),a("th",{key:_,scope:"col",class:"whitespace-nowrap px-4 py-3"},p(e),1))),128))])]),body:d(()=>[(s(!0),a(w,null,k(n.transactions,(e,_)=>(s(),a("tr",{onClick:y(x=>i.onView(e),["stop"]),key:e.id,class:U(["group cursor-pointer border-b",n.checkedRowIds[_]?"bg-blue-100":"bg-white hover:bg-gray-50"])},[t("td",{onClick:r[1]||(r[1]=y(()=>{},["stop"])),class:"whitespace-nowrap pl-4"},[c(C,{size:"xs",modelValue:n.checkedRowIds[_],"onUpdate:modelValue":x=>n.checkedRowIds[_]=x},null,8,["modelValue","onUpdate:modelValue"])]),t("td",ce,[t("div",le,[t("span",null,"#"+p(e._attributes.number),1),c(g,{class:"opacity-0 group-hover:opacity-100",title:"#"+e._attributes.number,description:e.description,placement:"top"},null,8,["title","description"])])]),n.showEverything?(s(),a("td",de,[t("div",pe,p(e.description),1)])):m("",!0),t("td",he,[c(P,{transaction:e},null,8,["transaction"])]),t("td",me,p(e.amount.amountWithCurrency),1),n.showEverything?(s(),a("td",ue,p(e.percentage.valueSymbol),1)):m("",!0),t("td",_e,p(e._relationships.paymentMethod.name),1),t("td",ye,[e._relationships.requestedByUser?(s(),a("span",fe,p(e._relationships.requestedByUser._attributes.name),1)):(s(),a("span",ge,"---"))]),t("td",xe,[e._relationships.verifiedByUser?(s(),a("span",Te,p(e._relationships.verifiedByUser._attributes.name),1)):(s(),u(T,{key:1,type:"info",text:n.appName,showDot:!1},null,8,["text"]))]),t("td",{class:"px-4 py-4",onClick:r[2]||(r[2]=y(()=>{},["stop"]))},[e.metadata?(s(),a("div",we,[e.metadata.canPayUsingDpo?(s(),a("div",be,[c(B,{url:e.metadata.dpoPaymentUrl,class:"text-xs"},{default:d(()=>[h(p(e.metadata.dpoPaymentUrl),1)]),_:2},1032,["url"])])):e.metadata.dpoPaymentLinkHasExpired==!0?(s(),u(T,{key:1,type:"warning",text:"Expired",showDot:!1})):(s(),a("span",ke,"---")),e.metadata.canPayUsingDpo?(s(),u(g,{key:3,title:"Expires In",placement:"top",class:"opacity-0 group-hover:opacity-100 mt-1"},{description:d(()=>[ve,c(I,{showMoreInfoPopover:!1,time:e.metadata.dpoPaymentUrlExpiresAt},null,8,["time"])]),_:2},1024)):m("",!0)])):(s(),a("span",Se,"---"))]),n.showEverything?(s(),a("td",De,[t("div",Ce,[t("span",null,p(o.formattedDatetime(e.createdAt)),1),c(g,{class:"opacity-0 group-hover:opacity-100",title:o.formattedRelativeDate(e.createdAt),placement:"top"},null,8,["title"])])])):m("",!0),t("td",Pe,[i.isDeleting(e)?m("",!0):(s(),a("a",{key:0,href:"#",onClick:y(x=>i.onView(e),["stop","prevent"]),class:"font-medium text-blue-600 dark:text-blue-500 hover:underline"},"View",8,Be)),i.isDeleting(e)?(s(),u(E,{key:1,type:"danger"},{default:d(()=>[Ie]),_:1})):(s(),a("a",{key:2,href:"#",onClick:y(x=>i.showDeleteConfirmationModal(e),["stop","prevent"]),class:"font-medium text-red-600 dark:text-red-500 hover:underline"},"Delete",8,Ee))])],10,re))),128))]),_:1},8,["pagination","isLoading","onPaginate","onSearch","onRefresh","totalHeaders"])):(s(),a("div",Le,[t("div",Ae,[Me,t("p",null,[h("Your transactions will appear here once "),c(T,{type:"primary",text:"customers",showDot:!1,clickable:!0,action:i.navigateToShowCustomers},null,8,["action"]),h(" start paying. Start promoting your store to attract buyers and generate sales. Promote your store on as many platforms as possible.")]),c(b,{action:i.onAddTransaction,class:"w-40",size:"sm"},{default:d(()=>[Ve]),_:1},8,["action"])]),Ue])),n.deletableTransaction?(s(),u(M,{key:2,approveText:"Delete Transaction",approveAction:i.deleteTransaction,isLoading:i.isDeleting(n.deletableTransaction)},{content:d(()=>[Ne,t("p",Re,[h("Are you sure you want to permanently delete "),t("span",He,"transaction #"+p(n.deletableTransaction._attributes.number),1),h("?")])]),trigger:d(e=>[c(A,{ref:"confirmDeleteButton",action:e.showModal,class:"hidden",type:"danger"},{default:d(()=>[h(" Delete Transaction ")]),_:2},1032,["action"])]),_:1},8,["approveAction","isLoading"])):m("",!0)])}const mt=te(se,[["render",Fe]]);export{mt as default};
