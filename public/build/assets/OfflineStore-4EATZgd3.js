import{F as S}from"./FormMixin-6JkaGLLr.js";import{u as L,s as T,r as p,o,c as i,b as e,F as g,d as x,t as m,q as F,y as I,g as b,z as V,w as v,a as A,e as u,k as f}from"./app-jXH5QC3l.js";import{u as w}from"./store-store-DI9g0YE3.js";import{T as C}from"./TextInput-CYg7QVrw.js";import{S as q}from"./SelectInput-D7XUHB9M.js";import{L as E}from"./LineSkeleton-3g5h70H3.js";import{M as B}from"./MobileNumberInput-DOvh9nKL.js";import{B as P}from"./Button-BeSnAT_x.js";import{p as O}from"./api-repository--xE_j9dL.js";import{S as z}from"./SpinningLoader-BdvFuScB.js";import{_}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{v as y}from"./form-store-C265_0LO.js";import{p as R}from"./parsePhoneNumber-DQBitC1m.js";import"./cloneDeep-B1YGuKb7.js";import"./InputErrorMessage-CbGsL3fL.js";import"./MoreInfoPopover-DuLCv7tU.js";import"./ShineEffect-DfG5M4Ts.js";const W={mixins:[S],components:{Button:P,SpinningLoader:z},props:{msisdn:{type:String},initialMessage:{type:String}},data(){return{msg:"",content:"",requestType:1,sessionId:y(),apiState:L(),isShowingUssdPopup:!1,isSendingUssdMessage:!1,storeState:w(),telcofloLaunchUssdUrl:T.telcofloLaunchUssdUrl}},watch:{isLoadingStore(n){n||(this.msg=this.initialMessage,this.startApiSimulationRequest())}},computed:{store(){return this.storeState.store},isLoadingStore(){return this.storeState.isLoadingStore}},methods:{startApiSimulationRequest(){this.isSendingUssdMessage||(this.isShowingUssdPopup=!0,this.sendUssdMessage())},stopUssdSimulator(){this.isShowingUssdPopup=!1,this.resetUssdSimulator()},resetUssdSimulator(){this.msg=this.initialMessage,this.sessionId=y(),this.requestType=1,this.content=""},sendUssdMessage(){this.isSendingUssdMessage=!0;var n={msg:this.msg,test_mode:!0,msisdn:this.msisdn,session_id:this.sessionId,request_type:this.requestType};O(this.telcofloLaunchUssdUrl,n).then(s=>{s.status==200&&(this.msg="",this.content=s.data.msg,this.requestType=s.data.request_type,this.focusOnInput()),this.isSendingUssdMessage=!1}).catch(s=>{this.isSendingUssdMessage=!1,this.setServerFormErrors(s)})},focusOnInput(){setTimeout(()=>{this.$refs.ussd_message_input&&this.$refs.ussd_message_input.focus()},100)}}},j={class:"relative mx-auto border-gray-500 dark:border-gray-500 bg-gray-500 border-[8px] rounded-[1.8rem] w-min h-min"},D={class:"rounded-[1.5rem] overflow-hidden w-[220px] h-[455px] bg-white dark:bg-gray-500"},Y={class:"relative flex items-center w-full h-full pb-40 phone-bg"},K={class:"relative z-20 w-full"},G={class:"bg-white mx-4 px-4 rounded-xl py-4"},H={key:0,class:"flex justify-center space-x-2"},J={class:"text-xs whitespace-pre-wrap"},Q={class:"flex justify-center items-center space-x-6 mt-2"},X={class:"flex justify-end mt-4"};function Z(n,s,U,k,a,t){const d=p("SpinningLoader"),h=p("Button");return o(),i("div",j,[s[10]||(s[10]=e("div",{class:"h-[24px] w-[4px] bg-gray-500 dark:bg-gray-500 absolute -start-[12px] top-[58px] rounded-s-sm"},null,-1)),s[11]||(s[11]=e("div",{class:"h-[34px] w-[4px] bg-gray-500 dark:bg-gray-500 absolute -start-[12px] top-[100px] rounded-s-sm"},null,-1)),s[12]||(s[12]=e("div",{class:"h-[34px] w-[4px] bg-gray-500 dark:bg-gray-500 absolute -start-[12px] top-[144px] rounded-s-sm"},null,-1)),s[13]||(s[13]=e("div",{class:"h-[48px] w-[4px] bg-gray-500 dark:bg-gray-500 absolute -end-[12px] top-[114px] rounded-e-sm"},null,-1)),e("div",D,[e("div",Y,[s[9]||(s[9]=e("div",{class:"absolute z-10 top-0 left-0 right-0 bottom-0 phone-blur-effect"},null,-1)),e("div",K,[e("div",G,[a.isShowingUssdPopup?(o(),i(g,{key:0},[a.isSendingUssdMessage?(o(),i("div",H,[x(d),s[5]||(s[5]=e("span",{class:"text-xs"},"Running...",-1))])):(o(),i(g,{key:1},[e("p",J,m(a.content),1),F(e("input",{type:"text","onUpdate:modelValue":s[0]||(s[0]=l=>a.msg=l),ref:"ussd_message_input",class:"ussd_message_input",onKeypress:s[1]||(s[1]=b(l=>t.startApiSimulationRequest(),["enter"])),onKeyup:s[2]||(s[2]=b(l=>t.stopUssdSimulator(),["esc"]))},null,544),[[I,a.msg]]),e("div",Q,[e("p",{onClick:s[3]||(s[3]=(...l)=>t.stopUssdSimulator&&t.stopUssdSimulator(...l)),class:"text-xs cursor-pointer hover:opacity-50"},"Cancel"),s[6]||(s[6]=e("p",null,"|",-1)),e("p",{onClick:s[4]||(s[4]=(...l)=>t.sendUssdMessage&&t.sendUssdMessage(...l)),class:"text-xs cursor-pointer hover:opacity-50"},"Send")])],64))],64)):V(n.$slots,"default",{key:1},()=>[e("div",null,[s[8]||(s[8]=e("div",{class:"text-xs text-center"},[e("div",{class:"text-2xl"},"ðŸ¤©"),e("div",null,"Let's visit your store")],-1)),e("div",X,[x(h,{action:t.startApiSimulationRequest,type:"primary",size:"xs",class:"w-full"},{default:v(()=>s[7]||(s[7]=[e("span",null,"Open Shop",-1)])),_:1},8,["action"])])])],!0)])])])])])}const $=_(W,[["render",Z],["__scopeId","data-v-03cf7dff"]]),ss={mixins:[S],components:{TextInput:C,SelectInput:q,LineSkeleton:E,MobileNumberInput:B,VirtualPhone:$},data(){return{country:"Botswana",authState:A(),storeState:w()}},computed:{store(){return this.storeState.store},storeForm(){return this.storeState.storeForm},authUser(){return this.authState.user},isLoadingStore(){return this.storeState.isLoadingStore},countries(){return[{flag:"ðŸ‡§ðŸ‡¼",name:"Botswana",shortcode:this.ussdMobileNumberWithoutExtension?`*250*${this.ussdMobileNumberWithoutExtension}#`:"*250#"}]},ussdMobileNumberWithoutExtension(){return this.storeForm&&this.storeForm.ussdMobileNumber?R(this.storeForm.ussdMobileNumber).formatNational().replace(/\s+/g,""):""}}},es={class:"pt-24 pb-60 px-20 relative"},ts={class:"relative"},os={class:"grid grid-cols-2 gap-8"},rs={class:"bg-white p-6 shadow-sm rounded-xl"},is={class:"space-y-4 mb-8"},ns={class:"space-y-4 mb-8"},ls={class:"text-sm overflow-x-auto"},as={class:"min-w-full bg-white border border-gray-200 shadow-sm rounded-lg"},ds={class:"space-x-2 px-6 py-3"},us={key:1,class:"flex items-center space-x-2"},ps={class:"text-xl"},ms={class:"px-6 py-3"},gs={key:1},xs={class:"animated-border-blue p-6 shadow-sm rounded-xl"},hs={class:"space-y-4 mb-8"},cs={key:1,class:"flex items-center space-x-2"},bs=["value"];function fs(n,s,U,k,a,t){const d=p("LineSkeleton"),h=p("MobileNumberInput"),l=p("TextInput"),M=p("SelectInput"),N=p("VirtualPhone");return o(),i("div",es,[e("div",ts,[s[9]||(s[9]=e("h1",{class:"text-2xl text-center font-bold text-gray-800 mb-4"},"Your Offline Store is Ready!",-1)),s[10]||(s[10]=e("p",{class:"text-center text-gray-600 mb-6 max-w-2xl mx-auto"}," No Internet? No Problem! Customers Can Still Shop ",-1)),s[11]||(s[11]=e("div",{class:"flex justify-center space-x-8 mb-8"},null,-1)),e("div",os,[e("div",rs,[e("div",is,[t.isLoadingStore?(o(),u(d,{key:0,width:"w-32",shine:!0})):(o(),u(h,{key:1,label:"Mobile Number",modelValue:t.storeForm.ussdMobileNumber,"onUpdate:modelValue":s[0]||(s[0]=r=>t.storeForm.ussdMobileNumber=r),errorText:n.getFormError("ussdMobileNumber"),description:t.ussdMobileNumberWithoutExtension?`Customers dial *250*${t.ussdMobileNumberWithoutExtension}# to access your store`:"Enter your mobile number to create your shortcode"},null,8,["modelValue","errorText","description"])),t.isLoadingStore?(o(),u(d,{key:2,width:"w-32",shine:!0})):(o(),u(l,{key:3,maxlength:"20",label:"Call To Action",placeholder:"Order pizza",modelValue:t.storeForm.callToAction,"onUpdate:modelValue":s[1]||(s[1]=r=>t.storeForm.callToAction=r),errorText:n.getFormError("callToAction"),description:"The call to action to start the shopping experience on USSD"},null,8,["modelValue","errorText"]))]),e("div",ns,[s[4]||(s[4]=e("h2",{class:"font-bold text-gray-700"},"ðŸŒ Where Your Store is Available",-1)),s[5]||(s[5]=e("p",{class:"text-sm text-gray-600"},"Your store can be accessed in these countries using the listed shortcodes:",-1)),e("div",ls,[e("table",as,[s[3]||(s[3]=e("thead",null,[e("tr",{class:"bg-gray-100 border-b"},[e("th",{class:"px-6 py-3 text-left text-gray-600"},"Country"),e("th",{class:"px-6 py-3 text-left text-gray-600"},"Customer's Dial")])],-1)),e("tbody",null,[(o(!0),i(g,null,f(t.isLoadingStore?[1,2,3]:t.countries,(r,c)=>(o(),i("tr",{key:c,class:"border-b hover:bg-gray-50"},[e("td",ds,[t.isLoadingStore?(o(),u(d,{key:0,width:"w-32",shine:!0})):(o(),i("div",us,[e("span",ps,m(r.flag),1),e("span",null,m(r.name),1)]))]),e("td",ms,[t.isLoadingStore?(o(),u(d,{key:0,width:"w-32",shine:!0})):(o(),i("span",gs,m(r.shortcode),1))])]))),128))])])])])]),e("div",xs,[e("div",hs,[s[7]||(s[7]=e("h2",{class:"text-lg font-semibold text-gray-700"},"Experience Your Offline Store",-1)),s[8]||(s[8]=e("p",{class:"text-sm text-gray-600"},"See your store through your customers' eyes. Use the virtual phone below to explore the shopping journey.",-1)),t.isLoadingStore?(o(),u(d,{key:0,width:"w-32",shine:!0})):(o(),i("div",cs,[s[6]||(s[6]=e("span",{class:"text-sm"},"Customers in",-1)),x(M,{modelValue:a.country,"onUpdate:modelValue":s[2]||(s[2]=r=>a.country=r)},{default:v(()=>[(o(!0),i(g,null,f(t.countries,(r,c)=>(o(),i("option",{value:r.name,key:c},m(r.name),9,bs))),128))]),_:1},8,["modelValue"])]))]),x(N,{msisdn:"26772882239",initialMessage:"*250#"})])])]),s[12]||(s[12]=e("img",{src:"/images/clouds.png",class:"absolute top-0"},null,-1))])}const Es=_(ss,[["render",fs]]);export{Es as default};
