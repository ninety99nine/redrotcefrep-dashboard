import{F as L}from"./FormMixin-ClKE1ojy.js";import{U as M}from"./UtilsMixin-CBwmyCNB.js";import{u as V}from"./store-store-DF7fWTGb.js";import{A as P}from"./AddButton-DGxD_nDK.js";import{T as R}from"./TextHeader-C1e96a4g.js";import{C as H}from"./Checkbox-DurIne92.js";import{B as F}from"./BasicTable-CPShvsXm.js";import{C as O}from"./ConfirmModal-DlEfkiYJ.js";import{P as U}from"./PrimaryButton-XzNrM-C-.js";import{S as z}from"./SpinningLoader-DjKpE0mV.js";import{M as W}from"./MoreInfoPopover-CsC9waCN.js";import{g as j,d as Y}from"./api-repository-DGZ2q84F.js";import{T as q}from"./ToogleSwitch-DF5mWLE8.js";import{B as G}from"./BadgeIndicator-3HslKB2j.js";import{N as J}from"./NoDataPlaceholder-BPcq4ikZ.js";import{c as a,b as t,d as l,w as p,F as b,f as c,e as h,h as u,r as d,o as r,k,t as m,m as _,n as K}from"./app-BcSPA593.js";import{_ as Q}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./form-store-BEfa8Mf9.js";import"./cloneDeep-BSUglKOW.js";import"./InputErrorMessage-BQBt7GbC.js";import"./SearchInput-BFzG7Po0.js";import"./index-D19FfSVG.js";import"./TextInput-C76qkVLB.js";const X={mixins:[L,M],components:{AddButton:P,TextHeader:R,BasicTable:F,Checkbox:H,ConfirmModal:O,PrimaryButton:U,SpinningLoader:z,MoreInfoPopover:W,ToogleSwitch:q,BadgeIndicator:G,NoDataPlaceholder:J},data(){return{customers:[],pagination:null,searchTerm:null,checkedRowIds:[],showEverything:!1,deletableCustomer:null,isDeletingCustomerIds:[],isLoadingCustomers:!1,storeState:V()}},computed:{store(){return this.storeState.store},tableHeaders(){return this.showEverything?["","Name","Mobile Number","Email","Birthday","Total Orders","Total Spend","Total Average Spend","Last Order Date","Created Date",""]:["","Name","Mobile Number","Email","Total Orders","Total Spend",""]},hasSearchTerm(){return this.searchTerm!=null&&this.searchTerm.trim()!=""}},methods:{onView(o){this.$router.push({name:"show-store-customer",params:{store_href:this.store._links.showStore,customer_href:o._links.showCustomer}}).then(()=>{window.scrollTo(0,0)})},onAddCustomer(){this.$router.push({name:"create-store-customer",params:{store_href:this.store._links.showStore}})},showDeleteConfirmationModal(o){this.deletableCustomer=o,this.$nextTick(()=>{this.$refs.confirmDeleteButton.$el.click()})},isDeleting(o){return this.isDeletingCustomerIds.findIndex(e=>e==o.id)!=-1},paginate(o){this.getCustomers(o)},search(o){this.searchTerm=o,this.getCustomers()},getCustomers(o=null){this.isLoadingCustomers=!0;const e={};this.hasSearchTerm&&(e.search=this.searchTerm),o=o??this.store._links.showStoreCustomers,j(o,e).then(g=>{g.status==200&&(this.pagination=g.data,this.customers=this.pagination.data,this.checkedRowIds=this.customers.map(v=>!1)),this.isLoadingCustomers=!1}).catch(g=>{this.isLoadingCustomers=!1,this.setServerFormErrors(g)})},deleteCustomer(){this.isDeletingCustomerIds.push(this.deletableCustomer.id),Y(this.deletableCustomer._links.deleteCustomer).then(o=>{this.isDeletingCustomerIds.splice(this.isDeletingCustomerIds.findIndex(e=>e==this.deletableCustomer.id,1)),o.status==200&&(o.data.deleted?(this.showSuccessfulNotification("Customer deleted"),this.isDeletingCustomerIds.length==0&&this.getCustomers()):(this.setFormError("general",o.data.message),this.showUnsuccessfulNotification(o.data.message)))}).catch(o=>{this.isDeletingCustomerIds.splice(this.isDeletingCustomerIds.findIndex(e=>e==this.deletableCustomer.id,1)),this.setServerFormErrors(o)})}},mounted(){},created(){this.getCustomers()}},Z={class:"flex justify-between items-center border-dashed py-6"},$={class:"flex items-center"},ee=["onClick"],te={class:"whitespace-nowrap align-top px-4 py-4"},se={class:"flex space-x-1 items-center w-40"},oe={class:"align-top px-4 py-4"},re={class:"flex space-x-1 items-center"},ie={key:1},ne={class:"align-top px-4 py-4"},ae={class:"flex space-x-1 items-center"},le={key:1},de={key:0,class:"align-top px-4 py-4"},me={class:"flex space-x-1 items-center w-24"},pe={key:1},ce={class:"align-top px-4 py-4"},ue={class:"whitespace-nowrap px-4 py-4"},he={key:1,class:"whitespace-nowrap px-4 py-4"},ge={key:2,class:"whitespace-nowrap align-top px-4 py-4"},fe={class:"flex space-x-1 items-center"},ye={key:3,class:"whitespace-nowrap align-top px-4 py-4"},Ce={class:"flex space-x-1 items-center"},_e={class:"align-top px-4 py-4 flex items-center space-x-4"},we=["onClick"],be=["onClick"],xe={key:1,class:"flex justify-between space-x-20 bg-white shadow-lg rounded-lg border p-20"},ke={class:"space-y-4"},ve={class:"mb-8"},De={class:"font-bold text-black"};function Te(o,e,g,v,i,n){const D=d("TextHeader"),y=d("MoreInfoPopover"),T=d("ToogleSwitch"),x=d("AddButton"),S=d("Checkbox"),w=d("NoDataPlaceholder"),I=d("SpinningLoader"),A=d("BasicTable"),B=d("BadgeIndicator"),N=d("PrimaryButton"),E=d("ConfirmModal");return r(),a("div",null,[t("div",Z,[t("div",$,[l(D,null,{default:p(()=>e[2]||(e[2]=[t("span",{class:"mr-2"},"ðŸ˜Š",-1),u(" Customers")])),_:1}),l(y,{class:"ml-2 mt-1",title:"What Is This?",description:"Customers are people who are interested in buying your goods or services",placement:"top"})]),(i.pagination??{}).total>0?(r(),a(b,{key:0},[l(T,{modelValue:i.showEverything,"onUpdate:modelValue":e[0]||(e[0]=s=>i.showEverything=s),size:"md",labelPopoverTitle:"What Is This?",labelPopoverDescription:"Turn on if you want to show more information about your customers"},{default:p(()=>e[3]||(e[3]=[u(" Show Everything ")])),_:1},8,["modelValue"]),l(x,{action:n.onAddCustomer,class:"w-44"},{default:p(()=>e[4]||(e[4]=[t("span",{class:"ml-2"},"Add Customer",-1)])),_:1},8,["action"])],64)):c("",!0)]),i.isLoadingCustomers||(i.pagination??{}).total>0||n.hasSearchTerm?(r(),h(A,{key:0,pagination:i.pagination,isLoading:i.isLoadingCustomers,onPaginate:n.paginate,onSearch:n.search,onRefresh:n.getCustomers,totalHeaders:n.tableHeaders.length},{head:p(()=>[t("tr",null,[(r(!0),a(b,null,k(n.tableHeaders,(s,f)=>(r(),a("th",{key:f,scope:"col",class:"whitespace-nowrap px-4 py-3"},m(s),1))),128))])]),body:p(()=>[(r(!0),a(b,null,k(i.customers,(s,f)=>(r(),a("tr",{onClick:_(C=>n.onView(s),["stop"]),key:s.id,class:K(["group cursor-pointer border-b",i.checkedRowIds[f]?"bg-blue-100":"bg-white hover:bg-gray-50"])},[t("td",{onClick:e[1]||(e[1]=_(()=>{},["stop"])),class:"whitespace-nowrap pl-4"},[l(S,{size:"xs",modelValue:i.checkedRowIds[f],"onUpdate:modelValue":C=>i.checkedRowIds[f]=C},null,8,["modelValue","onUpdate:modelValue"])]),t("td",te,[t("div",se,[t("span",null,m(s._attributes.name),1),l(y,{class:"opacity-0 group-hover:opacity-100",title:s._attributes.name,description:s.notes,placement:"top"},null,8,["title","description"])])]),t("td",oe,[t("div",re,[s.mobileNumber==null?(r(),h(w,{key:0})):(r(),a("span",ie,m(s.mobileNumber.national),1))])]),t("td",ne,[t("div",ae,[s.email==null?(r(),h(w,{key:0})):(r(),a("span",le,m(s.email),1))])]),i.showEverything?(r(),a("td",de,[t("div",me,[s.birthday==null?(r(),h(w,{key:0})):(r(),a("span",pe,m(o.formattedDate(s.birthday)),1))])])):c("",!0),t("td",ce,[t("span",null,m(s.totalOrders),1)]),t("td",ue,[t("span",null,m(s.totalSpend.amountWithCurrency),1)]),i.showEverything?(r(),a("td",he,[t("span",null,m(s.totalAverageSpend.amountWithCurrency),1)])):c("",!0),i.showEverything?(r(),a("td",ge,[t("div",fe,[t("span",null,m(o.formattedDatetime(s.lastOrderAt)),1),l(y,{class:"opacity-0 group-hover:opacity-100",title:o.formattedRelativeDate(s.lastOrderAt),placement:"top"},null,8,["title"])])])):c("",!0),i.showEverything?(r(),a("td",ye,[t("div",Ce,[t("span",null,m(o.formattedDatetime(s.createdAt)),1),l(y,{class:"opacity-0 group-hover:opacity-100",title:o.formattedRelativeDate(s.createdAt),placement:"top"},null,8,["title"])])])):c("",!0),t("td",_e,[n.isDeleting(s)?c("",!0):(r(),a("a",{key:0,href:"#",onClick:_(C=>n.onView(s),["stop","prevent"]),class:"font-medium text-blue-600 dark:text-blue-500 hover:underline"},"View",8,we)),n.isDeleting(s)?(r(),h(I,{key:1,type:"danger"},{default:p(()=>e[5]||(e[5]=[t("span",{class:"text-xs ml-2"},"Deleting...",-1)])),_:1})):(r(),a("a",{key:2,href:"#",onClick:_(C=>n.showDeleteConfirmationModal(s),["stop","prevent"]),class:"font-medium text-red-600 dark:text-red-500 hover:underline"},"Delete",8,be))])],10,ee))),128))]),_:1},8,["pagination","isLoading","onPaginate","onSearch","onRefresh","totalHeaders"])):(r(),a("div",xe,[t("div",ke,[e[9]||(e[9]=t("h1",{class:"text-2xl font-bold"},"Add your first customer",-1)),t("p",null,[e[6]||(e[6]=u("Start building your customer base! You can ")),l(B,{type:"primary",text:"add customers",showDot:!1,clickable:!0,action:n.onAddCustomer,class:"cursor-pointer hover:opacity-80"},null,8,["action"]),e[7]||(e[7]=u(" directly or let them find you by marketing your store."))]),l(x,{action:n.onAddCustomer,class:"w-40",size:"sm"},{default:p(()=>e[8]||(e[8]=[t("span",{class:"ml-2"},"Add Customer",-1)])),_:1},8,["action"])]),e[10]||(e[10]=t("div",null,[t("span",{class:"text-8xl"},"ðŸŽ‰")],-1))])),i.deletableCustomer?(r(),h(E,{key:2,approveText:"Delete Customer",approveAction:n.deleteCustomer,isLoading:n.isDeleting(i.deletableCustomer)},{content:p(()=>[e[13]||(e[13]=t("p",{class:"text-lg font-bold border-b border-dashed pb-4 mb-4"},"Confirm Delete",-1)),t("p",ve,[e[11]||(e[11]=u("Are you sure you want to permanently delete ")),t("span",De,m(i.deletableCustomer.name),1),e[12]||(e[12]=u("?"))])]),trigger:p(s=>[l(N,{ref:"confirmDeleteButton",action:s.showModal,class:"hidden",type:"danger"},{default:p(()=>e[14]||(e[14]=[u(" Delete Customer ")])),_:2},1032,["action"])]),_:1},8,["approveAction","isLoading"])):c("",!0)])}const Qe=Q(X,[["render",Te]]);export{Qe as default};
