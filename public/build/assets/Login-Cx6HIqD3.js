import{R as L,u as q,a as v,c as l,b as m,d as t,w as d,e as g,f as c,g as b,F as p,r as s,o as i,h as n,t as x}from"./app-DEkFCb1u.js";import{L as T}from"./Logo-BZxlr7up.js";import{A as I}from"./Alert-DEJps0rh.js";import{F as U}from"./FormMixin-D44Bj-el.js";import{B as A}from"./Button-CTlUNYLQ.js";import{U as M,u as B}from"./form-store-B_ZbhArT.js";import{T as K}from"./TextHeader-DRGBY_Ui.js";import{l as H}from"./auth-repository-yDTpM9Oj.js";import{p as O}from"./api-repository-CIJPUswr.js";import{P as R}from"./PasswordInput-BrOpAPQI.js";import{O as D,C as G}from"./ConfirmPasswordInput-S0eDFofB.js";import{S as j}from"./SocialLinks-BYV9UTUE.js";import{S as z}from"./SpinningLoader-BnJGVf_7.js";import{M as J}from"./MobileNumberInput-DB74IXOZ.js";import{F as Q}from"./FormErrorMessages-T64AgTW8.js";import{_ as W}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ShineEffect-CWpUJr6E.js";import"./InputErrorMessage-lzTzq-uZ.js";import"./MoreInfoPopover-CrxGv8yo.js";const X={mixins:[U,M],components:{Logo:T,Alert:I,Button:A,RouterLink:L,TextHeader:K,PasswordInput:R,OtpInput:D,SocialLinks:j,SpinningLoader:z,MobileNumberInput:J,FormErrorMessages:Q,ConfirmPasswordInput:G},data(){return{loginUrl:null,isSubmitting:!1,accountExistsUrl:null,apiState:q(),authState:v(),showPasswordConfirmation:!1,mobileVerificationShortcode:null,notificationState:B(),accountExists:!1,requiresPassword:!1,password:"",mobileNumber:"",verificationCode:"",passwordConfirmation:""}},beforeRouteEnter(r,o,u){u(h=>{r.query.hasOwnProperty("mobileNumber")&&(h.mobileNumber=r.query.mobileNumber,h.handleLogin())})},methods:{handleLogin(){this.formState.hideFormErrors(),this.accountExists?this.attemptLogin():this.checkIfAccountExists()},checkIfAccountExists(){if(this.mobileNumber.trim()=="")this.formState.setFormError("mobileNumber","Enter your mobile number");else if(this.accountExistsUrl!=null){this.isSubmitting=!0;const r={mobileNumber:this.mobileNumber};O(this.accountExistsUrl,r).then(o=>{this.isSubmitting=!1,this.accountExists=o.data.exists,this.accountExists?this.requiresPassword=o.data.accountSummary.requiresPassword:this.$router.push({name:"register",query:{mobileNumber:this.mobileNumber}})}).catch(o=>{this.isSubmitting=!1,this.formState.setServerFormErrors(o)})}else this.setGeneralFormError("The accountExistsUrl does not exist")},attemptLogin(){if(this.mobileNumber.trim()=="")this.formState.setFormError("mobileNumber","Enter your mobile number");else if(this.password.trim()=="")this.formState.setFormError("password","Enter your password");else if(this.requiresPassword&&this.passwordConfirmation.trim()=="")this.formState.setFormError("passwordConfirmation","Enter your password confirmation");else if(this.requiresPassword&&this.password!=this.passwordConfirmation)this.formState.setFormError("password","Password does not match confirmation");else if(this.requiresPassword&&this.verificationCode.trim()=="")this.formState.setFormError("verificationCode","Enter your verification code");else if(this.loginUrl!=null){this.isSubmitting=!0;let r={password:this.password,mobileNumber:this.mobileNumber};this.requiresPassword&&(r.verificationCode=this.verificationCode,r.passwordConfirmation=this.passwordConfirmation),H(r).then(o=>{if(o.status==200){this.isSubmitting=!1;const u=this.$route.query.redirect;u?this.$router.replace(u):this.$router.replace({name:"show-stores"})}}).catch(o=>{this.isSubmitting=!1,this.formState.setServerFormErrors(o)})}else this.setGeneralFormError("The loginUrl does not exist")}},created(){this.loginUrl=this.apiState.apiHome._links.login,this.accountExistsUrl=this.apiState.apiHome._links.accountExists,this.mobileVerificationShortcode=this.apiState.apiHome.mobileVerificationShortcode}},Y={class:"w-full flex flex-col justify-center bg-gradient-to-b from-blue-100 to-white-100 min-h-screen overflow-x-hidden px-6 py-12 lg:px-8"},Z={class:"sm:mx-auto sm:w-full sm:max-w-sm"},$={class:"mt-10 sm:mx-auto sm:w-full sm:max-w-sm"},oo={class:"space-y-6",action:"#",method:"POST"},eo={class:"font-bold"},ro={class:"font-bold"},so={class:"text-sm text-center mt-8"};function to(r,o,u,h,e,f){const E=s("Logo"),S=s("TextHeader"),y=s("FormErrorMessages"),P=s("MobileNumberInput"),w=s("Alert"),_=s("PasswordInput"),C=s("ConfirmPasswordInput"),N=s("OtpInput"),F=s("Button"),k=s("SocialLinks"),V=s("router-link");return i(),l("div",Y,[m("div",Z,[t(E,{class:"mx-auto"}),t(S,{class:"mt-10 text-center"},{default:d(()=>o[4]||(o[4]=[n("Sign in to your account")])),_:1})]),m("div",$,[m("form",oo,[r.hasGeneralError?(i(),g(y,{key:0})):c("",!0),t(P,{modelValue:e.mobileNumber,"onUpdate:modelValue":o[0]||(o[0]=a=>e.mobileNumber=a),errorText:r.getFormError("mobileNumber"),onKeydown:b(f.handleLogin,["enter"])},null,8,["modelValue","errorText","onKeydown"]),e.accountExists?(i(),l(p,{key:1},[e.requiresPassword?(i(),g(w,{key:0},{default:d(()=>o[5]||(o[5]=[n(" Please set a new password for your account. ")])),_:1})):c("",!0),t(_,{modelValue:e.password,"onUpdate:modelValue":o[1]||(o[1]=a=>e.password=a),showForgotPassword:!e.requiresPassword,errorText:r.getFormError("password"),onKeydown:b(f.handleLogin,["enter"])},null,8,["modelValue","showForgotPassword","errorText","onKeydown"]),e.requiresPassword?(i(),l(p,{key:1},[t(C,{modelValue:e.passwordConfirmation,"onUpdate:modelValue":o[2]||(o[2]=a=>e.passwordConfirmation=a),errorText:r.getFormError("passwordConfirmation"),onKeydown:b(f.handleLogin,["enter"])},null,8,["modelValue","errorText","onKeydown"]),t(w,null,{default:d(()=>[o[6]||(o[6]=n(" Dial ")),m("span",eo,x(e.mobileVerificationShortcode),1),o[7]||(o[7]=n(" and enter the verification code below to confirm ownership of the mobile number ")),m("span",ro,x(e.mobileNumber),1)]),_:1}),t(N,{modelValue:e.verificationCode,"onUpdate:modelValue":o[3]||(o[3]=a=>e.verificationCode=a),errorText:r.getFormError("verificationCode")},null,8,["modelValue","errorText"])],64)):c("",!0)],64)):c("",!0),t(F,{size:"sm",class:"w-full",type:"primary",action:f.handleLogin,loading:e.isSubmitting,disabled:e.isSubmitting},{default:d(()=>[e.accountExists&&e.requiresPassword?(i(),l(p,{key:0},[n("Set Password")],64)):e.accountExists&&!e.requiresPassword?(i(),l(p,{key:1},[n("Sign In")],64)):!e.accountExists&&!e.requiresPassword?(i(),l(p,{key:2},[n("Continue")],64)):c("",!0)]),_:1},8,["action","loading","disabled"])]),t(k),m("p",so,[o[9]||(o[9]=m("span",{class:"text-gray-500 mr-1"},"Don't have an account?",-1)),t(V,{to:{name:"register"}},{default:d(()=>o[8]||(o[8]=[n("Register")])),_:1})])])])}const Co=W(X,[["render",to]]);export{Co as default};
