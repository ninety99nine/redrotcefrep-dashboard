import{u as T,x as V,c as d,b as e,d as l,w as c,r as u,o as n,h as k,q as m,U as _,e as M,F as f,k as b,t as i,p as v}from"./app-BB_DGrdP.js";import{U as C}from"./UtilsMixin-CbFS-0FV.js";import{T as D}from"./TextHeader-CeI6qQrG.js";import{B as O}from"./BasicTable-D8-vJKOS.js";import{D as U}from"./Datepicker-ZI4Y2lLn.js";import{M as H}from"./MoreInfoPopover-CfesgIMT.js";import{g as N}from"./api-repository-CbJkBgbK.js";import{_ as B}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./SearchInput-CRZrkkbT.js";import"./index-B_gOZyBG.js";import"./TextInput-CYcFtt0N.js";import"./InputLabel-DUxkttvx.js";import"./InputErrorMessage-BofDrlG_.js";import"./SpinningLoader-DQkG61_P.js";const R=()=>T().apiHome._links;async function E(o=null,s={}){return await N(o??R().showSubscriptions,s)}const L={mixins:[C],components:{TextHeader:D,BasicTable:O,Datepicker:U,MoreInfoPopover:H},data(){return{url:null,searchTerm:null,pagination:null,isFetching:!1,subscriptions:[],tableHeaders:["Name","Mobile #","Service","Status","Start Date","End Date","Plan",""],serviceFilter:"all",statusFilter:"all",dateNameFilter:null,dateValueFilter:null,dateOperationFilter:null,filters:[]}},methods:{onView(o){console.log("view:"+o.name)},onEdit(o){console.log("edit:"+o.name)},onDelete(o){console.log("delete:"+o.name)},paginate(o){this.url=o,this._getSubscriptions()},search(o){this.url=null,this.searchTerm=o,this._getSubscriptions()},addOrUpdateFilter(o){var s="";this.dateOperationFilter=="gte"?s=">=":this.dateOperationFilter=="lte"?s="<=":this.dateOperationFilter=="gt"?s=">":this.dateOperationFilter=="lt"?s="<":this.dateOperationFilter=="e"&&(s="="),this.filters=this.filters.filter(w=>w.name!==this.dateNameFilter);const p={name:this.dateNameFilter,value:this.dateValueFilter,operation:this.dateOperationFilter,displayName:this.dateNameFilter+" "+s+" "+this.dateValueFilter};o==null?this.filters.push(p):this.filters[o]=p,this._getSubscriptions()},showSelectedFilter(o){this.dateNameFilter=o.name,this.dateValueFilter=o.value,this.dateOperationFilter=o.operation},resetAddFilterModal(){this.dateNameFilter="startAt",this.dateOperationFilter="gte",this.dateValueFilter=this.formattedDate()},hideFilterModal(){this.resetAddFilterModal()},removeFilter(){this._getSubscriptions()},_getSubscriptions(){this.isFetching=!0;const o={with_user:"1",with_owner:"1",search:this.searchTerm,with_subscription_plan:"1"};this.statusFilter!="all"&&(o.status=this.statusFilter),this.serviceFilter!="all"&&(o.service=this.serviceFilter);for(let s=0;s<this.filters.length;s++){const p=this.filters[s];["startAt","endAt"].includes(p.name)&&(o[p.name]=p.operation+"-"+this.dateToTimestamp(p.value))}E(this.url,o).then(s=>{s.status==200&&(this.pagination=s.data,this.subscriptions=this.pagination.data),this.isFetching=!1}).catch(s=>{this.isFetching=!1})}},mounted(){V()},created(){this.resetAddFilterModal(),this._getSubscriptions()}},P={class:"px-16 pt-8"},q={class:"flex items-center border-dashed border-b py-6 mb-6"},I=e("option",{value:"all"},"Service = All",-1),Z=e("option",{value:"store"},"Store",-1),j=e("option",{value:"sms alert"},"Sms Alerts",-1),G=e("option",{value:"ai assistant"},"Ai Assistant",-1),W=[I,Z,j,G],z=e("option",{value:"all"},"Status = All",-1),J=e("option",{value:"active"},"Active",-1),K=e("option",{value:"inactive"},"Inactive",-1),Q=[z,J,K],X={class:"lg:col-span-6 col-span-12"},Y=e("label",{for:"select-filter",class:"block mb-2 text-xs font-medium text-gray-900 dark:text-white"},"Select Filter",-1),$=e("option",{value:"startAt"},"Start date",-1),ee=e("option",{value:"endAt"},"End date",-1),te=[$,ee],se={class:"lg:col-span-6 col-span-12"},oe=e("label",{for:"select-filter-operation",class:"block mb-2 text-xs font-medium text-gray-900 dark:text-white"},"Select Operation",-1),re=e("option",{value:"gte"},"Greater or equal to",-1),ie=e("option",{value:"lte"},"Less or equal to",-1),ae=e("option",{value:"gt"},"Greater than",-1),le=e("option",{value:"lt"},"Less than",-1),ne=e("option",{value:"e"},"Equal to",-1),de=[re,ie,ae,le,ne],ce={class:"col-span-12"},pe=["onClick"],he={class:"whitespace-nowrap px-4 py-4"},ue={class:"whitespace-nowrap px-4 py-4"},me={class:"whitespace-nowrap px-4 py-4"},_e={key:0,class:"flex space-x-1 items-center"},ge=e("svg",{class:"w-3 h-3",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M13.5 21v-7.5a.75.75 0 0 1 .75-.75h3a.75.75 0 0 1 .75.75V21m-4.5 0H2.36m11.14 0H18m0 0h3.64m-1.39 0V9.349M3.75 21V9.349m0 0a3.001 3.001 0 0 0 3.75-.615A2.993 2.993 0 0 0 9.75 9.75c.896 0 1.7-.393 2.25-1.016a2.993 2.993 0 0 0 2.25 1.016c.896 0 1.7-.393 2.25-1.015a3.001 3.001 0 0 0 3.75.614m-16.5 0a3.004 3.004 0 0 1-.621-4.72l1.189-1.19A1.5 1.5 0 0 1 5.378 3h13.243a1.5 1.5 0 0 1 1.06.44l1.19 1.189a3 3 0 0 1-.621 4.72M6.75 18h3.75a.75.75 0 0 0 .75-.75V13.5a.75.75 0 0 0-.75-.75H6.75a.75.75 0 0 0-.75.75v3.75c0 .414.336.75.75.75Z"})],-1),fe={key:1,class:"flex space-x-1 items-center text-blue-500"},ve=e("svg",{class:"w-3 h-3",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z"})],-1),we=e("span",null,"Ai Assistant",-1),ye=e("div",{class:"my-4 border-b"},null,-1),ke={key:2,class:"flex space-x-1 items-center text-green-500"},be=e("svg",{class:"w-3 h-3",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 20.25c4.97 0 9-3.694 9-8.25s-4.03-8.25-9-8.25S3 7.444 3 12c0 2.104.859 4.023 2.273 5.48.432.447.74 1.04.586 1.641a4.483 4.483 0 0 1-.923 1.785A5.969 5.969 0 0 0 6 21c1.282 0 2.47-.402 3.445-1.087.81.22 1.668.337 2.555.337Z"})],-1),Fe=e("span",null,"Sms Alerts",-1),xe={class:"whitespace-nowrap px-4 py-4"},Se={class:"whitespace-nowrap px-4 py-4"},Ae={class:"flex space-x-1 items-center"},Te={class:"whitespace-nowrap px-4 py-4"},Ve={class:"flex space-x-1 items-center"},Me={class:"whitespace-nowrap px-4 py-4"},Ce={class:"flex space-x-1 items-center"},De={class:"opacity-0 group-hover:opacity-100 transition-opacity px-4 py-4 space-x-4"},Oe=["onClick"],Ue=["onClick"];function He(o,s,p,w,r,a){const F=u("TextHeader"),h=u("MoreInfoPopover"),x=u("Datepicker"),S=u("BadgeIndicator"),A=u("BasicTable");return n(),d("div",P,[e("div",q,[l(F,null,{default:c(()=>[k("Subscriptions")]),_:1}),l(h,{class:"ml-2 mt-1",title:"What Is This?",description:"Subscriptions are records of transactions for services that have a start and end date such as Store or AI Assistant subscriptions",placement:"top"})]),l(A,{pagination:r.pagination,isLoading:r.isFetching,onPaginate:a.paginate,onSearch:a.search,onRefresh:a._getSubscriptions,showAddFilter:!0,filters:r.filters,onAddOrUpdateFilter:a.addOrUpdateFilter,onShowSelectedFilter:a.showSelectedFilter,onHideFilterModal:a.hideFilterModal,onRemoveFilter:a.removeFilter,totalHeaders:r.tableHeaders.length},{primaryFilters:c(()=>[m(e("select",{"onUpdate:modelValue":s[0]||(s[0]=t=>r.serviceFilter=t),onChange:s[1]||(s[1]=(...t)=>a._getSubscriptions&&a._getSubscriptions(...t)),id:"select-service",class:"w-40 block p-2 bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"},W,544),[[_,r.serviceFilter]]),m(e("select",{"onUpdate:modelValue":s[2]||(s[2]=t=>r.statusFilter=t),onChange:s[3]||(s[3]=(...t)=>a._getSubscriptions&&a._getSubscriptions(...t)),id:"select-status",class:"w-40 block p-2 bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"},Q,544),[[_,r.statusFilter]])]),modalFilters:c(()=>[e("div",X,[Y,m(e("select",{"onUpdate:modelValue":s[4]||(s[4]=t=>r.dateNameFilter=t),id:"select-filter",class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"},te,512),[[_,r.dateNameFilter]])]),e("div",se,[oe,m(e("select",{"onUpdate:modelValue":s[5]||(s[5]=t=>r.dateOperationFilter=t),id:"select-filter-operation",class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"},de,512),[[_,r.dateOperationFilter]])]),e("div",ce,[(n(),M(x,{modelValue:r.dateValueFilter,"onUpdate:modelValue":s[6]||(s[6]=t=>r.dateValueFilter=t),key:r.dateValueFilter},null,8,["modelValue"]))])]),head:c(()=>[e("tr",null,[(n(!0),d(f,null,b(r.tableHeaders,(t,g)=>(n(),d("th",{key:g,scope:"col",class:"whitespace-nowrap px-4 py-3"},i(t),1))),128))])]),body:c(()=>[(n(!0),d(f,null,b(r.subscriptions,(t,g)=>(n(),d("tr",{onClick:v(y=>a.onView(t),["stop"]),key:g,class:"group cursor-pointer bg-white hover:bg-gray-50 border-b"},[e("td",he,i(t._relationships.user._attributes.name),1),e("td",ue,i(t._relationships.user.mobileNumber.national),1),e("td",me,[t.ownerType.toLowerCase()=="store"?(n(),d("div",_e,[ge,e("span",null,i(t._relationships.owner.name),1),l(h,{class:"opacity-0 group-hover:opacity-100",title:t._relationships.owner.name,placement:"top"},{description:c(()=>[e("p",null,i(t._relationships.owner.description),1)]),_:2},1032,["title"])])):t.ownerType.toLowerCase()=="ai assistant"?(n(),d("div",fe,[ve,we,l(h,{class:"opacity-0 group-hover:opacity-100",title:"Ai Assistant",placement:"top"},{description:c(()=>[e("p",null,"Total Requests: "+i(t._relationships.owner.totalRequests),1),e("p",null,"Remaining Tokens: "+i(t._relationships.owner.remainingPaidTokens),1),ye,e("p",null,"Request Tokens Used: "+i(t._relationships.owner.requestTokensUsed),1),e("p",null,"Response Tokens Used: "+i(t._relationships.owner.responseTokensUsed),1)]),_:2},1024)])):t.ownerType.toLowerCase()=="sms alert"?(n(),d("div",ke,[be,Fe,l(h,{class:"opacity-0 group-hover:opacity-100",title:"Sms Alerts",placement:"top"},{description:c(()=>[e("p",null,"Sms Credits Left: "+i(t._relationships.owner.smsCredits),1)]),_:2},1024)])):(n(),d(f,{key:3},[k(i(o.capitalizeAllWords(t.ownerType)),1)],64))]),e("td",xe,[l(S,{type:t.hasExpired==!1?"success":"warning",text:t.hasExpired?"Inactive":"Active",showDot:!1},null,8,["type","text"])]),e("td",Se,[e("div",Ae,[e("span",null,i(o.formattedDatetime(t.startAt)),1),l(h,{class:"opacity-0 group-hover:opacity-100",title:o.formattedRelativeDate(t.startAt),placement:"top"},null,8,["title"])])]),e("td",Te,[e("div",Ve,[e("span",null,i(o.formattedDatetime(t.endAt)),1),l(h,{class:"opacity-0 group-hover:opacity-100",title:o.formattedRelativeDate(t.endAt),placement:"top"},null,8,["title"])])]),e("td",Me,[e("div",Ce,[e("span",null,i(t._relationships.subscriptionPlan.name),1),l(h,{class:"opacity-0 group-hover:opacity-100",title:t._relationships.subscriptionPlan.name,placement:"top"},{description:c(()=>[e("p",null,i(t._relationships.subscriptionPlan.description),1)]),_:2},1032,["title"])])]),e("td",De,[e("a",{href:"#",onClick:v(y=>a.onEdit(t),["stop","prevent"]),class:"font-medium text-blue-600 dark:text-blue-500 hover:underline"},"Edit",8,Oe),e("a",{href:"#",onClick:v(y=>a.onDelete(t),["stop","prevent"]),class:"font-medium text-red-600 dark:text-red-500 hover:underline"},"Delete",8,Ue)])],8,pe))),128))]),_:1},8,["pagination","isLoading","onPaginate","onSearch","onRefresh","filters","onAddOrUpdateFilter","onShowSelectedFilter","onHideFilterModal","onRemoveFilter","totalHeaders"])])}const Ke=B(L,[["render",He]]);export{Ke as default};
